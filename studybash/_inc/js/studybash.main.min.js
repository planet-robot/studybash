var VSectionAccount=VBaseSection.extend({id:"section-account",sectionTemplateID:"tpl-section-welcome",headerTemplateID:"tpl-section-header-welcome",headerElement:"div.section-header",pageElement:"div.section-page",menuClassNameActive:void 0,className:function(){return _.result(VBaseSection.prototype,"className")+" section-account"},events:function(){return _.extend({},_.result(VBaseSection.prototype,"events"),{})},setURL:function(a,b){return b.sbFromRouter?null:"login"===a.pageName||"register"===a.pageName||"verify"===a.pageName||"reset"===a.pageName?a.pageName+"/":!1},instantiatePageView:function(a,b){var c=null;switch(a.pageName){case"login":c=new VPageAccountLogin(a,b);break;case"register":c=new VPageAccountRegister(a,b);break;case"verify":c=new VPageAccountVerify(a,b);break;case"reset":c=new VPageAccountReset(a,b)}return c}}),VPageAccountLogin=VBasePage.extend({id:"page-login",pageTemplateID:"tpl-page",contentTemplateID:void 0,footerTemplateID:"tpl-page-footer-welcome",contentElement:"div.page-content",footerElement:"div.page-footer",className:function(){return _.result(VBasePage.prototype,"className")+" page-login"},events:function(){return _.extend({},_.result(VBasePage.prototype,"events"),{})},initialize:function(a,b){this.formView=new VWidgetAccountLoginForm,this.formView.listenTo(this,"cleanup",this.formView.remove),this.listenTo(this.formView,"onFormSave",this.onFormSave),VBasePage.prototype.initialize.call(this,a,b)},remove:function(){return this.stopListening(this.formView),this.formView=null,VBasePage.prototype.remove.call(this)},render:function(){return VBasePage.prototype.render.call(this),this.$(this.contentElement).html(this.formView.render().$el),this},onFormSubmit:function(){}}),VWidgetAccountLoginForm=VBaseWidgetForm.extend({id:"widget-account-login-form",templateID:"tpl-widget-account-login-form",formName:"login",allowDefaultSubmit:!0,successAlertText:void 0,className:function(){return _.result(VBaseWidgetForm.prototype,"className")+" widget-account-login-form"},events:function(){return _.extend({},_.result(VBaseWidgetForm.prototype,"events"),{})},clearFormFields:function(){},prepareForm:function(){},getFormAttrs:function(){var a=this.jqoForm.serialize_object();return a.email=$.trim(a.email),a.password=$.trim(a.password),a.keep=a.keep?1:0,a},validateAttrs:function(a){return a.email.length?a.password.length?(Spinner.get().show({msg:"Logging in...",opacity:0}),$.ajax({url:app.JS_ROOT+"ajax/account.php/login",type:"POST",dataType:"json",contentType:"application/json",data:JSON.stringify(a),processData:!1,context:this}).done(function(a){Spinner.get().hide(function(){this.onAttrsValid(a)}.bind(this))}).fail(function(a,b,c){Spinner.get().hide(function(){var d=app.getAjaxUserError(a);if(d)switch(d.type){case"verify":this.onAttrsInvalid({field:null,msg:"<strong>Account</strong>: Please <a href='"+app.JS_ROOT+"#verify/' class='navigate'>verify</a> your account. Do you need us to <a href='"+app.JS_ROOT+"#sendcode/' class='navigate'>send</a> you a new verification code?"});break;case"register":this.onAttrsInvalid({field:null,msg:"<strong>Account</strong>: Unrecognized email/password combination. Do you need to <a href='"+app.JS_ROOT+"#register/' class='navigate'>register</a> an account?"});break;default:app.dealWithAjaxFail(a,b,c)}else app.dealWithAjaxFail(a,b,c)}.bind(this))}),null):{msg:"<strong>Password</strong>: Please enter your password",field:"password"}:{msg:"<strong>Email</strong>: Please enter your email address",field:"email"}}}),VPageAccountRegister=VBasePage.extend({id:"page-register",pageTemplateID:"tpl-page",contentTemplateID:void 0,footerTemplateID:"tpl-page-footer-welcome",contentElement:"div.page-content",footerElement:"div.page-footer",className:function(){return _.result(VBasePage.prototype,"className")+" page-register"},events:function(){return _.extend({},_.result(VBasePage.prototype,"events"),{})},initialize:function(a,b){this.formView=new VWidgetAccountRegisterForm,this.formView.listenTo(this,"cleanup",this.formView.remove),this.listenTo(this.formView,"onFormSave",this.onFormSave),VBasePage.prototype.initialize.call(this,a,b)},remove:function(){return this.stopListening(this.formView),this.formView=null,VBasePage.prototype.remove.call(this)},render:function(){return VBasePage.prototype.render.call(this),this.$(this.contentElement).html(this.formView.render().$el),this},onFormSubmit:function(){}}),VWidgetAccountRegisterForm=VBaseWidgetForm.extend({id:"widget-account-register-form",templateID:"tpl-widget-account-register-form",formName:"register",successAlertText:function(){return"An email has been sent to you with a verification code. Go get it and then <a href='"+app.JS_ROOT+"#verify/' class='navigate'>verify your account."},className:function(){return _.result(VBaseWidgetForm.prototype,"className")+" widget-account-register-form"},events:function(){return _.extend({},_.result(VBaseWidgetForm.prototype,"events"),{"click img[name=captcha]":"onClickCaptchaImage","click a[name=terms]":"onClickTerms"})},getDefaultAttrsForTemplate:function(){return{randomStr:$.leftovers.parse.generate_random_string(10,!0,!0,!0)}},onClickCaptchaImage:function(a){var b=$.leftovers.parse.generate_random_string(10,!0,!0,!0);this.jqo_img_captcha.attr("src",this.img_captcha_src+"?"+b),a.preventDefault()},onClickTerms:function(a){var b=$.includejs.getTemplate("tpl-widget-account-register-form-terms",{});bsDialog.create({title:"Terms and Conditions",msg:b,ok:function(){this.jqo_agree.prop("disabled",!1),this.jqo_agree.prop("checked",!1)}.bind(this)}),a.preventDefault()},clearFormFields:function(){this.$("input").prop("disabled",!0),this.$("button").prop("disabled",!0),this.$("input[type=checkbox]").remove()},prepareForm:function(){this.jqo_captcha=this.jqoForm.find("input[name=captcha]"),this.jqo_agree=this.jqoForm.find("input[name=agree]"),this.jqo_img_captcha=this.jqoForm.find("img[name=captcha]"),this.img_captcha_src=this.jqo_img_captcha.attr("src")},getFormAttrs:function(){var a=this.jqoForm.serialize_object();return a.email=$.trim(a.email),a.password=$.trim(a.password),a.full_name=$.trim(a.full_name),a.captcha=$.trim(a.captcha),a.captcha=a.captcha.toUpperCase(),a.agree=a.agree?1:0,a},validateAttrs:function(a){var b=$.leftovers.parse.validate_string({str:a.email,field:"Email",match_type:"email"});return b.passed?(re=new RegExp("^[- A-Za-z']{2,32}$"),re.test(a.first_name)?(re=new RegExp("^[- A-Za-z']{2,32}$"),re.test(a.last_name)?(a.first_name=$.leftovers.parse.name_case(a.first_name),a.last_name=$.leftovers.parse.name_case(a.last_name),a.captcha.length?a.agree?(Spinner.get().show({msg:"Registering...",opacity:0}),$.ajax({url:app.JS_ROOT+"ajax/account.php/register",type:"POST",dataType:"json",contentType:"application/json",data:JSON.stringify(a),processData:!1,context:this}).done(function(a){this.onAttrsValid(a),Spinner.get().hide()}).fail(function(a,b,c){Spinner.get().hide(function(){var d=app.getAjaxUserError(a);if(d)switch(d.type){case"institution":this.onAttrsInvalid({field:"email",msg:"<strong>Email</strong>: I'm sorry but we only support the following institutions at the moment: <em>"+d.msg+"</em>. Please <a href='mailto:help@studybash.com'>email us</a> if you want your institution added to our list."});break;case"full":this.onAttrsInvalid({field:null,msg:"<strong>Full</strong: Sorry but we aren't accepting new users at the moment. Please try again in a day or so."});break;case"login":this.onAttrsInvalid({field:"email",msg:"<strong>Email</strong>: That email address has already been registered."});break;case"captcha":this.onAttrsInvalid({field:"captcha",msg:"<strong>Captcha</strong>: Please enter the correct captcha characters."});break;default:app.dealWithAjaxFail(a,b,c)}else app.dealWithAjaxFail(a,b,c)}.bind(this))}),null):{msg:"Please read and accept the terms and conditions.",field:"agree"}:{msg:"<strong>Captcha</strong>: Please enter the captcha characters",field:"captcha"}):{msg:"<strong>Last Name</strong>: 2-32 chars long, charset: <em>A-z</em>, <em>-'</em>",field:"last_name"}):{msg:"<strong>First Name(s)</strong>: 2-32 chars long, charset: <em>A-z</em>, <em>-'</em>",field:"first_name"}):{msg:"<strong>Email</strong>: Please enter a valid email address",field:"email"}}}),VPageAccountReset=VBasePage.extend({id:"page-reset",pageTemplateID:"tpl-page",contentTemplateID:void 0,footerTemplateID:"tpl-page-footer-welcome",contentElement:"div.page-content",footerElement:"div.page-footer",className:function(){return _.result(VBasePage.prototype,"className")+" page-reset"},events:function(){return _.extend({},_.result(VBasePage.prototype,"events"),{})},initialize:function(a,b){this.formView=new VWidgetAccountResetForm({},b),this.formView.listenTo(this,"cleanup",this.formView.remove),this.listenTo(this.formView,"onFormSave",this.onFormSave),VBasePage.prototype.initialize.call(this,a,b)},remove:function(){return this.stopListening(this.formView),this.formView=null,VBasePage.prototype.remove.call(this)},render:function(){return VBasePage.prototype.render.call(this),this.$(this.contentElement).html(this.formView.render().$el),this},onFormSubmit:function(){}}),VWidgetAccountResetForm=VBaseWidgetForm.extend({id:"widget-account-reset-form",templateID:"tpl-widget-account-reset-form",formName:"reset",successAlertText:function(){return"An email has been sent to you with a verification code. Go get it and then <a href='"+app.JS_ROOT+"#setpwd/' class='navigate'>set a new password."},className:function(){return _.result(VBaseWidgetForm.prototype,"className")+" widget-account-reset-form"},events:function(){return _.extend({},_.result(VBaseWidgetForm.prototype,"events"),{"click img[name=captcha]":"onClickCaptchaImage"})},onClickCaptchaImage:function(a){var b=$.leftovers.parse.generate_random_string(10,!0,!0,!0);this.jqo_img_captcha.attr("src",this.img_captcha_src+"?"+b),a.preventDefault()},clearFormFields:function(){this.$("input").prop("disabled",!0),this.$("button").prop("disabled",!0)},prepareForm:function(){this.jqo_captcha=this.jqoForm.find("input[name=captcha]"),this.jqo_img_captcha=this.jqoForm.find("img[name=captcha]"),this.img_captcha_src=this.jqo_img_captcha.attr("src")},getDefaultAttrsForTemplate:function(){var a={randomStr:$.leftovers.parse.generate_random_string(10,!0,!0,!0),email:null,form_title:"Reset Your Password",button_title:"Reset"};return this.options&&this.options.email&&(a.email=this.options.email),this.options&&this.options.sbSendCode&&(a.form_title="Send New Code",a.button_title="Send"),a},getFormAttrs:function(){var a=this.jqoForm.serialize_object();return a.email=$.trim(a.email),a.captcha=$.trim(a.captcha),a.captcha=a.captcha.toUpperCase(),a},validateAttrs:function(a){return a.email.length?a.captcha.length?(Spinner.get().show({msg:"Resetting...",opacity:0}),$.ajax({url:app.JS_ROOT+"ajax/account.php/reset",type:"POST",dataType:"json",contentType:"application/json",data:JSON.stringify(a),processData:!1,context:this}).done(function(a){this.onAttrsValid(a),Spinner.get().hide()}).fail(function(a,b,c){Spinner.get().hide(function(){var d=app.getAjaxUserError(a);if(d)switch(d.type){case"register":this.onAttrsInvalid({field:"email",msg:"<strong>Email</strong>: Unrecognized email. Do you need to <a href='"+app.JS_ROOT+"#register/' class='navigate'>register</a> an account?"});break;case"captcha":this.onAttrsInvalid({field:"captcha",msg:"<strong>Captcha</strong>: Please enter the captcha characters."});break;default:app.dealWithAjaxFail(a,b,c)}else app.dealWithAjaxFail(a,b,c)}.bind(this))}),null):{msg:"<strong>Captcha</strong>: Please enter the captcha characters (click on the image for a new one)",field:"captcha"}:{msg:"<strong>Email</strong>: Please enter your registered email address",field:"email"}}}),VPageAccountVerify=VBasePage.extend({id:"page-verify",pageTemplateID:"tpl-page",contentTemplateID:void 0,footerTemplateID:"tpl-page-footer-welcome",contentElement:"div.page-content",footerElement:"div.page-footer",className:function(){return _.result(VBasePage.prototype,"className")+" page-verify"},events:function(){return _.extend({},_.result(VBasePage.prototype,"events"),{})},initialize:function(a,b){this.formView=new VWidgetAccountVerifyForm({},b),this.formView.listenTo(this,"cleanup",this.formView.remove),this.listenTo(this.formView,"onFormSave",this.onFormSave),VBasePage.prototype.initialize.call(this,a,b)},remove:function(){return this.stopListening(this.formView),this.formView=null,VBasePage.prototype.remove.call(this)},render:function(){return VBasePage.prototype.render.call(this),this.$(this.contentElement).html(this.formView.render().$el),this},onFormSubmit:function(){}}),app=app||{},VWidgetAccountVerifyForm=VBaseWidgetForm.extend({id:"widget-account-verify-form",templateID:"tpl-widget-account-verify-form",formName:"verify",successAlertText:function(){return"You may now <a href='"+app.JS_ROOT+"#login/' class='navigate'>login</a>."},className:function(){return _.result(VBaseWidgetForm.prototype,"className")+" widget-account-verify-form"},events:function(){return _.extend({},_.result(VBaseWidgetForm.prototype,"events"),{})},clearFormFields:function(){this.$("input").prop("disabled",!0),this.$("button").prop("disabled",!0)},prepareForm:function(){},getDefaultAttrsForTemplate:function(){var a={email:null,form_title:"Verify Your Account",button_title:"Verify"};return this.options&&this.options.email&&(a.email=this.options.email),this.options&&this.options.sbSetPwd&&(a.form_title="Set Your Password",a.button_title="Set"),a},getFormAttrs:function(){var a=this.jqoForm.serialize_object();return a.password1=$.trim(a.password1),a.password2=$.trim(a.password2),a.email=$.trim(a.email),a.code=$.trim(a.code),a},validateAttrs:function(a){return a.email.length?a.code.length?a.password1.length<6||a.password1.length>32?{msg:"<strong>Password</strong>: Must be between 6-32 chars long",field:"password1"}:a.password2!==a.password1?{msg:"<strong>Password</strong>: Must match",field:"password2"}:(Spinner.get().show({msg:"Verifying...",opacity:0}),$.ajax({url:app.JS_ROOT+"ajax/account.php/verify",type:"POST",dataType:"json",contentType:"application/json",data:JSON.stringify(a),processData:!1,context:this}).done(function(a){this.onAttrsValid(a),Spinner.get().hide()}).fail(function(a,b,c){Spinner.get().hide(function(){var d=app.getAjaxUserError(a);if(d)switch(d.type){case"register":this.onAttrsInvalid({field:null,msg:"<strong>Account</strong>: Unrecognized email/code combination. Do you need us to <a href='"+app.JS_ROOT+"#sendcode/' class='navigate'>send</a> you a new verification code?"});break;case"login":this.onAttrsInvalid({field:null,msg:"<strong>Account</strong>: You have already verified this account. Please <a href='"+app.JS_ROOT+"#login/' class='navigate'>login</a>."});break;default:app.dealWithAjaxFail(a,b,c)}else app.dealWithAjaxFail(a,b,c)}.bind(this))}),null):{msg:"<strong>Code</strong>: Please enter your verification code",field:"code"}:{msg:"<strong>Email</strong>: Please enter your registered email address",field:"email"}}}),VPageDashProfile=VBasePage.extend({id:"page-dash",pageTemplateID:"tpl-page",contentTemplateID:"tpl-page-dash",footerTemplateID:"tpl-page-footer-user",contentElement:"div.page-content",footerElement:"div.page-footer",panelElement:"div.page-content > div.content > div.content-panel",className:function(){return _.result(VBasePage.prototype,"className")+" page-dash-profile"},events:function(){return _.extend({},_.result(VBasePage.prototype,"events"),{})},initialize:function(a,b){this.profileView=new VWidgetDashProfilePanel({templateAttrs:app.store.get("user")}),VBasePage.prototype.initialize.call(this,a,b)},remove:function(){return this.stopListening(this.profileView),this.profileView=null,VBasePage.prototype.remove.call(this)},render:function(){return VBasePage.prototype.render.call(this),this.$(this.panelElement).html(this.profileView.render().$el),this}}),VSectionDash=VBaseSection.extend({id:"section-dash",sectionTemplateID:"tpl-section-user",headerTemplateID:"tpl-section-header-user",headerElement:"div.section-header",pageElement:"div.section-page",menuClassNameActive:"dash",className:function(){return _.result(VBaseSection.prototype,"className")+" section-dash"},events:function(){return _.extend({},_.result(VBaseSection.prototype,"events"),{})},setURL:function(){return null},instantiatePageView:function(a,b){return new VPageDashProfile(a,b)}}),VWidgetDashProfilePanel=VBaseWidgetPanel.extend({className:void 0,templateID:"tpl-dash-profile",className:function(){return _.result(VBaseWidgetPanel.prototype,"className")+" widget-panel-dash-profile"},events:function(){return _.extend({},_.result(VBaseWidgetPanel.prototype,"events"),{})}}),VPageClasses=VBasePage.extend({id:"page-classes",pageTemplateID:"tpl-page",contentTemplateID:"tpl-page-classes",footerTemplateID:"tpl-page-footer-user",contentElement:"div.page-content",footerElement:"div.page-footer",className:function(){return _.result(VBasePage.prototype,"className")+" page-classes"},toolbarElement:"div.page-content > div.content > div.content-toolbar",formElement:"div.page-content > div.content > div.content-form",listElement:"div.page-content > div.content > div.content-list",events:function(){return _.extend({},_.result(VBasePage.prototype,"events"),{})},initialize:function(a,b){this.toolbarView=null,this.formView=null,this.listView=null,VBasePage.prototype.initialize.call(this,a,b)},loadData:function(){this.userEnrollment=null,this.generalEnrollment=null,Spinner.get().show({msg:"Loading data...",opacity:0}),$.ajax({url:app.JS_ROOT+"ajax/classes-manual.php/init",type:"POST",dataType:"json",data:JSON.stringify(app.store.get("user").id),contentType:"application/json",context:this,beforeSend:function(a){a.setRequestHeader("SESSIONTOKEN",app&&app.store.has("user")?app.store.get("user").token:"unspecified")}}).done(function(a){this.userEnrollment=a.userEnrollment,this.generalEnrollment=a.generalEnrollment,a=null,this.ready(),Spinner.get().hide()}).fail(function(a,b,c){Spinner.get().hide(function(){app.dealWithAjaxFail(a,b,c)})})},ready:function(){this.toolbarView=new VWidgetClassesToolbar,this.toolbarView.listenTo(this,"cleanup",this.toolbarView.remove),this.listenTo(this.toolbarView,"onClickToolbar",this.onClickToolbar),this.listView=new VWidgetClassesList({listData:this.userEnrollment}),this.listView.listenTo(this,"cleanup",this.listView.remove),this.trigger("onPageReady",this)},remove:function(){return this.stopListening(this.toolbarView),this.stopListening(this.listView),this.stopListening(this.formView),this.toolbarView=null,this.listView=null,this.formView=null,VBasePage.prototype.remove.call(this)},render:function(){VBasePage.prototype.render.call(this);var a=this.$("div.sb-footer div.help a").prop("href");return this.$("div.sb-footer div.help a").prop("href",a+"classes/"),this.$(this.toolbarElement).html(this.toolbarView.render().$el),this.toolbarView.setEnabled({add:!0}),this.$(this.listElement).html(this.listView.render().$el),this},onClickToolbar:function(a){"add"===a&&this.displayAddForm()},displayAddForm:function(){this.formView&&(this.stopListening(this.formView),this.formView=null),this.formView=new VWidgetClassesFormAdd({generalEnrollment:this.generalEnrollment}),this.listenTo(this.formView,"onFormSubmit",this.onFormSubmit),this.listenTo(this.formView,"onFormCancel",this.onFormCancel),this.formView.listenTo(this,"cleanup",this.formView.remove),this.$(this.formElement).html(this.formView.render().$el),this.toolbarView.setEnabled({})},closeForm:function(){this.stopListening(this.formView),this.formView.remove(),this.formView=null,this.toolbarView.setEnabled({add:!0})},onFormSubmit:function(a,b,c){this.listView.trigger("onExternalAdd",b,c),this.closeForm()},onFormCancel:function(){this.closeForm()}}),VSectionClasses=VBaseSection.extend({id:"section-classes",sectionTemplateID:"tpl-section-user",headerTemplateID:"tpl-section-header-user",headerElement:"div.section-header",pageElement:"div.section-page",menuClassNameActive:"classes",className:function(){return _.result(VBaseSection.prototype,"className")+" section-classes"},events:function(){return _.extend({},_.result(VBaseSection.prototype,"events"),{})},setURL:function(){return null},instantiatePageView:function(a,b){return new VPageClasses(a,b)}}),VWidgetClassesFormAdd=VBaseWidgetFormCreate.extend({id:"widget-classes-form-add",templateID:"tpl-widget-classes-form-add",successAlertText:void 0,requestText:"Adding...",formName:"add",className:function(){return _.result(VBaseWidgetFormCreate.prototype,"className")+" widget-classes-form-add"},events:function(){return _.extend({},_.result(VBaseWidgetFormCreate.prototype,"events"),{"change input[name=codes]":"onChangeCodes","change input[name=year]":"onChangeYear","change input[name=semester]":"onChangeSemester"})},instantiateModel:function(){var a=new EnrollmentModel;return a},prepareForm:function(){this.jqoCodes=this.jqoForm.find("input[name=codes]"),this.jqoYear=this.jqoForm.find("input[name=year]"),this.jqoSemester=this.jqoForm.find("input[name=semester]"),this.jqoClassName=this.jqoForm.find("input[name=class_name]"),this.jqoLecturerName=this.jqoForm.find("input[name=lecturer_name]"),this.jqoTextbookURL=this.jqoForm.find("input[name=textbook_url]"),this.jqoCompleted=this.jqoForm.find("input[name=completed]"),this.enrolledCodes=[];var a=this.settings.generalEnrollment;for(var b in a)a.hasOwnProperty(b)&&this.enrolledCodes.push(b);this.ws_codes=new WSelect2({elem:this.jqoCodes,makeElement:null,filterSelection:function(a){return a.id.toUpperCase()}}),this.ws_codes.init({data:_.map(this.enrolledCodes,function(b){var c={};return c.id=b,c.text=c.id+" ("+a[b].count+")",c}),preventNew:!1,placeholder:"e.g., PSYC 101"}),this.ws_year=new WSelect2({elem:this.jqoYear,makeElement:null,filterSelection:function(a){return a.id}}),this.ws_year.init({data:[],preventNew:!0,placeholder:"e.g., "+(new Date).getFullYear()}),this.ws_year.disable(),this.ws_semester=new WSelect2({elem:this.jqoSemester,makeElement:null,filterSelection:function(a){return a.id}}),this.ws_semester.init({data:[],preventNew:!0,placeholder:"e.g., Fall"}),this.ws_semester.disable(),this.ws_class_name=new WSelect2({elem:this.jqoClassName,makeElement:null,filterSelection:function(a){return $.leftovers.parse.simple_name_case(a.id)}}),this.ws_class_name.init({data:[],preventNew:!0,placeholder:"e.g., Biological Psychology"}),this.ws_class_name.disable(),this.ws_lecturer_name=new WSelect2({elem:this.jqoLecturerName,makeElement:null,filterSelection:function(a){return $.leftovers.parse.name_case(a.id)}}),this.ws_lecturer_name.init({data:[],preventNew:!0,placeholder:"e.g., Victor Frankenstein"}),this.ws_lecturer_name.disable(),this.ws_textbook_url=new WSelect2({elem:this.jqoTextbookURL,makeElement:null,filterSelection:function(a){return a.id=$.trim(a.id),0!==a.id.indexOf("http://")&&0!==a.id.indexOf("https://")&&(a.id="http://"+a.id),$.leftovers.parse.cropUrlParms(a.id)}}),this.ws_textbook_url.init({data:[],preventNew:!0,placeholder:"e.g., http://amazon.com/Creation-Life-How-Make-It/dp/0674011139/"}),this.ws_textbook_url.disable()},remove:function(){return this.jqoCodes=null,this.jqoYear=null,this.jqoSemester=null,this.jqoClassName=null,this.jqoLecturerName=null,this.jqoTextbookURL=null,this.jqoCompleted=null,this.enrolledCodes=null,this.ws_codes=null,this.ws_year=null,this.ws_semester=null,this.ws_class_name=null,this.ws_lecturer_name=null,this.ws_textbook_url=null,VBaseWidgetFormCreate.prototype.remove.call(this)},getSelectedCodes:function(){var a=this.ws_codes.getSelection();return a&&a.length?(a=a[0].id.split(" "),a={subject_code:a[0],class_code:a[1],isNew:a[0].isNew}):a={},a},getSelectedYear:function(){var a=this.ws_year.getSelection();return a=a&&a.length?+a[0].id:null},getSelectedSemester:function(){var a=this.ws_semester.getSelection();return a&&a.length?(a=a[0].id,a=_.find(app.store.get("semesters"),function(b){return b.name===a})):a={},a},onChangeCodes:function(a){if(this.ws_semester.disable(),this.ws_class_name.disable(),this.ws_lecturer_name.disable(),this.ws_textbook_url.disable(),!a.added)return this.ws_year.disable(),void 0;for(var b=a.added.id.toUpperCase(),c=app.store.get("classes.years.after"),d=app.store.get("classes.years.before"),e=a.added.isNew?null:this.settings.generalEnrollment[b],f=[],g=(new Date).getFullYear(),h=g+c;h>=g-d;h--){var i=h.toString();e&&e.years.hasOwnProperty(h)?i+=" ("+ +e.years[h].count+")":e&&(i+=" (0)"),f.push({id:h.toString(),text:i})}this.ws_year.init({data:f,preventNew:!0,placeholder:"e.g., "+g}),this.ws_year.enable()},onChangeYear:function(a){if(this.ws_class_name.disable(),this.ws_lecturer_name.disable(),this.ws_textbook_url.disable(),!a.added)return this.ws_semester.disable(),void 0;var b=+a.added.id,c=this.getSelectedCodes();c=c.isNew?null:c.subject_code+" "+c.class_code;var d=[],e=app.store.get("semesters"),f=this.settings.generalEnrollment[c];f=f?f.years[b]:null;for(var g=0;g<e.length;g++){var h=e[g].name+" ["+e[g].description+"]";f&&f.semesters.hasOwnProperty(e[g].name)?h+=" ("+f.semesters[e[g].name]+")":f&&(h+=" (0)"),d.push({id:e[g].name,text:h})}this.ws_semester.init({data:d,preventNew:!0,placeholder:"e.g., Fall"}),this.ws_semester.enable()},onChangeSemester:function(a){if(this.ws_class_name.disable(),this.ws_lecturer_name.disable(),this.ws_textbook_url.disable(),a.added){this.suggestions=null;var b=this.getSelectedCodes(),c=this.getSelectedYear(),d=a.added.id;b.isNew?(this.suggestions=[],this.displaySuggestions()):(Spinner.get().show({msg:"Loading suggestions...",opacity:0}),$.ajax({url:app.JS_ROOT+"ajax/classes-manual.php/suggestions",type:"POST",dataType:"json",data:JSON.stringify({subject_code:b.subject_code,class_code:b.class_code,year:c,semester:d}),contentType:"application/json",context:this,beforeSend:function(a){a.setRequestHeader("SESSIONTOKEN",app&&app.store.has("user")?app.store.get("user").token:"unspecified")}}).done(function(a){this.suggestions=a,a=null,this.displaySuggestions(),Spinner.get().hide()}).fail(function(a,b,c){Spinner.get().hide(function(){app.dealWithAjaxFail(a,b,c)})}))}},displaySuggestions:function(){this.ws_class_name.init({data:_.map(this.suggestions.class_name,function(a){return{id:a.text,text:a.text+" ("+a.num_used+")"}}),allowClear:!0,preventNew:!1,placeholder:"e.g., Biological Psychology"}),this.ws_class_name.enable(),this.ws_lecturer_name.init({data:_.map(this.suggestions.lecturer_name,function(a){return{id:a.text,text:a.text+" ("+a.num_used+")"}}),allowClear:!0,preventNew:!1,placeholder:"e.g., Victor Frankenstein"}),this.ws_lecturer_name.enable(),this.ws_textbook_url.init({data:_.map(this.suggestions.textbook_url,function(a){return{id:a.text,text:a.text+" ("+a.num_used+")"}}),allowClear:!0,preventNew:!1,placeholder:"e.g., http://amazon.com/Creation-Life-How-Make-It/dp/0674011139/"}),this.ws_textbook_url.enable()},getFormAttrs:function(){var a=this.jqoForm.serialize_object(),b=this.getSelectedCodes();return a.subject_code=$.trim(b.subject_code).toUpperCase(),a.class_code=$.trim(b.class_code).toUpperCase(),a.year=+this.getSelectedYear(),a.semester=$.trim(this.getSelectedSemester().name),a.class_name=this.ws_class_name.getSelection(),a.class_name=a.class_name.length?$.leftovers.parse.simple_name_case($.trim(a.class_name[0].id)):null,a.lecturer_name=this.ws_lecturer_name.getSelection(),a.lecturer_name=a.lecturer_name.length?$.leftovers.parse.name_case($.trim(a.lecturer_name[0].id)):null,a.textbook_url=this.ws_textbook_url.getSelection(),a.textbook_url.length?(a.textbook_url=$.leftovers.parse.cropUrlParms($.trim(a.textbook_url[0].id)),0!==a.textbook_url.indexOf("http://")&&0!==a.textbook_url.indexOf("https://")&&(a.textbook_url="http://"+a.textbook_url)):a.textbook_url=null,a.completed=a.completed?1:0,a},onModelError:function(a,b){Spinner.get().hide(function(){var a=app.getAjaxUserError(b);400===b.status&&a&&"enrollment"===a.type?bsDialog.create({title:"Error!",msg:"<p>Failed to enroll. Are you already enrolled in that class?</p>",ok:function(){}}):app.dealWithAjaxFail(b,null,null)})}}),VWidgetClassesList=VBaseWidgetList.extend({id:"widget-classes-list",className:function(){return _.result(VBaseWidgetList.prototype,"className")+" widget-classes-list"},events:function(){return _.extend({},_.result(VBaseWidgetList.prototype,"events"),{})},instantiateCollection:function(){return new EnrollmentCollection},instantiateModel:function(){return new EnrollmentModel},instantiateWidgetRecordEditable:function(a,b){return new VWidgetClassesRecordEditable(a,b)}}),VWidgetClassesRecordEditableDisplay=VBaseWidgetRecordEditableDisplay.extend({id:void 0,templateID:"tpl-widget-classes-record-editable-display",className:function(){return _.result(VBaseWidgetRecordEditableDisplay.prototype,"className")+" widget-classes-record-editable-display"},events:function(){return _.extend({},_.result(VBaseWidgetRecordEditableDisplay.prototype,"events"),{})}}),VWidgetClassesRecordEditableEdit=VBaseWidgetRecordEditableEdit.extend({id:void 0,templateID:"tpl-widget-classes-record-editable-edit",className:function(){return _.result(VBaseWidgetRecordEditableEdit.prototype,"className")+" widget-classes-record-editable-edit"},events:function(){return _.extend({},_.result(VBaseWidgetRecordEditableEdit.prototype,"events"),{})},prepareForm:function(){this.jqoClassName=this.jqoForm.find("input[name=class_name]"),this.jqoLecturerName=this.jqoForm.find("input[name=lecturer_name]"),this.jqoTextbookURL=this.jqoForm.find("input[name=textbook_url]"),this.jqoCompleted=this.jqoForm.find("input[name=completed]"),this.suggestions=null,Spinner.get().show({msg:"Loading suggestions...",opacity:0}),$.ajax({url:app.JS_ROOT+"ajax/classes-manual.php/suggestions",type:"POST",dataType:"json",data:JSON.stringify({subject_code:this.settings.recordSettings.model.get("subject_code"),class_code:this.settings.recordSettings.model.get("class_code"),year:this.settings.recordSettings.model.get("year"),semester:this.settings.recordSettings.model.get("semester")}),contentType:"application/json",context:this,beforeSend:function(a){a.setRequestHeader("SESSIONTOKEN",app&&app.store.has("user")?app.store.get("user").token:"unspecified")}}).done(function(a){this.suggestions=a,a=null,this.displaySuggestions(),Spinner.get().hide()}).fail(function(a,b,c){Spinner.get().hide(function(){app.dealWithAjaxFail(a,b,c)})})},displaySuggestions:function(){this.ws_class_name=new WSelect2({elem:this.jqoClassName,makeElement:null,filterSelection:function(a){return $.leftovers.parse.simple_name_case(a.id)}}),this.ws_class_name.init({data:_.map(this.suggestions.class_name,function(a){return{id:a.text,text:a.text+" ("+a.num_used+")"}}),allowClear:!0,preventNew:!1,placeholder:"e.g., Biological Psychology"});var a=this.settings.recordSettings.model.get("class_name");a&&this.ws_class_name.setData({id:a,text:a}),this.ws_lecturer_name=new WSelect2({elem:this.jqoLecturerName,makeElement:null,filterSelection:function(a){return $.leftovers.parse.name_case(a.id)}}),this.ws_lecturer_name.init({data:_.map(this.suggestions.lecturer_name,function(a){return{id:a.text,text:a.text+" ("+a.num_used+")"}}),allowClear:!0,preventNew:!1,placeholder:"e.g., Victor Frankenstein"});var a=this.settings.recordSettings.model.get("lecturer_name");a&&this.ws_lecturer_name.setData({id:a,text:a}),this.ws_textbook_url=new WSelect2({elem:this.jqoTextbookURL,makeElement:null,filterSelection:function(a){return a.id=$.trim(a.id),0!==a.id.indexOf("http://")&&0!==a.id.indexOf("https://")&&(a.id="http://"+a.id),$.leftovers.parse.cropUrlParms(a.id)}}),this.ws_textbook_url.init({data:_.map(this.suggestions.textbook_url,function(a){return{id:a.text,text:a.text+" ("+a.num_used+")"}}),allowClear:!0,preventNew:!1,placeholder:"e.g., amazon.com/Creation-Life-How-Make-It/dp/0674011139/"});var a=this.settings.recordSettings.model.get("textbook_url");a&&this.ws_textbook_url.setData({id:a,text:a})},getFormAttrs:function(){var a=this.jqoForm.serialize_object();return a.class_name=this.ws_class_name.getSelection(),a.class_name=a.class_name.length?$.leftovers.parse.simple_name_case($.trim(a.class_name[0].id)):null,a.lecturer_name=this.ws_lecturer_name.getSelection(),a.lecturer_name=a.lecturer_name.length?$.leftovers.parse.name_case($.trim(a.lecturer_name[0].id)):null,a.textbook_url=this.ws_textbook_url.getSelection(),a.textbook_url.length?(a.textbook_url=$.leftovers.parse.cropUrlParms($.trim(a.textbook_url[0].id)),0!==a.textbook_url.indexOf("http://")&&0!==a.textbook_url.indexOf("https://")&&(a.textbook_url="http://"+a.textbook_url)):a.textbook_url=null,a.completed=a.completed?1:0,a
}}),VWidgetClassesRecordEditable=VBaseWidgetRecordEditable.extend({id:void 0,templateID:"tpl-widget-classes-record-editable",deleteDialogTitle:"Remove Class",deleteDialogMsg:"<p>Are you sure you want to remove this class?</p>",className:function(){return _.result(VBaseWidgetRecordEditable.prototype,"className")+" widget-classes-record-editable"+(this.model.get("completed")?" widget-classes-record-editable-completed":" widget-classes-record-editable-not-completed")},events:function(){return _.extend({},_.result(VBaseWidgetRecordEditable.prototype,"events"),{})},updateModelURL:function(){},instantiateToolbarView:function(){return new VWidgetClassesRecordEditableToolbar},instantiateDisplayView:function(a,b){return new VWidgetClassesRecordEditableDisplay(a,b)},instantiateEditView:function(a,b){return new VWidgetClassesRecordEditableEdit(a,b)},onModelError:function(a,b){Spinner.get().hide(function(){var a=app.getAjaxUserError(b);if(400===b.status&&a){var c=+a.msg,d=a.type+(c>1?"s":"");bsDialog.create({title:"Error!",msg:"<p>You cannot remove that class. You still have "+c+" "+d+" for it.</p>",ok:function(){}})}else app.dealWithAjaxFail(b,null,null)})}}),VWidgetClassesRecordEditableToolbar=VBaseWidgetToolbar.extend({id:void 0,templateID:"tpl-widget-classes-record-editable-toolbar",className:function(){return _.result(VBaseWidgetToolbar.prototype,"className")+" widget-classes-record-editable-toolbar"},events:function(){return _.extend({},_.result(VBaseWidgetToolbar.prototype,"events"),{})}}),VWidgetClassesToolbar=VBaseWidgetToolbar.extend({id:"widget-classes-toolbar",templateID:"tpl-widget-classes-toolbar",className:function(){return _.result(VBaseWidgetToolbar.prototype,"className")+" widget-classes-toolbar"},events:function(){return _.extend({},_.result(VBaseWidgetToolbar.prototype,"events"),{})}}),VBasePageHelp=VBasePage.extend({id:void 0,tabActiveName:void 0,pageTemplateID:"tpl-page",contentTemplateID:"tpl-page-help",footerTemplateID:"tpl-page-footer-user",contentElement:"div.page-content",footerElement:"div.page-footer",tabElement:"div.sb-tabs",panelElement:"div.content > div.content-panel",formElement:"div.content > div.content-form",className:function(){return _.result(VBasePage.prototype,"className")+" page-help"},events:function(){return _.extend({},_.result(VBasePage.prototype,"events"),{})},initialize:function(a,b){this.panelView=this.instantiatePanel(a,b),this.formView=this.instantiateForm(a,b),this.panelView&&this.panelView.listenTo(this,"cleanup",this.panelView.remove),this.formView&&this.formView.listenTo(this,"cleanup",this.formView.remove),VBasePage.prototype.initialize.call(this,a,b)},instantiatePanel:function(){return null},instantiateForm:function(){return null},remove:function(){return this.stopListening(),this.panelView=null,this.formView=null,VBasePage.prototype.remove.call(this)},render:function(){return VBasePage.prototype.render.call(this),this.tabActiveName&&(this.$(this.tabElement).find("ul.hidden-xs li").removeClass("sb-tab-active"),this.$(this.tabElement).find("ul.hidden-xs li[name="+this.tabActiveName+"]").addClass("sb-tab-active"),this.$(this.tabElement).find("ul.dropdown-menu li").removeClass("disabled"),this.$(this.tabElement).find("ul.dropdown-menu li[name="+this.tabActiveName+"]").addClass("disabled")),this.panelView&&this.$(this.panelElement).html(this.panelView.render().$el),this.formView&&this.$(this.formElement).html(this.formView.render().$el),this},onFormSave:function(){}}),VPageHelpClasses=VBasePageHelp.extend({id:"page-help-classes",tabActiveName:"classes",className:function(){return _.result(VBasePage.prototype,"className")+" page-help-classes"},events:function(){return _.extend({},_.result(VBasePage.prototype,"events"),{})},instantiatePanel:function(){return new VWidgetHelpClassesPanel({templateAttrs:{}})}}),VPageHelpContact=VBasePageHelp.extend({id:"page-help-general",tabActiveName:"contact",className:function(){return _.result(VBasePage.prototype,"className")+" page-help-contact"},events:function(){return _.extend({},_.result(VBasePage.prototype,"events"),{})},instantiateForm:function(a){return new VWidgetHelpFormContact({pageSettings:a})}}),VPageHelpFlashcards=VBasePageHelp.extend({id:"page-help-flashcards",tabActiveName:"flashcards",className:function(){return _.result(VBasePage.prototype,"className")+" page-help-flashcards"},events:function(){return _.extend({},_.result(VBasePage.prototype,"events"),{})},instantiatePanel:function(){return new VWidgetHelpFlashcardsPanel({templateAttrs:{}})}}),VPageHelpGeneral=VBasePageHelp.extend({id:"page-help-general",tabActiveName:"general",className:function(){return _.result(VBasePage.prototype,"className")+" page-help-general"},events:function(){return _.extend({},_.result(VBasePage.prototype,"events"),{})},instantiatePanel:function(){return new VWidgetHelpGeneralPanel({templateAttrs:{}})}}),VPageHelpGroups=VBasePageHelp.extend({id:"page-help-groups",tabActiveName:"groups",className:function(){return _.result(VBasePage.prototype,"className")+" page-help-groups"},events:function(){return _.extend({},_.result(VBasePage.prototype,"events"),{})},instantiatePanel:function(){return new VWidgetHelpGroupsPanel({templateAttrs:{}})}}),VPageHelpStudying=VBasePageHelp.extend({id:"page-help-studying",tabActiveName:"studying",className:function(){return _.result(VBasePage.prototype,"className")+" page-help-studying"},events:function(){return _.extend({},_.result(VBasePage.prototype,"events"),{})},instantiatePanel:function(){return new VWidgetHelpStudyingPanel({templateAttrs:{}})}}),VPageHelpTests=VBasePageHelp.extend({id:"page-help-tests",tabActiveName:"tests",className:function(){return _.result(VBasePage.prototype,"className")+" page-help-tests"},events:function(){return _.extend({},_.result(VBasePage.prototype,"events"),{})},instantiatePanel:function(){return new VWidgetHelpTestsPanel({templateAttrs:{}})}}),VSectionHelp=VBaseSection.extend({id:"section-help",sectionTemplateID:"tpl-section-user",headerTemplateID:"tpl-section-header-user",headerElement:"div.section-header",pageElement:"div.section-page",menuClassNameActive:"help",className:function(){return _.result(VBaseSection.prototype,"className")+" section-help"},events:function(){return _.extend({},_.result(VBaseSection.prototype,"events"),{})},setURL:function(){return null},instantiatePageView:function(a,b){var c=null;switch(a.pageName){case"general":c=new VPageHelpGeneral(a,b);break;case"classes":c=new VPageHelpClasses(a,b);break;case"studying":c=new VPageHelpStudying(a,b);break;case"groups":c=new VPageHelpGroups(a,b);break;case"flashcards":c=new VPageHelpFlashcards(a,b);break;case"tests":c=new VPageHelpTests(a,b);break;case"contact":c=new VPageHelpContact(a,b)}return c}}),VWidgetHelpGeneralPanel=VBaseWidgetPanel.extend({id:"widget-help-general-panel",templateID:"tpl-widget-help-general-panel",className:function(){return _.result(VBaseWidgetPanel.prototype,"className")+" widget-help-general-panel"},events:function(){return _.extend({},_.result(VBaseWidgetPanel.prototype,"events"),{})}}),VWidgetHelpClassesPanel=VBaseWidgetPanel.extend({id:"widget-help-classes-panel",templateID:"tpl-widget-help-classes-panel",className:function(){return _.result(VBaseWidgetPanel.prototype,"className")+" widget-help-classes-panel"},events:function(){return _.extend({},_.result(VBaseWidgetPanel.prototype,"events"),{})}}),VWidgetHelpStudyingPanel=VBaseWidgetPanel.extend({id:"widget-help-studying-panel",templateID:"tpl-widget-help-studying-panel",className:function(){return _.result(VBaseWidgetPanel.prototype,"className")+" widget-help-studying-panel"},events:function(){return _.extend({},_.result(VBaseWidgetPanel.prototype,"events"),{})}}),VWidgetHelpGroupsPanel=VBaseWidgetPanel.extend({id:"widget-help-groups-panel",templateID:"tpl-widget-help-groups-panel",className:function(){return _.result(VBaseWidgetPanel.prototype,"className")+" widget-help-groups-panel"},events:function(){return _.extend({},_.result(VBaseWidgetPanel.prototype,"events"),{})}}),VWidgetHelpFlashcardsPanel=VBaseWidgetPanel.extend({id:"widget-help-flashcards-panel",templateID:"tpl-widget-help-flashcards-panel",className:function(){return _.result(VBaseWidgetPanel.prototype,"className")+" widget-help-flashcards-panel"},events:function(){return _.extend({},_.result(VBaseWidgetPanel.prototype,"events"),{})}}),VWidgetHelpTestsPanel=VBaseWidgetPanel.extend({id:"widget-help-tests-panel",templateID:"tpl-widget-help-tests-panel",className:function(){return _.result(VBaseWidgetPanel.prototype,"className")+" widget-help-tests-panel"},events:function(){return _.extend({},_.result(VBaseWidgetPanel.prototype,"events"),{})}}),VWidgetHelpFormContact=VBaseWidgetForm.extend({id:"widget-help-form-contact",templateID:"tpl-widget-help-form-contact",formName:"register",successAlertText:function(){return"Your email has been sent. Thank you for the feedback!"},className:function(){return _.result(VBaseWidgetForm.prototype,"className")+" widget-help-form-contact"},events:function(){return _.extend({},_.result(VBaseWidgetForm.prototype,"events"),{})},clearFormFields:function(){this.$("textarea").prop("disabled",!0),this.$("select").prop("disabled",!0),this.$("button").prop("disabled",!0)},prepareForm:function(){},getFormAttrs:function(){var a=this.jqoForm.serialize_object();return a.subject=$.trim(a.subject),a.message=$.trim(a.message),a},validateAttrs:function(a){return!a.message||a.message.length<10?{msg:"<strong>Message</strong>: Please enter a message",field:"message"}:(Spinner.get().show({msg:"Sending message...",opacity:0}),$.ajax({url:app.JS_ROOT+"ajax/manual.php/help/message",type:"POST",dataType:"json",contentType:"application/json",data:JSON.stringify(a),processData:!1,context:this,beforeSend:function(a){a.setRequestHeader("SESSIONTOKEN",app.store.get("user").token)}}).done(function(a){this.onAttrsValid(a),Spinner.get().hide()}).fail(function(a,b,c){Spinner.get().hide(function(){app.dealWithAjaxFail(a,b,c)})}),null)}}),VPageLogout=VBasePage.extend({id:"page-logout",pageTemplateID:"tpl-page",contentTemplateID:"tpl-page-logout",footerTemplateID:"tpl-page-footer-welcome",contentElement:"div.page-content",footerElement:"div.page-footer",panelElement:"div.page-content > div.content > div.content-panel",className:function(){return _.result(VBasePage.prototype,"className")+" page-logout"},events:function(){return _.extend({},_.result(VBasePage.prototype,"events"),{})},initialize:function(a,b){this.profileView=new VWidgetLogoutPanel({templateAttrs:app.store.get("user")}),this.timer=null,VBasePage.prototype.initialize.call(this,a,b)},loadData:function(){Spinner.get().show({msg:"Logging out...",opacity:0}),$.ajax({url:app.JS_ROOT+"ajax/account.php/logout",type:"POST",dataType:"json",contentType:"application/json",data:JSON.stringify(app.store.get("user")),processData:!1,context:this,beforeSend:function(a){a.setRequestHeader("SESSIONTOKEN",app&&app.store.has("user")?app.store.get("user").token:"unspecified")}}).done(function(){Spinner.get().hide(function(){this.ready(),this.timer=$.timer(function(){this.timer.stop(),app.router.navigate("login/",{trigger:!0})}.bind(this)),this.timer.set({time:1e4,autostart:!0})}.bind(this))}).fail(function(a,b,c){Spinner.get().hide(function(){app.dealWithAjaxFail(a,b,c)})}).always(function(){app.cleanupSession(!0)})},remove:function(){return this.timer&&this.timer.stop(),this.stopListening(this.profileView),this.timer=null,this.profileView=null,VBasePage.prototype.remove.call(this)},render:function(){return VBasePage.prototype.render.call(this),this.$(this.panelElement).html(this.profileView.render().$el),this}}),VSectionLogout=VBaseSection.extend({id:"section-logout",sectionTemplateID:"tpl-section-user",headerTemplateID:"tpl-section-header-user",headerElement:"div.section-header",pageElement:"div.section-page",menuClassNameActive:"logout",className:function(){return _.result(VBaseSection.prototype,"className")+" section-logout"},events:function(){return _.extend({},_.result(VBaseSection.prototype,"events"),{})},setURL:function(){return null},instantiatePageView:function(a,b){return new VPageLogout(a,b)}}),VWidgetLogoutPanel=VBaseWidgetPanel.extend({className:void 0,templateID:"tpl-widget-logout-panel",className:function(){return _.result(VBaseWidgetPanel.prototype,"className")+" widget-logout-panel"},events:function(){return _.extend({},_.result(VBaseWidgetPanel.prototype,"events"),{})}}),VSectionBrowserfail=Backbone.View.extend({tagName:"div",id:"section-page-browserfail",className:"section section-page-browserfail",initialize:function(a,b){b(this)},render:function(){var a={},b=_.template($("#tpl-section-page-browserfail").html(),_.extend({},a,{ROOT:app.JS_ROOT}));return this.$el.html(b),this}}),VPageNotfound=VBasePage.extend({id:"page-notfound",pageTemplateID:"tpl-page",contentTemplateID:void 0,footerTemplateID:"tpl-page-footer-user",contentElement:"div.page-content",footerElement:"div.page-footer",className:function(){return _.result(VBasePage.prototype,"className")+" page-notfound"},events:function(){return _.extend({},_.result(VBasePage.prototype,"events"),{})},initialize:function(a,b){this.panelView=new VWidgetNotfoundPanel({templateAttrs:{}}),VBasePage.prototype.initialize.call(this,a,b)},remove:function(){return this.stopListening(this.panelView),this.panelView=null,VBasePage.prototype.remove.call(this)},render:function(){return VBasePage.prototype.render.call(this),this.$(this.contentElement).html(this.panelView.render().$el),this}}),VSectionNotfound=VBaseSection.extend({id:"section-notfound",sectionTemplateID:"tpl-section-user",headerTemplateID:"tpl-section-header-user",headerElement:"div.section-header",pageElement:"div.section-page",menuClassNameActive:void 0,className:function(){return _.result(VBaseSection.prototype,"className")+" section-error"},events:function(){return _.extend({},_.result(VBaseSection.prototype,"events"),{})},setURL:function(){return null},instantiatePageView:function(a,b){return new VPageNotfound(a,b)}}),VWidgetNotfoundPanel=VBaseWidgetPanel.extend({templateID:"tpl-widget-notfound-panel",className:function(){return _.result(VBaseWidgetPanel.prototype,"className")+" widget-notfound-panel"},events:function(){return _.extend({},_.result(VBaseWidgetPanel.prototype,"events"),{})}}),VBasePageBrowse=VBasePage.extend({id:void 0,pageTemplateID:"tpl-page",contentTemplateID:"tpl-page-browse-content",footerTemplateID:"tpl-page-footer-user",contentElement:"div.page-content",footerElement:"div.page-footer",className:function(){return _.result(VBasePage.prototype,"className")+" page-browse"},breadcrumbElement:"div.page-content > div.content-breadcrumb",toolbarElement:"div.page-content > div.content-toolbar",formElement:"div.page-content > div.content-form",listElement:"div.page-content > div.content-list",events:function(){return _.extend({},_.result(VBasePage.prototype,"events"),{})},initialize:function(a,b){this.breadcrumbView=null,this.toolbarView=null,this.formView=null,this.listView=null,this.savedToolbarButtonState=null,VBasePage.prototype.initialize.call(this,a,b)},loadData:function(){this.ready()},getContentAttributes:function(){return{heading:void 0}},ready:function(){if(this.breadcrumbView=this.instantiateBreadcrumbView(),this.breadcrumbView){if(!this.breadcrumbView.hasValidCrumbs())return this.trigger("onPageFailed",this),void 0;this.breadcrumbView.listenTo(this,"cleanup",this.breadcrumbView.remove),this.listenTo(this.breadcrumbView,"onClickCrumb",this.onClickBreadcrumb)}this.toolbarView=this.instantiateToolbarView(),this.toolbarView&&(this.toolbarView.listenTo(this,"cleanup",this.toolbarView.remove),this.listenTo(this.toolbarView,"onClickToolbar",this.onClickToolbar)),this.listView=this.instantiateListView(),this.listView.listenTo(this,"cleanup",this.listView.remove),this.listenTo(this.listView,"onClickRecord",this.onClickRecord),this.trigger("onPageReady",this)},instantiateBreadcrumbView:function(){return null},instantiateToolbarView:function(){return null},setDefaultToolbarEnabled:function(){},remove:function(){return this.stopListening(),this.savedToolbarButtonState=null,this.breadcrumbView=null,this.toolbarView=null,this.listView=null,this.formView=null,VBasePage.prototype.remove.call(this)},render:function(){return VBasePage.prototype.render.call(this),this.breadcrumbView&&this.$(this.breadcrumbElement).html(this.breadcrumbView.render().$el),this.toolbarView&&(this.$(this.toolbarElement).html(this.toolbarView.render().$el),this.setDefaultToolbarEnabled()),this.$(this.listElement).html(this.listView.render().$el),this},refresh:function(a){this.trigger("setPage",{urlIDs:this.settings.urlIDs},null,a)},displayForm:function(a,b,c){this.formView&&(this.stopListening(this.formView),this.formView=null),this.formView=this.instantiateFormView(a,b,c),this.listenTo(this.formView,"onFormSubmit",this.onFormSubmit),this.listenTo(this.formView,"onFormCancel",this.onFormCancel),this.formView.listenTo(this,"cleanup",this.formView.remove),this.$(this.formElement).html(this.formView.render().$el),this.disableToolbarFormButtons()},closeForm:function(){this.stopListening(this.formView),this.formView.remove(),this.formView=null,this.reEnableToolbarFormButtons()},onFormSubmit:function(){this.closeForm()},onFormCancel:function(){this.closeForm()}}),VBaseWidgetBrowseFormFilter=VBaseWidgetForm.extend({id:void 0,templateID:"tpl-widget-browse-form-filter",successAlertText:void 0,formName:"filter",className:function(){return _.result(VBaseWidgetForm.prototype,"className")+" widget-browse-form-filter"},events:function(){return _.extend({},_.result(VBaseWidgetForm.prototype,"events"),{})},remove:function(){return this.ws_keywords=null,this.ws_tags=null,VBaseWidgetForm.prototype.remove.call(this)},prepareForm:function(){this.ws_keywords=new WSelect2({elem:this.jqoForm.find("input[name=keywords]"),makeElement:null,filterSelection:function(a){return $.trim(a.text).toLowerCase()}}),this.ws_keywords.init({tags:[],defaultTags:app.store.has("card.filter.keywords")?app.store.get("card.filter.keywords"):[],preventNew:!1,tokenSeparators:[","," "]}),this.ws_tags=new WSelect2({elem:this.jqoForm.find("input[name=tags]"),makeElement:null,filterSelection:null}),this.ws_tags.init({tags:_.map(app.store.get("card.tags"),function(a){return{id:a.id,text:a.tag_text}}),defaultTags:[],preventNew:!0}),app.store.has("card.filter.tags")&&this.ws_tags.set(app.store.get("card.filter.tags"))},clearFormFields:function(){},getFormAttrs:function(){var a={};return a.keywords=_.pluck(this.ws_keywords.getSelection(),"text"),a.tags=_.map(_.sortBy(this.ws_tags.getSelection(),function(a){return a.text}),function(a){return a.id}),a},validateAttrs:function(a){if(a.keywords&&a.keywords.length){var b=_.uniq(a.keywords);if(b.length!==a.keywords.length)return{msg:"<strong>Keywords</strong>: No duplicates",field:"keywords"}}if(a.tags&&a.tags.length){var c=_.uniq(a.tags);if(c.length!==a.tags.length)return{msg:"<strong>Tags</strong>: No duplicates",field:"tags"}}}}),VSectionStudyingBrowse=VBaseSection.extend({id:"section-studying",sectionTemplateID:"tpl-section-user",headerTemplateID:"tpl-section-header-user",headerElement:"div.section-header",pageElement:"div.section-page",menuClassNameActive:"studying",className:function(){return _.result(VBaseSection.prototype,"className")+" section-studying"},events:function(){return _.extend({},_.result(VBaseSection.prototype,"events"),{})},setURL:function(a){var c="studying/browse/",d=a.urlIDs;for(id in d)if("undefined"!==$.gettype(d[id]).base){if("tID"===id){if("cards"!==d[id]&&"tests"!==d[id])return!1;continue}if("gID"===id&&("self"===d[id]||"pub"===d[id]))continue;if(d[id]=+d[id],"number"!==$.gettype(d[id]).base)return!1}return!d.mID&&d.gID||!d.gID&&d.uID||!d.uID&&d.tID||!d.tID&&d.sID||"tests"===d.tID&&d.sID?!1:("self"===d.gID&&d.uID!==app.store.get("user").id&&(d.uID=app.store.get("user").id),c+=d.mID?"m"+d.mID+"/":"",c+=d.gID?"g"+d.gID+"/":"",c+=d.uID?"u"+d.uID+"/":"",c+=d.tID?d.tID+"/":"",c+=d.sID?"s"+d.sID+"/":"")},instantiatePageView:function(a,b){var c=a.urlIDs,d=null;return c.sID?d=new VPageStudyingBrowseCards(a,b):c.tID?"cards"===c.tID?d=new VPageStudyingBrowseSets(a,b):"tests"===c.tID&&(d=new VPageStudyingBrowseTests(a,b)):d=c.uID?new VPageStudyingBrowseTypes(a,b):c.gID?new VPageStudyingBrowseUsers(a,b):c.mID?new VPageStudyingBrowseGroups(a,b):new VPageStudyingBrowseModules(a,b),d}}),VPageStudyingBrowseModules=VBasePageBrowse.extend({id:"page-studying-browse-modules",className:function(){return _.result(VBasePageBrowse.prototype,"className")+" page-studying-browse-modules"},events:function(){return _.extend({},_.result(VBasePageBrowse.prototype,"events"),{})},remove:function(){return this.listData=null,VBasePageBrowse.prototype.remove.call(this)},render:function(){VBasePageBrowse.prototype.render.call(this);var a=this.$("div.sb-footer div.help a").prop("href");return this.$("div.sb-footer div.help a").prop("href",a+"classes/"),this},loadData:function(){this.listData=null,Spinner.get().show({msg:"Loading classes...",opacity:0}),$.ajax({url:app.JS_ROOT+"ajax/studying/studying-other.php/enrollment",type:"POST",dataType:"json",data:JSON.stringify({includeCompleted:app.store.has("modules.show_completed")}),contentType:"application/json",context:this,beforeSend:function(a){a.setRequestHeader("SESSIONTOKEN",app&&app.store.has("user")?app.store.get("user").token:"unspecified")}}).done(function(a){this.listData=a.enrollment,this.ready()}).fail(function(a,b,c){Spinner.get().hide(function(){app.dealWithAjaxFail(a,b,c)})})},getContentAttributes:function(){return{heading:"Pick a Class"}},instantiateToolbarView:function(){return new VWidgetStudyingBrowseModulesToolbar},instantiateListView:function(){return new VWidgetStudyingBrowseModulesList({listData:this.listData})},setDefaultToolbarEnabled:function(){this.toolbarView.setEnabled({display:!0});var a=app.store.has("modules.show_completed");this.toolbarView.getButton("display_completed").html(a?"Hide Completed":"Show Completed")},onClickToolbar:function(a){if(-1!==a.indexOf("display")&&"display_completed"===a){var d=app.store.has("modules.show_completed");d?app.store.rem("modules.show_completed"):app.store.set("modules.show_completed",!0),app.saveUserSettings(),this.refresh()}},onClickRecord:function(a){this.trigger("setPage",{urlIDs:_.extend({},this.settings.urlIDs,{mID:a.module_id}),containerAttributes:a})}}),VWidgetStudyingBrowseModulesList=VBaseWidgetList.extend({id:"widget-studying-browse-modules-list",className:function(){return _.result(VBaseWidgetList.prototype,"className")+" widget-studying-browse-modules-list"},events:function(){return _.extend({},_.result(VBaseWidgetList.prototype,"events"),{})},instantiateCollection:function(){return new EnrollmentCollection},instantiateModel:function(){return new EnrollmentModel},instantiateWidgetRecordEditable:function(a,b){return new VWidgetStudyingBrowseModulesRecordEditable(a,b)}}),VWidgetStudyingBrowseModulesRecordEditableDisplay=VBaseWidgetRecordEditableDisplay.extend({id:void 0,templateID:"tpl-widget-studying-browse-modules-record-editable-display",className:function(){return _.result(VBaseWidgetRecordEditableDisplay.prototype,"className")+" widget-studying-browse-modules-record-editable-display"},events:function(){return _.extend({},_.result(VBaseWidgetRecordEditableDisplay.prototype,"events"),{})}}),VWidgetStudyingBrowseModulesRecordEditable=VBaseWidgetRecordEditable.extend({id:void 0,templateID:"tpl-widget-studying-browse-modules-record-editable",className:function(){return _.result(VBaseWidgetRecordEditable.prototype,"className")+" widget-studying-browse-modules-record-editable"},events:function(){return _.extend({},_.result(VBaseWidgetRecordEditable.prototype,"events"),{})},updateModelURL:function(){},instantiateToolbarView:function(){return null},instantiateDisplayView:function(a,b){return new VWidgetStudyingBrowseModulesRecordEditableDisplay(a,b)},instantiateEditView:function(){return null}}),VWidgetStudyingBrowseModulesToolbar=VBaseWidgetToolbar.extend({id:"widget-studying-browse-modules-toolbar",templateID:"tpl-widget-studying-browse-modules-toolbar",className:function(){return _.result(VBaseWidgetToolbar.prototype,"className")+" widget-studying-browse-modules-toolbar"},events:function(){return _.extend({},_.result(VBaseWidgetToolbar.prototype,"events"),{})}}),VPageStudyingBrowseGroups=VBasePageBrowse.extend({id:"page-studying-browse-groups",className:function(){return _.result(VBasePageBrowse.prototype,"className")+" page-studying-browse-groups"},events:function(){return _.extend({},_.result(VBasePageBrowse.prototype,"events"),{})},remove:function(){return this.listData=null,this.breadcrumb=null,VBasePageBrowse.prototype.remove.call(this)},render:function(){VBasePageBrowse.prototype.render.call(this);var a=this.$("div.sb-footer div.help a").prop("href");return this.$("div.sb-footer div.help a").prop("href",a+"studygroups/"),this},loadData:function(){this.listData=null,this.breadcrumb=null,Spinner.get().show({msg:"Loading groups...",opacity:0}),$.ajax({url:app.JS_ROOT+"ajax/studying/groups-manual.php/fetch/"+this.settings.urlIDs.mID,type:"POST",dataType:"json",data:JSON.stringify({code:app.store.has("groups.code")?app.store.get("groups.code"):null}),contentType:"application/json",context:this,beforeSend:function(a){a.setRequestHeader("SESSIONTOKEN",app&&app.store.has("user")?app.store.get("user").token:"unspecified")}}).done(function(a){var d={id:"self",num_members:1,is_user_member:!0,is_user_owner:!0};this.listData=[d].concat(a.groups),this.breadcrumb=a.breadcrumb,this.ready()}).fail(function(a,b,c){Spinner.get().hide(function(){app.dealWithAjaxFail(a,b,c)})})},getContentAttributes:function(){return{heading:"Groups"}},instantiateBreadcrumbView:function(){return new VWidgetStudyingBrowseGroupsBreadcrumb({data:this.breadcrumb})},instantiateToolbarView:function(){return new VWidgetStudyingBrowseGroupsToolbar},instantiateListView:function(){return new VWidgetStudyingBrowseGroupsList({listData:this.listData,urlIDs:this.settings.urlIDs},{})},instantiateFormView:function(a,b,c){var d=null;switch(a){case"code":d=new VWidgetStudyingBrowseGroupsFormCode(b,c)}return d},setDefaultToolbarEnabled:function(){this.toolbarView.setEnabled({code:!0,add:!0});var a=app.store.get("groups.code");a&&this.toolbarView.getButton("code").removeClass("btn-default").addClass("btn-info")},disableToolbarFormButtons:function(){this.savedToolbarButtonState=this.toolbarView.getEnabled(),this.toolbarView.setEnabled({code:!1,add:!1})},reEnableToolbarFormButtons:function(){this.toolbarView.setEnabled(this.savedToolbarButtonState),this.savedToolbarButtonState=null},onClickBreadcrumb:function(a){this.trigger("setPage",{urlIDs:a.urlIDs})},onClickRecord:function(a){var b=_.extend({},this.settings.urlIDs,{gID:a.id});"self"===b.gID&&(b.uID=app.store.get("user").id),this.trigger("setPage",{urlIDs:b,containerAttributes:a})},onClickToolbar:function(a){"code"===a?this.displayForm("code"):"add"===a&&bsDialog.create({title:"Create Studygroup",msg:"<p>Do you want to create a private studygroup for this class?</p>",ok:function(){$.ajax({url:app.JS_ROOT+"ajax/studying/groups-manual.php/create/"+this.settings.urlIDs.mID,type:"POST",dataType:"json",data:JSON.stringify({code:$.leftovers.parse.generate_random_string(6,!1,!0,!0)}),contentType:"application/json",context:this,beforeSend:function(a){a.setRequestHeader("SESSIONTOKEN",app&&app.store.has("user")?app.store.get("user").token:"unspecified")}}).done(function(a){this.listView.trigger("onExternalAdd",a,{})}).fail(function(a,b,c){Spinner.get().hide(function(){var d=app.getAjaxUserError(a);400===a.status&&d&&"owner"===d.type?bsDialog.create({title:"Error!",msg:"<p>You are already the owner of a studygroup for this class. To create another one you'll have to leave that group first.</p>",ok:function(){}}):app.dealWithAjaxFail(a,b,c)})})}.bind(this),cancel:function(){}})},onFormSubmit:function(a,b){switch(a){case"code":var d=app.store.has("groups.code");app.store.rem("groups.code"),b.code.length?(app.store.set("groups.code",b.code),this.refresh()):d?this.refresh():this.closeForm()}}}),VWidgetStudyingBrowseGroupsBreadcrumb=VBaseWidgetBreadcrumb.extend({id:"widget-studying-browse-groups-breadcrumb",templateID:"tpl-widget-studying-browse-groups-breadcrumb",className:function(){return _.result(VBaseWidgetBreadcrumb.prototype,"className")+" breadcrumb widget-studying-browse-groups-breadcrumb"},events:function(){return _.extend({},_.result(VBaseWidgetBreadcrumb.prototype,"events"),{})},generateCrumbs:function(a){var b=null,c=[],d={};return(b=_.find(a,function(a){return"moduleID"===a.crumbName}))?(d.crumbDisplay=b.subject_code+" "+b.class_code+" ("+b.semester_name+", "+b.year+")",d.crumbDisplay=$.leftovers.parse.crop_string(d.crumbDisplay,40),d.crumbHref=app.JS_ROOT+"#studying/browse/",d.crumbData={urlIDs:{}},c.push(d),c):null}}),VWidgetStudyingBrowseGroupsFormCode=VBaseWidgetForm.extend({id:"widget-studying-browse-groups-form-code",templateID:"tpl-widget-studying-browse-groups-form-code",successAlertText:void 0,formName:"code",className:function(){return _.result(VBaseWidgetForm.prototype,"className")+" widget-studying-browse-groups-form-code"},events:function(){return _.extend({},_.result(VBaseWidgetForm.prototype,"events"),{"click button[name=button_clear]":"onClickClear"})},prepareForm:function(){app.store.has("groups.code")||this.jqoForm.find("button[name=button_clear]").prop("disabled",!0)},onClickClear:function(){this.jqoForm.find("input[name=code]").val(""),this.onClickSave(null)},getDefaultAttrsForTemplate:function(){return{code:app.store.get("groups.code")}},getFormAttrs:function(){var a={};return a=this.jqoForm.serialize_object()},validateAttrs:function(){}}),VWidgetStudyingBrowseGroupsList=VBaseWidgetList.extend({id:"widget-studying-browse-groups-list",className:function(){return _.result(VBaseWidgetList.prototype,"className")+" widget-studying-browse-groups-list"},events:function(){return _.extend({},_.result(VBaseWidgetList.prototype,"events"),{})},instantiateCollection:function(){return new GroupsCollection},instantiateModel:function(){return new GroupModel},onAddCollection:function(a,b,c){var d=VBaseWidgetList.prototype.onAddCollection.call(this,a,b,c);this.listenTo(d,"onRecordJoin",this.onRecordJoin),this.listenTo(d,"onRecordLeave",this.onRecordLeave)},onRecordJoin:function(a){Spinner.get().show({msg:"Joining group...",opacity:0}),$.ajax({url:app.JS_ROOT+"ajax/studying/groups-manual.php/join/"+this.settings.urlIDs.mID+"/"+a.model.get("id"),type:"POST",dataType:"json",data:JSON.stringify({code:app.store.has("groups.code")?app.store.get("groups.code"):null}),contentType:"application/json",context:this,beforeSend:function(a){a.setRequestHeader("SESSIONTOKEN",app&&app.store.has("user")?app.store.get("user").token:"unspecified")}}).done(function(){a.model.set({num_members:a.model.get("num_members")+1,is_user_member:!0}),this.collection.sort({sbTargetModel:a.model,sbPrevIdx:-1}),Spinner.get().hide()}).fail(function(a,b,c){Spinner.get().hide(function(){app.dealWithAjaxFail(a,b,c)})})},onRecordLeave:function(a){this.clearSelected(),a.makeSelected(),bsDialog.create({title:"Leave Group",msg:"<p>Are you sure you want to leave this group?</p>",ok:function(){Spinner.get().show({msg:"Leaving group...",opacity:0}),$.ajax({url:app.JS_ROOT+"ajax/studying/groups-manual.php/leave/"+this.settings.urlIDs.mID+"/"+a.model.get("id"),type:"POST",dataType:"json",data:JSON.stringify({code:a.model.get("code")}),contentType:"application/json",context:this,beforeSend:function(a){a.setRequestHeader("SESSIONTOKEN",app&&app.store.has("user")?app.store.get("user").token:"unspecified")}}).done(function(b){b&&b.code===app.store.get("groups.code")?(this.collection.sort({sbTargetModel:a.model,sbPrevIdx:-1}),a.removeSelected()):this.collection.remove(a.model),Spinner.get().hide()}).fail(function(a,b,c){Spinner.get().hide(function(){app.dealWithAjaxFail(a,b,c)})})}.bind(this),cancel:function(){a.removeSelected()}.bind(this)})
},instantiateWidgetRecordEditable:function(a,b){return new VWidgetStudyingBrowseGroupsRecordEditable(a,b)}}),VWidgetStudyingBrowseGroupsRecordEditableDisplay=VBaseWidgetRecordEditableDisplay.extend({id:void 0,templateID:"tpl-widget-studying-browse-groups-record-editable-display",className:function(){return _.result(VBaseWidgetRecordEditableDisplay.prototype,"className")+" widget-studying-browse-groups-record-editable-display"},events:function(){return _.extend({},_.result(VBaseWidgetRecordEditableDisplay.prototype,"events"),{})}}),VWidgetStudyingBrowseGroupsRecordEditableEdit=VBaseWidgetRecordEditableEdit.extend({id:void 0,templateID:"tpl-widget-studying-browse-groups-record-editable-edit",className:function(){return _.result(VBaseWidgetRecordEditableEdit.prototype,"className")+" widget-studying-browse-groups-record-editable-edit"},events:function(){return _.extend({},_.result(VBaseWidgetRecordEditableEdit.prototype,"events"),{"click button[name=button_generate]":"onClickGenerate"})},remove:function(){return this.ws_sharing=null,VBaseWidgetRecordEditableEdit.prototype.remove.call(this)},getFormAttrs:function(){var a=this.jqoForm.serialize_object();return a.code=this.jqoForm.find("input[name=code]").val(),a},onClickGenerate:function(){var b=$.leftovers.parse.generate_random_string(6,!1,!0,!0);this.jqoForm.find("input[name=code]").val(b)}}),VWidgetStudyingBrowseGroupsRecordEditable=VBaseWidgetRecordEditable.extend({id:void 0,templateID:"tpl-widget-studying-browse-groups-record-editable",className:function(){return _.result(VBaseWidgetRecordEditable.prototype,"className")+" widget-groups-studying-groups-record-editable"},events:function(){return _.extend({},_.result(VBaseWidgetRecordEditable.prototype,"events"),{})},updateModelURL:function(){this.settings.model.urlRoot=this.settings.model.baseUrlRoot+"/"+this.settings.listSettings.urlIDs.mID},setToolbarButtonsEnabled:function(){VBaseWidgetRecordEditable.prototype.setToolbarButtonsEnabled.call(this),this.isEditing||this.settings.model.get("id")!==+this.settings.model.get("id")?this.toolbarView.setEnabled({members:"self"!==this.settings.model.get("id")}):this.toolbarView.setEnabled({edit:this.settings.model.get("owner_id")===app.store.get("user").id,join:!this.settings.model.get("is_user_member"),leave:this.settings.model.get("is_user_member"),members:!0})},instantiateToolbarView:function(){return new VWidgetStudyingBrowseGroupsRecordEditableToolbar},instantiateDisplayView:function(a,b){return new VWidgetStudyingBrowseGroupsRecordEditableDisplay(a,b)},instantiateEditView:function(a,b){return new VWidgetStudyingBrowseGroupsRecordEditableEdit(a,b)},onClickToolbar:function(a,b,c){if(VBaseWidgetRecordEditable.prototype.onClickToolbar.call(this,a,c),"join"===a)this.trigger("onRecordJoin",this);else if("leave"===a)this.trigger("onRecordLeave",this);else if("members"===a){for(var d="<ul class='list-group'>",e=this.settings.model.get("members"),f=0;f<e.length;f++)d+="<li class='list-group-item'>"+e[f].full_name+"</li>";d+="</ul>",bsDialog.create({title:"Group Members",msg:d,ok:function(){}})}}}),VWidgetStudyingBrowseGroupsRecordEditableToolbar=VBaseWidgetToolbar.extend({id:void 0,templateID:"tpl-widget-studying-browse-groups-record-editable-toolbar",className:function(){return _.result(VBaseWidgetToolbar.prototype,"className")+" widget-studying-browse-groups-record-editable-toolbar"},events:function(){return _.extend({},_.result(VBaseWidgetToolbar.prototype,"events"),{})}}),VWidgetStudyingBrowseGroupsToolbar=VBaseWidgetToolbar.extend({id:"widget-studying-browse-groups-toolbar",templateID:"tpl-widget-studying-browse-groups-toolbar",className:function(){return _.result(VBaseWidgetToolbar.prototype,"className")+" widget-studying-browse-groups-toolbar"},events:function(){return _.extend({},_.result(VBaseWidgetToolbar.prototype,"events"),{})}}),VPageStudyingBrowseUsers=VBasePageBrowse.extend({id:"page-studying-browse-users",className:function(){return _.result(VBasePageBrowse.prototype,"className")+" page-studying-browse-users"},events:function(){return _.extend({},_.result(VBasePageBrowse.prototype,"events"),{})},remove:function(){return this.listData=null,this.breadcrumb=null,VBasePageBrowse.prototype.remove.call(this)},loadData:function(){this.listData=null,this.breadcrumb=null,Spinner.get().show({msg:"Loading users...",opacity:0}),$.ajax({url:app.JS_ROOT+"ajax/studying/studying-other.php/users/"+this.settings.urlIDs.mID+"/"+this.settings.urlIDs.gID,type:"POST",dataType:"json",data:JSON.stringify({includeAuto:!app.store.has("tests.hide_auto"),filter:{keywords:app.store.get("card.filter.keywords"),tags:app.store.get("card.filter.tags")}}),contentType:"application/json",context:this,beforeSend:function(a){a.setRequestHeader("SESSIONTOKEN",app&&app.store.has("user")?app.store.get("user").token:"unspecified")}}).done(function(a){this.listData=a.users,this.breadcrumb=a.breadcrumb,this.ready()}).fail(function(a,b,c){Spinner.get().hide(function(){app.dealWithAjaxFail(a,b,c)})})},getContentAttributes:function(){return{heading:"Students"}},instantiateBreadcrumbView:function(){return new VWidgetStudyingBrowseUsersBreadcrumb({data:this.breadcrumb})},instantiateToolbarView:function(){return new VWidgetStudyingBrowseUsersToolbar},instantiateListView:function(){var a={};return app.store.has("flashcards.users.isAscending")&&(a.sbIsAscending=app.store.get("flashcards.users.isAscending")),app.store.has("flashcards.users.sortCriteria")&&(a.sbSortCriteria=app.store.get("flashcards.users.sortCriteria")),new VWidgetStudyingBrowseUsersList({listData:this.listData},a)},instantiateFormView:function(a,b,c){var d=null;switch(a){case"filter":d=new VWidgetStudyingBrowseUsersFormFilter(b,c)}return d},setDefaultToolbarEnabled:function(){this.toolbarView.getButton("display_sort_order").html(app.store.has("flashcards.users.isAscending")?app.store.get("flashcards.users.isAscending")?"Sort Descending":"Sort Ascending":"Sort Descending"),this.toolbarView.getButton("display_sort_criteria").html(app.store.has("flashcards.users.sortCriteria")?"name"===app.store.get("flashcards.users.sortCriteria")?"Sort By Num Cards":"Sort By Name":"Sort By Num Cards"),this.toolbarView.setEnabled({display:!0,filter:!0});var a=app.store.get("card.filter.keywords"),b=app.store.get("card.filter.tags");(a||b)&&this.toolbarView.getButton("filter").removeClass("btn-default").addClass("btn-info")},disableToolbarFormButtons:function(){this.savedToolbarButtonState=this.toolbarView.getEnabled(),this.toolbarView.setEnabled({display:!0,filter:!1})},reEnableToolbarFormButtons:function(){this.toolbarView.setEnabled(this.savedToolbarButtonState),this.savedToolbarButtonState=null},onClickBreadcrumb:function(a){this.trigger("setPage",{urlIDs:a.urlIDs})},onClickToolbar:function(a){if(-1!==a.indexOf("display")){if("display_sort_criteria"===a){var c=this.listView.collection.sortCriteria;c="name"===c?"cards":"name",app.store.set("flashcards.users.sortCriteria",c),this.refresh()}else if("display_sort_order"===a){var d=this.listView.collection.isAscending;app.store.set("flashcards.users.isAscending",!d),this.refresh()}}else if("filter_set"===a)this.displayForm("filter");else if("filter_clear"===a){var e=app.store.has("card.filter.tags")||app.store.has("card.filter.keywords");app.store.rem("card.filter",!0),e&&this.refresh()}},onClickRecord:function(a){this.trigger("setPage",{urlIDs:_.extend({},this.settings.urlIDs,{uID:a.id}),containerAttributes:a})},onFormSubmit:function(a,b){switch(a){case"filter":var d=app.store.has("card.filter.tags")||app.store.has("card.filter.keywords");app.store.rem("card.filter",!0),b.keywords.length||b.tags.length?(app.store.set("card.filter.keywords",b.keywords),app.store.set("card.filter.tags",b.tags),this.refresh()):d?this.onClickToolbar("filter_clear",null):this.closeForm()}}}),VWidgetStudyingBrowseUsersBreadcrumb=VBaseWidgetBreadcrumb.extend({id:"widget-studying-browse-users-breadcrumb",templateID:"tpl-widget-studying-browse-users-breadcrumb",className:function(){return _.result(VBaseWidgetBreadcrumb.prototype,"className")+" breadcrumb widget-studying-browse-users-breadcrumb"},events:function(){return _.extend({},_.result(VBaseWidgetBreadcrumb.prototype,"events"),{})},generateCrumbs:function(a){var b=null,c=[],d={};if(b=_.find(a,function(a){return"moduleID"===a.crumbName}),!b)return null;var e=b.module_id;d.crumbDisplay=b.subject_code+" "+b.class_code+" ("+b.semester_name+", "+b.year+")",d.crumbDisplay=$.leftovers.parse.crop_string(d.crumbDisplay,40),d.crumbHref=app.JS_ROOT+"#flashcards/",d.crumbData={urlIDs:{}},c.push(d);var d={};if(b=_.find(a,function(a){return"groupID"===a.crumbName}),!b)return null;d.crumbDisplay="self"===b.id?"My Flashcards":"pub"===b.id?"Public Studygroup":"Studygroup ("+b.created_by_first_name+")",d.crumbDisplay=$.leftovers.parse.crop_string(d.crumbDisplay,40);var f={};return"self"===b.id&&(f.uID=app.store.get("user").id),f.gID=b.id,d.crumbHref=app.JS_ROOT+"#flashcards/"+"m"+e+"/",d.crumbData={urlIDs:{mID:e}},c.push(d),c}}),VWidgetStudyingBrowseUsersFormFilter=VBaseWidgetBrowseFormFilter.extend({id:"widget-studying-browse-users-form-filter",className:function(){return _.result(VBaseWidgetBrowseFormFilter.prototype,"className")+" widget-studying-browse-users-form-filter"},events:function(){return _.extend({},_.result(VBaseWidgetBrowseFormFilter.prototype,"events"),{})}}),VWidgetStudyingBrowseUsersList=VBaseWidgetList.extend({id:"widget-studying-browse-users-list",className:function(){return _.result(VBaseWidgetList.prototype,"className")+" widget-studying-browse-users-list"},events:function(){return _.extend({},_.result(VBaseWidgetList.prototype,"events"),{})},instantiateCollection:function(){var a=new UsersCollection;return"undefined"!==$.gettype(this.options.sbIsAscending).base&&(a.isAscending=this.options.sbIsAscending),"undefined"!==$.gettype(this.options.sbSortCriteria).base&&(a.sortCriteria=this.options.sbSortCriteria),a},instantiateModel:function(){return new UserModel},instantiateWidgetRecordEditable:function(a,b){return new VWidgetStudyingBrowseUsersRecordEditable(a,b)}}),VWidgetStudyingBrowseUsersRecordEditableDisplay=VBaseWidgetRecordEditableDisplay.extend({id:"widget-studying-browse-users-record-editable-display",templateID:"tpl-widget-studying-browse-users-record-editable-display",className:function(){return _.result(VBaseWidgetRecordEditableDisplay.prototype,"className")+" widget-studying-browse-users-record-editable-display"},events:function(){return _.extend({},_.result(VBaseWidgetRecordEditableDisplay.prototype,"events"),{})}}),VWidgetStudyingBrowseUsersRecordEditable=VBaseWidgetRecordEditable.extend({id:"widget-studying-browse-users-record-editable",templateID:"tpl-widget-studying-browse-users-record-editable",className:function(){return _.result(VBaseWidgetRecordEditable.prototype,"className")+" widget-studying-browse-users-record-editable"},events:function(){return _.extend({},_.result(VBaseWidgetRecordEditable.prototype,"events"),{})},updateModelURL:function(){},instantiateToolbarView:function(){return null},instantiateDisplayView:function(a,b){return new VWidgetStudyingBrowseUsersRecordEditableDisplay(a,b)},instantiateEditView:function(){return null}}),VWidgetStudyingBrowseUsersToolbar=VBaseWidgetToolbar.extend({id:"widget-studying-browse-users-toolbar",templateID:"tpl-widget-studying-browse-users-toolbar",className:function(){return _.result(VBaseWidgetToolbar.prototype,"className")+" widget-studying-browse-users-toolbar"},events:function(){return _.extend({},_.result(VBaseWidgetToolbar.prototype,"events"),{})}}),VPageStudyingBrowseTypes=VBasePageBrowse.extend({id:"page-studying-browse-types",className:function(){return _.result(VBasePageBrowse.prototype,"className")+" page-flashcards-browse-types"},events:function(){return _.extend({},_.result(VBasePageBrowse.prototype,"events"),{})},remove:function(){return this.listData=null,this.breadcrumb=null,VBasePageBrowse.prototype.remove.call(this)},loadData:function(){this.listData=null,this.breadcrumb=null,Spinner.get().show({msg:"Loading user...",opacity:0}),$.ajax({url:app.JS_ROOT+"ajax/studying/studying-other.php/user/"+this.settings.urlIDs.mID+"/"+this.settings.urlIDs.gID+"/"+this.settings.urlIDs.uID,type:"POST",dataType:"json",data:JSON.stringify({includeAuto:!app.store.has("tests.hide_auto"),filter:{keywords:app.store.get("card.filter.keywords"),tags:app.store.get("card.filter.tags")}}),contentType:"application/json",context:this,beforeSend:function(a){a.setRequestHeader("SESSIONTOKEN",app&&app.store.has("user")?app.store.get("user").token:"unspecified")}}).done(function(a){var d={id:"cards",type_name:"Flashcards",count:a.user.num_filtered_cards},e={id:"tests",type_name:"Tests",count:a.user.num_tests};this.listData=[d,e],this.breadcrumb=a.breadcrumb,a=null,this.ready()}).fail(function(a,b,c){Spinner.get().hide(function(){app.dealWithAjaxFail(a,b,c)})})},getContentAttributes:function(){return{heading:"Content"}},instantiateBreadcrumbView:function(){return new VWidgetStudyingBrowseTypesBreadcrumb({data:this.breadcrumb})},instantiateToolbarView:function(){return new VWidgetStudyingBrowseTypesToolbar},instantiateListView:function(){return new VWidgetStudyingBrowseTypesList({listData:this.listData},{})},instantiateFormView:function(a,b,c){var d=null;switch(a){case"filter":d=new VWidgetStudyingBrowseTypesFormFilter(b,c)}return d},setDefaultToolbarEnabled:function(){this.toolbarView.setEnabled({filter:!0});var a=app.store.get("card.filter.keywords"),b=app.store.get("card.filter.tags");(a||b)&&this.toolbarView.getButton("filter").removeClass("btn-default").addClass("btn-info")},disableToolbarFormButtons:function(){this.savedToolbarButtonState=this.toolbarView.getEnabled(),this.toolbarView.setEnabled({filter:!1})},reEnableToolbarFormButtons:function(){this.toolbarView.setEnabled(this.savedToolbarButtonState),this.savedToolbarButtonState=null},onClickBreadcrumb:function(a){this.trigger("setPage",{urlIDs:a.urlIDs})},onClickToolbar:function(a){if(-1!==a.indexOf("filter"))if("filter_set"===a)this.displayForm("filter");else if("filter_clear"===a){var d=app.store.has("card.filter.tags")||app.store.has("card.filter.keywords");app.store.rem("card.filter",!0),d&&this.refresh()}},onClickRecord:function(a){this.trigger("setPage",{urlIDs:_.extend({},this.settings.urlIDs,{tID:a.id}),containerAttributes:a})},onFormSubmit:function(a,b){switch(a){case"filter":var d=app.store.has("card.filter.tags")||app.store.has("card.filter.keywords");app.store.rem("card.filter",!0),b.keywords.length||b.tags.length?(app.store.set("card.filter.keywords",b.keywords),app.store.set("card.filter.tags",b.tags),this.refresh()):d?this.onClickToolbar("filter_clear",null):this.closeForm()}}}),VWidgetStudyingBrowseTypesBreadcrumb=VBaseWidgetBreadcrumb.extend({id:"widget-studying-browse-types-breadcrumb",templateID:"tpl-widget-studying-browse-types-breadcrumb",className:function(){return _.result(VBaseWidgetBreadcrumb.prototype,"className")+" breadcrumb widget-studying-browse-types-breadcrumb"},events:function(){return _.extend({},_.result(VBaseWidgetBreadcrumb.prototype,"events"),{})},generateCrumbs:function(a){var b=null,c=[],d={};if(b=_.find(a,function(a){return"moduleID"===a.crumbName}),!b)return null;var e=b.module_id;d.crumbDisplay=b.subject_code+" "+b.class_code+" ("+b.semester_name+", "+b.year+")",d.crumbDisplay=$.leftovers.parse.crop_string(d.crumbDisplay,40),d.crumbHref=app.JS_ROOT+"#studying/browse/",d.crumbData={urlIDs:{}},c.push(d);var d={};if(b=_.find(a,function(a){return"groupID"===a.crumbName}),!b)return null;var f=b.id;d.crumbDisplay="self"===b.id?"My Stuff":"pub"===b.id?"Public Studygroup":"Studygroup ("+b.created_by_first_name+")",d.crumbDisplay=$.leftovers.parse.crop_string(d.crumbDisplay,40);var g={};if("self"===b.id&&(g.uID=app.store.get("user").id),g.gID=b.id,d.crumbHref=app.JS_ROOT+"#studying/browse/"+"m"+e+"/",d.crumbData={urlIDs:{mID:e}},c.push(d),selfCrumb=_.find(a,function(a){return"groupID"===a.crumbName&&"self"===a.id}),!selfCrumb){var d={};if(b=_.find(a,function(a){return"userID"===a.crumbName}),!b)return null;d.crumbDisplay=b.full_name,d.crumbDisplay=$.leftovers.parse.crop_string(d.crumbDisplay,40),d.crumbHref=app.JS_ROOT+"#studying/browse/"+"m"+e+"/"+"g"+f+"/",d.crumbData={urlIDs:{mID:e,gID:f}},c.push(d)}return c}}),VWidgetStudyingBrowseTypesFormFilter=VBaseWidgetBrowseFormFilter.extend({id:"widget-studying-browse-types-form-filter",className:function(){return _.result(VBaseWidgetBrowseFormFilter.prototype,"className")+" widget-studying-browse-types-form-filter"},events:function(){return _.extend({},_.result(VBaseWidgetBrowseFormFilter.prototype,"events"),{})}}),VWidgetStudyingBrowseTypesList=VBaseWidgetList.extend({id:"widget-studying-browse-types-list",className:function(){return _.result(VBaseWidgetList.prototype,"className")+" widget-studying-browse-types-list"},events:function(){return _.extend({},_.result(VBaseWidgetList.prototype,"events"),{})},instantiateCollection:function(){var a=new TypesCollection;return a},instantiateModel:function(){return new TypeModel},instantiateWidgetRecordEditable:function(a,b){return new VWidgetStudyingBrowseTypesRecordEditable(a,b)}}),VWidgetStudyingBrowseTypesRecordEditableDisplay=VBaseWidgetRecordEditableDisplay.extend({id:"widget-studying-browse-types-record-editable-display",templateID:"tpl-widget-studying-browse-types-record-editable-display",className:function(){return _.result(VBaseWidgetRecordEditableDisplay.prototype,"className")+" widget-studying-browse-types-record-editable-display"},events:function(){return _.extend({},_.result(VBaseWidgetRecordEditableDisplay.prototype,"events"),{})}}),VWidgetStudyingBrowseTypesRecordEditable=VBaseWidgetRecordEditable.extend({id:"widget-studying-browse-types-record-editable",templateID:"tpl-widget-studying-browse-types-record-editable",className:function(){return _.result(VBaseWidgetRecordEditable.prototype,"className")+" widget-studying-browse-types-record-editable"},events:function(){return _.extend({},_.result(VBaseWidgetRecordEditable.prototype,"events"),{})},updateModelURL:function(){},instantiateToolbarView:function(){return null},instantiateDisplayView:function(a,b){return new VWidgetStudyingBrowseTypesRecordEditableDisplay(a,b)},instantiateEditView:function(){return null}}),VWidgetStudyingBrowseTypesToolbar=VBaseWidgetToolbar.extend({id:"widget-studying-browse-types-toolbar",templateID:"tpl-widget-studying-browse-types-toolbar",className:function(){return _.result(VBaseWidgetToolbar.prototype,"className")+" widget-studying-browse-types-toolbar"},events:function(){return _.extend({},_.result(VBaseWidgetToolbar.prototype,"events"),{})}}),VPageStudyingBrowseSets=VBasePageBrowse.extend({id:"page-studying-browse-sets",className:function(){return _.result(VBasePageBrowse.prototype,"className")+" page-studying-browse-sets"},events:function(){return _.extend({},_.result(VBasePageBrowse.prototype,"events"),{})},remove:function(){return this.listData=null,this.breadcrumb=null,VBasePageBrowse.prototype.remove.call(this)},render:function(){VBasePageBrowse.prototype.render.call(this);var a=this.$("div.sb-footer div.help a").prop("href");return this.$("div.sb-footer div.help a").prop("href",a+"flashcards/"),this},loadData:function(){this.listData=null,this.breadcrumb=null,Spinner.get().show({msg:"Loading sets...",opacity:0}),$.ajax({url:app.JS_ROOT+"ajax/studying/sets-manual.php/fetch/"+this.settings.urlIDs.mID+"/"+this.settings.urlIDs.gID+"/"+this.settings.urlIDs.uID,type:"POST",data:JSON.stringify({filter:{keywords:app.store.get("card.filter.keywords"),tags:app.store.get("card.filter.tags")}}),dataType:"json",contentType:"application/json",context:this,beforeSend:function(a){a.setRequestHeader("SESSIONTOKEN",app&&app.store.has("user")?app.store.get("user").token:"unspecified")}}).done(function(a){this.listData=a.sets,this.breadcrumb=a.breadcrumb,this.ready()}).fail(function(a,b,c){Spinner.get().hide(function(){app.dealWithAjaxFail(a,b,c)})})},getContentAttributes:function(){return{heading:"Sets"}},instantiateBreadcrumbView:function(){return new VWidgetStudyingBrowseSetsBreadcrumb({data:this.breadcrumb})},instantiateToolbarView:function(){return new VWidgetStudyingBrowseSetsToolbar},instantiateListView:function(){var a={};return app.store.has("sets.isAscending")&&(a.sbIsAscending=app.store.get("sets.isAscending")),app.store.has("sets.sortCriteria")&&(a.sbSortCriteria=app.store.get("sets.sortCriteria")),new VWidgetStudyingBrowseSetsList({listData:this.listData,urlIDs:this.settings.urlIDs},a)},instantiateFormView:function(a,b,c){var d=null;switch(a){case"create":d=new VWidgetStudyingBrowseSetsFormCreate(b,c);break;case"filter":d=new VWidgetStudyingBrowseSetsFormFilter(b,c);break;case"saveTest":d=new VWidgetStudyingBrowseSetsFormSaveTest(b,c)}return d},setDefaultToolbarEnabled:function(){var a=this.settings.urlIDs.uID===app.store.get("user").id;this.toolbarView.getButton("display_sort_order").html(app.store.has("sets.isAscending")?app.store.get("sets.isAscending")?"Sort Descending":"Sort Ascending":"Sort Descending"),this.toolbarView.getButton("display_sort_criteria").html(app.store.has("sets.sortCriteria")?"name"===app.store.get("sets.sortCriteria")?"Sort By Num Cards":"Sort By Name":"Sort By Num Cards"),this.toolbarView.setEnabled({display:!0,clipboard:a,add:a,"delete":a,filter:!0,test:!0});var b=app.store.get("clipboard");if("undefined"!==$.gettype(b).base){var c=b.isCut;this.toolbarView.getButton("clipboard").removeClass("btn-default").addClass(c?"btn-danger":"btn-warning")}var d=app.store.get("card.filter.keywords"),e=app.store.get("card.filter.tags");(d||e)&&this.toolbarView.getButton("filter").removeClass("btn-default").addClass("btn-info")},disableToolbarFormButtons:function(){this.savedToolbarButtonState=this.toolbarView.getEnabled(),this.toolbarView.setEnabled({display:!0,clipboard:this.savedToolbarButtonState.clipboard,add:!1,"delete":this.savedToolbarButtonState.delete,filter:!1,test:!1})},reEnableToolbarFormButtons:function(){this.toolbarView.setEnabled(this.savedToolbarButtonState),this.savedToolbarButtonState=null},clearClipboard:function(){app.store.rem("clipboard",!0),this.listView.getFilteredRecordViews(".widget-record-editable-cut, .widget-record-editable-copy").removeClass("widget-record-editable-cut widget-record-editable-copy"),this.toolbarView.getButton("clipboard").removeClass("btn-warning btn-danger").addClass("btn-default")},onClickBreadcrumb:function(a){this.trigger("setPage",{urlIDs:a.urlIDs})},onClickRecord:function(a){this.trigger("setPage",{urlIDs:_.extend({},this.settings.urlIDs,{sID:a.id}),containerAttributes:a})},onClickToolbar:function(a){if(-1!==a.indexOf("display"))if("display_sort_criteria"===a){var d=this.listView.collection.sortCriteria;app.store.set("sets.sortCriteria","name"===d?"cards":"name"),app.saveUserSettings(),this.refresh()}else if("display_sort_order"===a){var e=this.listView.collection.isAscending;app.store.set("sets.isAscending",!e),app.saveUserSettings(),this.refresh()}else"display_select_all"===a?this.listView.getFilteredRecordViews(".widget-record-editable").addClass("widget-record-editable-selected"):"display_clear_selected"===a&&this.listView.clearSelected();else if(-1!==a.indexOf("clipboard")){if("clipboard_clear"===a)this.clearClipboard();else if("clipboard_cut"===a||"clipboard_copy"===a){var f="clipboard_cut"===a,g=this.listView.getSelected();if(g.length){g.addClass("widget-record-editable-"+(f?"cut":"copy")),this.listView.clearSelected();var h=[];g.each(function(a,b){var c=$(b).data("modelAttributes");h.push(c.id)});var i={};i.isCut=f,i.type="sets",i.ids=h,i.srcModuleID=this.settings.urlIDs.mID,i.srcSetID=void 0,app.store.rem("clipboard",!0),app.store.set("clipboard",i),bsDialog.create({title:"Cut/Copy Sets",msg:"<p>"+h.length+" set(s) have been placed on the clipboard"+"</p>",ok:function(){}}),this.toolbarView.getButton("clipboard").removeClass("btn-default btn-warning btn-danger").addClass(f?"btn-danger":"btn-warning")}else bsDialog.create({title:"Cut/Copy Sets",msg:"<p>You must select some sets first!</p>",ok:function(){}})}else if("clipboard_paste"===a){var j=null,k=app.store.get("clipboard");"undefined"===$.gettype(k).base?j="Clipboard is empty!":"sets"!==k.type?j="You can only paste sets here!":k.srcModuleID===this.settings.urlIDs.mID&&(j="Source/destination classes are the same!"),j?bsDialog.create({title:"Paste",msg:"<p>"+j+"</p>",ok:function(){}}):(this.listView.clearSelected(),Spinner.get().show({msg:"Pasting...",opacity:0}),$.ajax({url:app.JS_ROOT+"ajax/studying/sets-manual.php/paste/"+this.settings.urlIDs.mID+"/"+this.settings.urlIDs.uID,type:"POST",data:JSON.stringify({isCut:+k.isCut,setIDs:k.ids,srcModuleID:k.srcModuleID,dstModuleID:this.settings.urlIDs.mID}),dataType:"json",contentType:"application/json",context:this,beforeSend:function(a){a.setRequestHeader("SESSIONTOKEN",app&&app.store.has("user")?app.store.get("user").token:"unspecified")}}).done(function(a){for(var d=0;d<a.newSets.length;d++)this.listView.trigger("onExternalAdd",a.newSets[d],{sbMakeSelected:!0});Spinner.get().hide(function(){bsDialog.create({title:"Paste Sets",msg:"<p>"+a.newSets.length+" set(s) pasted"+"</p>",ok:function(){}})})}).fail(function(a,b,c){Spinner.get().hide(function(){app.dealWithAjaxFail(a,b,c)})}).always(function(){this.clearClipboard()}))}}else if("add"===a)this.displayForm("create",{urlIDs:this.settings.urlIDs});else if("delete"===a){var g=this.listView.getSelected();if(g.length){var h=[];g.each(function(a,b){var c=$(b).data("modelAttributes");h.push(c.id)}),okayFunction=function(){this.clearClipboard(),Spinner.get().show({msg:"Removing...",opacity:0}),$.ajax({url:app.JS_ROOT+"ajax/studying/sets-manual.php/delete/"+this.settings.urlIDs.mID+"/"+this.settings.urlIDs.uID,type:"POST",data:JSON.stringify(h),dataType:"json",contentType:"application/json",context:this,beforeSend:function(a){a.setRequestHeader("SESSIONTOKEN",app&&app.store.has("user")?app.store.get("user").token:"unspecified")}}).done(function(a){for(var d=0;d<a.setIDs.length;d++)!function(a){this.listView.trigger("onExternalRemove",function(b){return b.id===a})}.bind(this)(a.setIDs[d]);Spinner.get().hide()}).fail(function(a,b,c){Spinner.get().hide(function(){app.dealWithAjaxFail(a,b,c)})})}.bind(this),bsDialog.create({title:"Delete Sets",msg:"<p>Are you sure you want to delete these sets? This will also delete any cards that are inside them. WARNING: THIS CANNOT BE UNDONE!</p>",ok:okayFunction,cancel:function(){}})}else bsDialog.create({title:"Delete Sets",msg:"<p>You must select some sets first!</p>",ok:function(){}})}else if(-1!==a.indexOf("test_")){if("test_take"===a){var g=this.listView.getSelected();if(g.length){var h=[];g.each(function(a,b){var c=$(b).data("modelAttributes");h.push(c.id)});var l=app.store.get("card.filter.keywords")||[],m=app.store.get("card.filter.tags")||[];bsDialog.create({title:"Take Test",msg:"<p>Do you want to take a test comprised of the set(s) and filter information you have selected?</p>",ok:function(){app.store.rem("tests.manual"),app.store.set("tests.manual",{module_id:this.settings.urlIDs.mID,setIDs:h,keywords:l,tags:m}),app.router.navigate("studying/taketest/manual/",{trigger:!0})}.bind(this),cancel:function(){}})}else bsDialog.create({title:"Take Test",msg:"<p>You must select some sets first!</p>",ok:function(){}})}else if("test_save"===a){var g=this.listView.getSelected();if(g.length){var h=[];g.each(function(a,b){var c=$(b).data("modelAttributes");h.push(c.id)}),app.store.rem("test.save",!0),app.store.set("test.save.setIDs",h),this.displayForm("saveTest",{urlIDs:this.settings.urlIDs})}else bsDialog.create({title:"Save As Test",msg:"<p>You must select some sets first!</p>",ok:function(){}})}}else"filter_set"===a?this.displayForm("filter"):"filter_clear"===a&&(app.store.rem("card.filter",!0),this.refresh())},onFormSubmit:function(a,b,c){switch(a){case"create":this.listView.trigger("onExternalAdd",b,c),this.closeForm();break;case"filter":var d=app.store.has("card.filter.tags")||app.store.has("card.filter.keywords");app.store.rem("card.filter",!0),b.keywords.length||b.tags.length?(app.store.set("card.filter.keywords",b.keywords),app.store.set("card.filter.tags",b.tags),this.refresh()):d?this.onClickToolbar("filter_clear",null):this.closeForm();break;case"saveTest":this.listView.clearSelected(),app.store.rem("test.save",!0),this.closeForm()}}}),VWidgetStudyingBrowseSetsBreadcrumb=VBaseWidgetBreadcrumb.extend({id:"widget-studying-browse-sets-breadcrumb",templateID:"tpl-widget-studying-browse-sets-breadcrumb",className:function(){return _.result(VBaseWidgetBreadcrumb.prototype,"className")+" breadcrumb widget-studying-browse-sets-breadcrumb"},events:function(){return _.extend({},_.result(VBaseWidgetBreadcrumb.prototype,"events"),{})},generateCrumbs:function(a){var b=null,c=[],d={};if(b=_.find(a,function(a){return"moduleID"===a.crumbName}),!b)return null;var e=b.module_id;d.crumbDisplay=b.subject_code+" "+b.class_code+" ("+b.semester_name+", "+b.year+")",d.crumbDisplay=$.leftovers.parse.crop_string(d.crumbDisplay,40),d.crumbHref=app.JS_ROOT+"#studying/browse/",d.crumbData={urlIDs:{}},c.push(d);var d={};if(b=_.find(a,function(a){return"groupID"===a.crumbName}),!b)return null;var f=b.id;d.crumbDisplay="self"===b.id?"My Stuff":"pub"===b.id?"Public Studygroup":"Studygroup ("+b.created_by_first_name+")",d.crumbDisplay=$.leftovers.parse.crop_string(d.crumbDisplay,40),d.crumbHref=app.JS_ROOT+"#studying/browse/"+"m"+e+"/",d.crumbData={urlIDs:{mID:e}},c.push(d),selfCrumb=_.find(a,function(a){return"groupID"===a.crumbName&&"self"===a.id});var d={};if(b=_.find(a,function(a){return"userID"===a.crumbName}),!b)return null;var g=b.id;selfCrumb||(d.crumbDisplay=b.full_name,d.crumbDisplay=$.leftovers.parse.crop_string(d.crumbDisplay,40),d.crumbHref=app.JS_ROOT+"#studying/browse/"+"m"+e+"/"+"g"+f+"/",d.crumbData={urlIDs:{mID:e,gID:f}},c.push(d));var d={};return(b=_.find(a,function(a){return"typeID"===a.crumbName}))?(b.id,"cards"===b.id?d.crumbDisplay="Flashcards":"tests"===b.id&&(d.crumbDisplay="Tests"),d.crumbDisplay=$.leftovers.parse.crop_string(d.crumbDisplay,40),d.crumbHref=app.JS_ROOT+"#studying/browse/"+"m"+e+"/"+"g"+f+"/"+"u"+g+"/",d.crumbData={urlIDs:{mID:e,gID:f,uID:g}},c.push(d),c):null}}),VWidgetStudyingBrowseSetsFormCreate=VBaseWidgetFormCreate.extend({id:"widget-studying-browse-sets-form-create",templateID:"tpl-widget-studying-browse-sets-form-create",successAlertText:void 0,requestText:"Saving...",formName:"create",className:function(){return _.result(VBaseWidgetFormCreate.prototype,"className")+" widget-studying-browse-sets-form-create"},events:function(){return _.extend({},_.result(VBaseWidgetFormCreate.prototype,"events"),{})},remove:function(){return this.ws_sharing=null,VBaseWidgetFormCreate.prototype.remove.call(this)},instantiateModel:function(){var a=new SetModel;return a.urlRoot=a.baseUrlRoot+"/"+this.settings.urlIDs.mID+"/"+this.settings.urlIDs.uID,a},prepareForm:function(){this.ws_sharing=new WSelect2({elem:this.jqoForm.find("input[name=sharing]"),makeElement:null,filterSelection:null}),this.ws_sharing.init({data:_.map(app.store.get("sharing.types"),function(a){var b={};return b.id=b.text=a,b}),preventNew:!0,placeholder:"e.g., public"})},getFormAttrs:function(){var a=this.jqoForm.serialize_object();return a.sharing=this.ws_sharing.getSelection(),a.sharing=a.sharing.length?a.sharing[0].id:null,a.set_name=$.trim(a.set_name),a.description=$.trim(a.description),a.description=a.description.length?a.description:null,a.has_auto_test=a.has_auto_test?1:0,a.num_filtered_cards=0,a}}),VWidgetStudyingBrowseSetsFormFilter=VBaseWidgetBrowseFormFilter.extend({id:"widget-studying-browse-sets-form-filter",className:function(){return _.result(VBaseWidgetBrowseFormFilter.prototype,"className")+" widget-studying-browse-sets-form-filter"},events:function(){return _.extend({},_.result(VBaseWidgetBrowseFormFilter.prototype,"events"),{})}}),VWidgetStudyingBrowseSetsFormSaveTest=VBaseWidgetFormCreate.extend({id:"widget-studying-browse-sets-form-save-test",templateID:"tpl-widget-studying-browse-sets-form-save-test",successAlertText:void 0,requestText:"Saving...",formName:"saveTest",className:function(){return _.result(VBaseWidgetFormCreate.prototype,"className")+" widget-studying-browse-sets-form-save-test"
},events:function(){return _.extend({},_.result(VBaseWidgetFormCreate.prototype,"events"),{})},remove:function(){return this.ws_sharing=null,VBaseWidgetFormCreate.prototype.remove.call(this)},instantiateModel:function(){var a=new TestModel;return a.urlRoot=a.baseUrlRoot+"/"+this.settings.urlIDs.mID+"/"+this.settings.urlIDs.uID,a},getDefaultAttrsForTemplate:function(){var a={},b=app.store.get("card.filter.keywords"),c=app.store.get("card.filter.tags");return a.numSets=app.store.get("test.save.setIDs").length,a.numKeywords=b?b.length:0,a.numTags=c?c.length:0,a},prepareForm:function(){this.ws_sharing=new WSelect2({elem:this.jqoForm.find("input[name=sharing]"),makeElement:null,filterSelection:null}),this.ws_sharing.init({data:_.map(app.store.get("sharing.types"),function(a){var b={};return b.id=b.text=a,b}),preventNew:!0,placeholder:"e.g., public"}),this.ws_sharing.set(this.attrs.get("sharing"))},getFormAttrs:function(){var a=this.jqoForm.serialize_object();a.sharing=this.ws_sharing.getSelection(),a.sharing=a.sharing.length?a.sharing[0].id:null,a.test_name=$.trim(a.test_name),a.description=$.trim(a.description),a.description=a.description.length?a.description:null;var b=app.store.get("test.save.setIDs"),c=app.store.get("card.filter.keywords"),d=app.store.get("card.filter.tags");return a.setIDs=b,a.keywords=c?c:[],a.tags=d?d:[],a}}),VWidgetStudyingBrowseSetsList=VBaseWidgetList.extend({id:"widget-studying-browse-sets-list",className:function(){return _.result(VBaseWidgetList.prototype,"className")+" widget-studying-browse-sets-list"},events:function(){return _.extend({},_.result(VBaseWidgetList.prototype,"events"),{})},instantiateCollection:function(){var a=new SetsCollection;return"undefined"!==$.gettype(this.options.sbIsAscending).base&&(a.isAscending=this.options.sbIsAscending),"undefined"!==$.gettype(this.options.sbSortCriteria).base&&(a.sortCriteria=this.options.sbSortCriteria),a},instantiateModel:function(){return new SetModel},instantiateWidgetRecordEditable:function(a,b){return new VWidgetStudyingBrowseSetsRecordEditable(a,b)}}),VWidgetStudyingBrowseSetsRecordEditableDisplay=VBaseWidgetRecordEditableDisplay.extend({id:"widget-studying-browse-sets-record-editable-display",templateID:"tpl-widget-studying-browse-sets-record-editable-display",className:function(){return _.result(VBaseWidgetRecordEditableDisplay.prototype,"className")+" widget-studying-browse-sets-record-editable-display"},events:function(){return _.extend({},_.result(VBaseWidgetRecordEditableDisplay.prototype,"events"),{})}}),VWidgetStudyingBrowseSetsRecordEditableEdit=VBaseWidgetRecordEditableEdit.extend({id:"widget-studying-browse-sets-record-editable-edit",templateID:"tpl-widget-studying-browse-sets-record-editable-edit",className:function(){return _.result(VBaseWidgetRecordEditableEdit.prototype,"className")+" widget-studying-browse-sets-record-editable-edit"},events:function(){return _.extend({},_.result(VBaseWidgetRecordEditableEdit.prototype,"events"),{})},remove:function(){return this.ws_sharing=null,VBaseWidgetRecordEditableEdit.prototype.remove.call(this)},prepareForm:function(){this.ws_sharing=new WSelect2({elem:this.jqoForm.find("input[name=sharing]"),makeElement:null,filterSelection:null}),this.ws_sharing.init({data:_.map(app.store.get("sharing.types"),function(a){var b={};return b.id=b.text=a,b}),preventNew:!0,placeholder:"e.g., public"}),this.ws_sharing.set(this.settings.recordSettings.model.get("sharing"))},getFormAttrs:function(){var a=this.jqoForm.serialize_object();return a.sharing=this.ws_sharing.getSelection(),a.sharing=a.sharing.length?a.sharing[0].id:null,a.set_name=$.trim(a.set_name),a.description=$.trim(a.description),a.description=a.description.length?a.description:null,a.has_auto_test=a.has_auto_test?1:0,a}}),VWidgetStudyingBrowseSetsRecordEditable=VBaseWidgetRecordEditable.extend({id:"widget-studying-browse-sets-record-editable",templateID:"tpl-widget-studying-browse-sets-record-editable",flagDialogTitle:"Flag Set",flagDialogMsg:"<p>Are you sure you want to flag this set as inappropriate?</p>",deleteDialogTitle:"Delete Set",deleteDialogMsg:"<p>Are you sure you want to delete this set? You will lose its cards as well! WARNING: THIS CANNOT BE UNDONE!</p>",className:function(){return _.result(VBaseWidgetRecordEditable.prototype,"className")+" widget-studying-browse-sets-record-editable"},events:function(){return _.extend({},_.result(VBaseWidgetRecordEditable.prototype,"events"),{})},updateModelURL:function(){this.settings.model.urlRoot=this.settings.model.baseUrlRoot+"/"+this.settings.listSettings.urlIDs.mID+"/"+this.settings.listSettings.urlIDs.uID},setToolbarButtonsEnabled:function(){VBaseWidgetRecordEditable.prototype.setToolbarButtonsEnabled.call(this);var a=this.settings.listSettings.urlIDs.uID===app.store.get("user").id;this.isEditing||this.toolbarView.setEnabled({select:!0,edit:a,flag:!a,"delete":a})},instantiateToolbarView:function(){return new VWidgetStudyingBrowseSetsRecordEditableToolbar},instantiateDisplayView:function(a,b){return new VWidgetStudyingBrowseSetsRecordEditableDisplay(a,b)},instantiateEditView:function(a,b){return new VWidgetStudyingBrowseSetsRecordEditableEdit(a,b)},onModelError:function(a,b){Spinner.get().hide(function(){var a=app.getAjaxUserError(b);if(400!==b.status||!a||"flag-reputation"!==a.type&&"flag-duplicate"!==a.type)app.dealWithAjaxFail(b,null,null);else{var c=null;c="flag-reputation"===a.type?"You are not able to flag any more content for the moment. Please give the administrators time to evaluate your previous flags.":"You have already flagged that content. Please give the administrators time to evaluate your previous flag.",bsDialog.create({title:"Error!",msg:"<p>"+c+"</p>",ok:function(){}})}})}}),VWidgetStudyingBrowseSetsRecordEditableToolbar=VBaseWidgetToolbar.extend({id:"widget-studying-browse-sets-record-editable-toolbar",templateID:"tpl-widget-studying-browse-sets-record-editable-toolbar",className:function(){return _.result(VBaseWidgetToolbar.prototype,"className")+" widget-studying-browse-sets-record-editable-toolbar"},events:function(){return _.extend({},_.result(VBaseWidgetToolbar.prototype,"events"),{})}}),VWidgetStudyingBrowseSetsToolbar=VBaseWidgetToolbar.extend({id:"widget-studying-browse-sets-toolbar",templateID:"tpl-widget-studying-browse-sets-toolbar",className:function(){return _.result(VBaseWidgetToolbar.prototype,"className")+" widget-studying-browse-sets-toolbar"},events:function(){return _.extend({},_.result(VBaseWidgetToolbar.prototype,"events"),{})}}),VPageStudyingBrowseCards=VBasePageBrowse.extend({id:"page-studying-browse-cards",className:function(){return _.result(VBasePageBrowse.prototype,"className")+" page-studying-browse-cards"},events:function(){return _.extend({},_.result(VBasePageBrowse.prototype,"events"),{})},remove:function(){return this.listData=null,this.breadcrumb=null,VBasePageBrowse.prototype.remove.call(this)},render:function(){VBasePageBrowse.prototype.render.call(this);var a=this.$("div.sb-footer div.help a").prop("href");return this.$("div.sb-footer div.help a").prop("href",a+"flashcards/"),this},loadData:function(){this.listData=null,this.breadcrumb=null,Spinner.get().show({msg:"Loading cards...",opacity:0}),$.ajax({url:app.JS_ROOT+"ajax/studying/cards-manual.php/fetch/"+this.settings.urlIDs.mID+"/"+this.settings.urlIDs.gID+"/"+this.settings.urlIDs.uID+"/"+this.settings.urlIDs.sID,type:"POST",data:JSON.stringify({filter:{keywords:app.store.get("card.filter.keywords"),tags:app.store.get("card.filter.tags")}}),dataType:"json",contentType:"application/json",context:this,beforeSend:function(a){a.setRequestHeader("SESSIONTOKEN",app&&app.store.has("user")?app.store.get("user").token:"unspecified")}}).done(function(a){this.listData=a.cards,this.breadcrumb=a.breadcrumb,this.ready()}).fail(function(a,b,c){Spinner.get().hide(function(){app.dealWithAjaxFail(a,b,c)})})},getContentAttributes:function(){return{heading:"Cards"}},instantiateBreadcrumbView:function(){return new VWidgetStudyingBrowseCardsBreadcrumb({data:this.breadcrumb})},instantiateToolbarView:function(){return new VWidgetStudyingBrowseCardsToolbar},instantiateListView:function(){var a={};return app.store.has("cards.isAscending")&&(a.sbIsAscending=app.store.get("cards.isAscending")),new VWidgetStudyingBrowseCardsList({listData:this.listData,urlIDs:this.settings.urlIDs},a)},instantiateFormView:function(a,b,c){var d=null;switch(a){case"create":d=new VWidgetStudyingBrowseCardsFormCreate(b,c);break;case"batch":d=new VWidgetStudyingBrowseCardsFormBatch(b,c);break;case"filter":d=new VWidgetStudyingBrowseCardsFormFilter(b,c);break;case"saveTest":d=new VWidgetStudyingBrowseCardsFormSaveTest(b,c)}return d},setDefaultToolbarEnabled:function(){var a=this.settings.urlIDs.uID===app.store.get("user").id;this.toolbarView.getButton("display_sort").html(app.store.has("cards.isAscending")?app.store.get("cards.isAscending")?"Sort Descending":"Sort Ascending":"Sort Descending"),this.toolbarView.setEnabled({display:!0,clipboard:a,add:a,"delete":a,filter:!0,test:!0});var b=app.store.get("clipboard");if("undefined"!==$.gettype(b).base){var c=b.isCut;this.toolbarView.getButton("clipboard").removeClass("btn-default").addClass(c?"btn-danger":"btn-warning")}var d=app.store.get("card.filter.keywords"),e=app.store.get("card.filter.tags");(d||e)&&this.toolbarView.getButton("filter").removeClass("btn-default").addClass("btn-info")},disableToolbarFormButtons:function(){this.savedToolbarButtonState=this.toolbarView.getEnabled(),this.toolbarView.setEnabled({display:!0,clipboard:this.savedToolbarButtonState.clipboard,add:!1,"delete":this.savedToolbarButtonState.delete,filter:!1,test:!1})},reEnableToolbarFormButtons:function(){this.toolbarView.setEnabled(this.savedToolbarButtonState),this.savedToolbarButtonState=null},clearClipboard:function(){app.store.rem("clipboard",!0),this.listView.getFilteredRecordViews(".widget-record-editable-cut, .widget-record-editable-copy").removeClass("widget-record-editable-cut widget-record-editable-copy"),this.toolbarView.getButton("clipboard").removeClass("btn-warning btn-danger").addClass("btn-default")},onClickBreadcrumb:function(a){this.trigger("setPage",{urlIDs:a.urlIDs})},onClickToolbar:function(a){if(-1!==a.indexOf("display")){if("display_sort"===a){var c=!this.listView.collection.isAscending;app.store.set("cards.isAscending",c),this.refresh()}}else if(-1!==a.indexOf("clipboard")){if("clipboard_clear"===a)this.clearClipboard();else if("clipboard_cut"===a||"clipboard_copy"===a){var d="clipboard_cut"===a,e=this.listView.getSelected();if(e.length){e.addClass("widget-record-editable-"+(d?"cut":"copy")),this.listView.clearSelected();var f=[];e.each(function(a,b){var c=$(b).data("modelAttributes");f.push(c.id)});var g={};g.isCut=d,g.type="cards",g.ids=f,g.srcModuleID=this.settings.urlIDs.mID,g.srcSetID=this.settings.urlIDs.sID,app.store.rem("clipboard",!0),app.store.set("clipboard",g),bsDialog.create({title:"Cut/Copy Flashcards",msg:"<p>"+f.length+" card(s) have been placed on the clipboard</p>",ok:function(){}}),this.toolbarView.getButton("clipboard").removeClass("btn-default btn-warning btn-danger").addClass(d?"btn-danger":"btn-warning")}else bsDialog.create({title:"Cut/Copy Flashcards",msg:"<p>You must select some cards first!</p>",ok:function(){}})}else if("clipboard_paste"===a){var h=null,i=app.store.get("clipboard");"undefined"===$.gettype(i).base?h="Clipboard is empty!":"cards"!==i.type?h="You can only paste cards here!":i.srcSetID===this.settings.urlIDs.sID&&(h="Source/destination sets are the same!"),h?bsDialog.create({title:"Paste",msg:"<p>"+h+"</p>",ok:function(){}}):(this.listView.clearSelected(),Spinner.get().show({msg:"Pasting...",opacity:0}),$.ajax({url:app.JS_ROOT+"ajax/studying/cards-manual.php/paste/"+this.settings.urlIDs.mID+"/"+this.settings.urlIDs.uID+"/"+this.settings.urlIDs.sID,type:"POST",data:JSON.stringify({isCut:+i.isCut,cardIDs:i.ids,srcModuleID:i.srcModuleID,dstModuleID:this.settings.urlIDs.mID,srcSetID:i.srcSetID,dstSetID:this.settings.urlIDs.sID}),dataType:"json",contentType:"application/json",context:this,beforeSend:function(a){a.setRequestHeader("SESSIONTOKEN",app&&app.store.has("user")?app.store.get("user").token:"unspecified")}}).done(function(a){for(var d=0;d<a.newCards.length;d++)this.listView.trigger("onExternalAdd",a.newCards[d],{sbMakeSelected:!0});Spinner.get().hide(function(){bsDialog.create({title:"Paste Cards",msg:"<p>"+a.newCards.length+" card(s) pasted</p>",ok:function(){}})})}).fail(function(a,b,c){Spinner.get().hide(function(){app.dealWithAjaxFail(a,b,c)})}).always(function(){this.clearClipboard()}))}}else if(-1!==a.indexOf("add"))"add_card"===a?this.displayForm("create",{urlIDs:this.settings.urlIDs}):"add_batch"===a&&this.displayForm("batch",{urlIDs:this.settings.urlIDs});else if("delete"===a){var e=this.listView.getSelected();if(e.length){var f=[];e.each(function(a,b){var c=$(b).data("modelAttributes");f.push(c.id)}),okayFunction=function(){this.clearClipboard(),Spinner.get().show({msg:"Removing...",opacity:0}),$.ajax({url:app.JS_ROOT+"ajax/studying/cards-manual.php/delete/"+this.settings.urlIDs.mID+"/"+this.settings.urlIDs.uID+"/"+this.settings.urlIDs.sID,type:"POST",data:JSON.stringify(f),dataType:"json",contentType:"application/json",context:this,beforeSend:function(a){a.setRequestHeader("SESSIONTOKEN",app&&app.store.has("user")?app.store.get("user").token:"unspecified")}}).done(function(a){for(var d=0;d<a.cardIDs.length;d++)!function(a){this.listView.trigger("onExternalRemove",function(b){return b.id===a})}.bind(this)(a.cardIDs[d]);Spinner.get().hide()}).fail(function(a,b,c){Spinner.get().hide(function(){app.dealWithAjaxFail(a,b,c)})})}.bind(this),bsDialog.create({title:"Delete Flashcards",msg:"<p>Are you sure you want to delete these cards? WARNING: THIS CANNOT BE UNDONE!</p>",ok:okayFunction,cancel:function(){}})}else bsDialog.create({title:"Delete Flashcards",msg:"<p>You must select some cards first!</p>",ok:function(){}})}else if(-1!==a.indexOf("test_"))if("test_take"===a){var j=[this.settings.urlIDs.sID],k=app.store.get("card.filter.keywords")||[],l=app.store.get("card.filter.tags")||[];bsDialog.create({title:"Take Test",msg:"<p>Do you want to take a test comprised of this set and any filter information you have selected?</p>",ok:function(){app.store.rem("tests.manual"),app.store.set("tests.manual",{module_id:this.settings.urlIDs.mID,setIDs:j,keywords:k,tags:l}),app.router.navigate("studying/taketest/manual/",{trigger:!0})}.bind(this),cancel:function(){}})}else"test_save"===a&&(app.store.rem("test.save",!0),app.store.set("test.save.setIDs",[this.settings.urlIDs.sID]),this.displayForm("saveTest",{urlIDs:this.settings.urlIDs}));else"filter_set"===a?this.displayForm("filter"):"filter_clear"===a&&(app.store.rem("card.filter",!0),this.refresh())},onFormSubmit:function(a,b,c){switch(a){case"create":this.listView.trigger("onExternalAdd",b,c);break;case"batch":for(var d=b,e=0;e<d.length;e++)this.listView.trigger("onExternalAdd",d[e],{sbMakeSelected:!0});this.closeForm(),bsDialog.create({title:"Create Multiple Flashcards",msg:"<p>"+d.length+" card(s) created</p>",ok:function(){}});break;case"filter":var f=app.store.has("card.filter.tags")||app.store.has("card.filter.keywords");app.store.rem("card.filter",!0),b.keywords.length||b.tags.length?(app.store.set("card.filter.keywords",b.keywords),app.store.set("card.filter.tags",b.tags),this.refresh()):f?this.onClickToolbar("filter_clear",null):this.closeForm();break;case"saveTest":this.listView.clearSelected(),app.store.rem("test.save",!0),this.closeForm()}}}),VWidgetStudyingBrowseCardsBreadcrumb=VBaseWidgetBreadcrumb.extend({id:"widget-studying-browse-cards-breadcrumb",templateID:"tpl-widget-studying-browse-cards-breadcrumb",className:function(){return _.result(VBaseWidgetBreadcrumb.prototype,"className")+" breadcrumb widget-studying-browse-cards-breadcrumb"},events:function(){return _.extend({},_.result(VBaseWidgetBreadcrumb.prototype,"events"),{})},generateCrumbs:function(a){var b=null,c=[],d={};if(b=_.find(a,function(a){return"moduleID"===a.crumbName}),!b)return null;var e=b.module_id;d.crumbDisplay=b.subject_code+" "+b.class_code+" ("+b.semester_name+", "+b.year+")",d.crumbDisplay=$.leftovers.parse.crop_string(d.crumbDisplay,40),d.crumbHref=app.JS_ROOT+"#studying/browse/",d.crumbData={urlIDs:{}},c.push(d);var d={};if(b=_.find(a,function(a){return"groupID"===a.crumbName}),!b)return null;var f=b.id;d.crumbDisplay="self"===b.id?"My Stuff":"pub"===b.id?"Public Studygroup":"Studygroup ("+b.created_by_first_name+")",d.crumbDisplay=$.leftovers.parse.crop_string(d.crumbDisplay,40),d.crumbHref=app.JS_ROOT+"#studying/browse/"+"m"+e+"/",d.crumbData={urlIDs:{mID:e}},c.push(d),selfCrumb=_.find(a,function(a){return"groupID"===a.crumbName&&"self"===a.id});var d={};if(b=_.find(a,function(a){return"userID"===a.crumbName}),!b)return null;var g=b.id;selfCrumb||(d.crumbDisplay=b.full_name,d.crumbDisplay=$.leftovers.parse.crop_string(d.crumbDisplay,40),d.crumbHref=app.JS_ROOT+"#studying/browse/"+"m"+e+"/"+"g"+f+"/",d.crumbData={urlIDs:{mID:e,gID:f}},c.push(d));var d={};if(b=_.find(a,function(a){return"typeID"===a.crumbName}),!b)return null;var h=b.id;"cards"===b.id?d.crumbDisplay="Flashcards":"tests"===b.id&&(d.crumbDisplay="Tests"),d.crumbDisplay=$.leftovers.parse.crop_string(d.crumbDisplay,40),d.crumbHref=app.JS_ROOT+"#studying/browse/"+"m"+e+"/"+"g"+f+"/"+"u"+g+"/",d.crumbData={urlIDs:{mID:e,gID:f,uID:g}},c.push(d);var d={};return(b=_.find(a,function(a){return"setID"===a.crumbName}))?(d.crumbDisplay=b.set_name+(b.description?" ("+b.description+")":""),d.crumbDisplay=$.leftovers.parse.crop_string(d.crumbDisplay,40),d.crumbHref=app.JS_ROOT+"#studying/browse/"+"m"+e+"/"+"g"+f+"/"+"u"+g+"/"+h+"/",d.crumbData={urlIDs:{mID:e,gID:f,uID:g,tID:h}},c.push(d),c):null}}),VWidgetStudyingBrowseCardsFormBatch=VBaseWidgetForm.extend({id:"widget-studying-browse-cards-form-batch",templateID:"tpl-widget-studying-browse-cards-form-batch",successAlertText:void 0,formName:"batch",className:function(){return _.result(VBaseWidgetForm.prototype,"className")+" widget-studying-browse-cards-form-batch"},events:function(){return _.extend({},_.result(VBaseWidgetForm.prototype,"events"),{})},questionTag:"{{q}}",answerTag:"{{a}}",prepareForm:function(){this.ws_tags=new WSelect2({elem:this.jqoForm.find("input[name=tags]"),makeElement:null,filterSelection:null}),this.ws_tags.init({tags:_.map(_.filter(app.store.get("card.tags"),function(a){return!a.is_auto}),function(a){return{id:a.id,text:a.tag_text}}),preventNew:!0})},clearFormFields:function(){this.jqoForm.find("textarea").val("")},getFormAttrs:function(){var a=this.jqoForm.serialize_object();if(a.tags=this.ws_tags.getSelection(),a.tags.length){for(var b=[],c=0;c<a.tags.length;c++)b.push({id:a.tags[c].id,tag_text:a.tags[c].text,is_auto:0});a.tags=_.sortBy(b,function(a){return a.tag_text})}return a.parse_text=$.trim(a.parse_text),a},validateAttrs:function(a){if(a.tags&&a.tags.length){var b=_.uniq(a.tags);if(b.length!==a.tags.length)return{msg:"<strong>Tags</strong>: No duplicates",field:"tags"}}return a.parse_text.length?0!==a.parse_text.indexOf(this.questionTag)?{msg:"<strong>Text</strong>: Must begin with "+this.questionTag,field:"parse_text"}:a.parse_text.match(/{\{a}}((?!{\{q}}).)*{\{a}}/)?{msg:"<strong>Text</strong>: Cannot have two consecutive "+this.answerTag+" blocks",field:"parse_text"}:(this.parseCards(a),null):{msg:"<strong>Text</strong>: Please enter some text",field:"parse_text"}},parseCards:function(a){var b=[],c=0,d=0,e=0;do{var f={};f.tags=_.clone(a.tags),d=a.parse_text.indexOf(this.questionTag,c+1),e=a.parse_text.indexOf(this.answerTag,c+1);var g=null;if(g=-1===e&&-1===d?void 0:-1!==d&&(-1===e||-1!==e&&e>d)?d:e,f.question_text=$.trim(a.parse_text.substring(c+this.questionTag.length,g)),f.answer_text=null,-1!==e&&(-1===d||d>e)){var g=null;g=-1===d?void 0:d,f.answer_text=$.trim(a.parse_text.substring(e+this.answerTag.length,g))}f.answer_text||f.tags.push(_.filter(app.store.get("card.tags"),function(a){return"note"===a.tag_text})[0]),b.push(f),c=a.parse_text.indexOf(this.questionTag,c+1)}while(-1!==c);Spinner.get().show({msg:"Creating cards...",opacity:0}),$.ajax({url:app.JS_ROOT+"ajax/studying/cards-manual.php/create_batch/"+this.settings.urlIDs.mID+"/"+this.settings.urlIDs.uID+"/"+this.settings.urlIDs.sID,type:"POST",data:JSON.stringify(b),dataType:"json",contentType:"application/json",context:this,beforeSend:function(a){a.setRequestHeader("SESSIONTOKEN",app&&app.store.has("user")?app.store.get("user").token:"unspecified")}}).done(function(a){this.onAttrsValid(a.newCards),a=null,Spinner.get().hide()}).fail(function(a,b,c){Spinner.get().hide(function(){app.dealWithAjaxFail(a,b,c)})})}}),VWidgetStudyingBrowseCardsFormCreate=VBaseWidgetFormCreate.extend({id:"widget-studying-browse-cards-form-create",templateID:"tpl-widget-studying-browse-cards-form-create",successAlertText:"New Card Added!",requestText:"Saving...",formName:"create",className:function(){return _.result(VBaseWidgetFormCreate.prototype,"className")+" widget-studying-browse-cards-form-create"},events:function(){return _.extend({},_.result(VBaseWidgetFormCreate.prototype,"events"),{})},remove:function(){return this.ws_tags=null,VBaseWidgetFormCreate.prototype.remove.call(this)},instantiateModel:function(){var a=new CardModel;return a.urlRoot=a.baseUrlRoot+"/"+this.settings.urlIDs.mID+"/"+this.settings.urlIDs.uID+"/"+this.settings.urlIDs.sID,a},prepareForm:function(){this.ws_tags=new WSelect2({elem:this.jqoForm.find("input[name=tags]"),makeElement:null,filterSelection:null}),this.ws_tags.init({tags:_.map(_.filter(app.store.get("card.tags"),function(a){return!a.is_auto}),function(a){return{id:a.id,text:a.tag_text}}),preventNew:!0})},getFormAttrs:function(){var a=this.jqoForm.serialize_object();if(a.tags=this.ws_tags.getSelection(),a.tags.length){for(var b=[],c=0;c<a.tags.length;c++)b.push({id:a.tags[c].id,tag_text:a.tags[c].text,is_auto:0});a.tags=_.sortBy(b,function(a){return a.tag_text})}return a.order_id=+a.order_id,a.question_text=$.trim(a.question_text),a.answer_text=$.trim(a.answer_text),a.answer_text=a.answer_text.length?a.answer_text:null,a.answer_text||(a.tags=a.tags||[],a.tags.push(_.filter(app.store.get("card.tags"),function(a){return"note"===a.tag_text})[0])),a}}),VWidgetStudyingBrowseCardsFormFilter=VBaseWidgetBrowseFormFilter.extend({id:"widget-studying-browse-cards-form-filter",className:function(){return _.result(VBaseWidgetBrowseFormFilter.prototype,"className")+" widget-studying-browse-cards-form-filter"},events:function(){return _.extend({},_.result(VBaseWidgetBrowseFormFilter.prototype,"events"),{})}}),VWidgetStudyingBrowseCardsFormSaveTest=VBaseWidgetFormCreate.extend({id:"widget-studying-browse-cards-form-save-test",templateID:"tpl-widget-studying-browse-cards-form-save-test",successAlertText:void 0,requestText:"Saving...",formName:"saveTest",className:function(){return _.result(VBaseWidgetFormCreate.prototype,"className")+" widget-studying-browse-cards-form-save-test"},events:function(){return _.extend({},_.result(VBaseWidgetFormCreate.prototype,"events"),{})},remove:function(){return this.ws_sharing=null,VBaseWidgetFormCreate.prototype.remove.call(this)},instantiateModel:function(){var a=new TestModel;return a.urlRoot=a.baseUrlRoot+"/"+this.settings.urlIDs.mID+"/"+this.settings.urlIDs.uID,a},getDefaultAttrsForTemplate:function(){var a={},b=app.store.get("card.filter.keywords"),c=app.store.get("card.filter.tags");return a.numSets=app.store.get("test.save.setIDs").length,a.numKeywords=b?b.length:0,a.numTags=c?c.length:0,a},prepareForm:function(){this.ws_sharing=new WSelect2({elem:this.jqoForm.find("input[name=sharing]"),makeElement:null,filterSelection:null}),this.ws_sharing.init({data:_.map(app.store.get("sharing.types"),function(a){var b={};return b.id=b.text=a,b}),preventNew:!0,placeholder:"e.g., public"}),this.ws_sharing.set(this.attrs.get("sharing"))},getFormAttrs:function(){var a=this.jqoForm.serialize_object();a.sharing=this.ws_sharing.getSelection(),a.sharing=a.sharing.length?a.sharing[0].id:null,a.test_name=$.trim(a.test_name),a.description=$.trim(a.description),a.description=a.description.length?a.description:null;var b=app.store.get("test.save.setIDs"),c=app.store.get("card.filter.keywords"),d=app.store.get("card.filter.tags");return a.setIDs=b,a.keywords=c?c:[],a.tags=d?d:[],a}}),VWidgetStudyingBrowseCardsList=VBaseWidgetList.extend({id:"widget-studying-browse-cards-list",className:function(){return _.result(VBaseWidgetList.prototype,"className")+" widget-studying-browse-cards-list"},events:function(){return _.extend({},_.result(VBaseWidgetList.prototype,"events"),{})},instantiateCollection:function(){var a=new CardsCollection;return"undefined"!==$.gettype(this.options.sbIsAscending).base&&(a.isAscending=this.options.sbIsAscending),a},instantiateModel:function(){return new CardModel},instantiateWidgetRecordEditable:function(a,b){return new VWidgetStudyingBrowseCardsRecordEditable(a,b)}}),VWidgetStudyingBrowseCardsRecordEditableDisplay=VBaseWidgetRecordEditableDisplay.extend({id:"widget-studying-browse-cards-record-editable-display",templateID:"tpl-widget-studying-browse-cards-record-editable-display",className:function(){return _.result(VBaseWidgetRecordEditableDisplay.prototype,"className")+" widget-record-editable-display-flashcard widget-studying-browse-cards-record-editable-display"},events:function(){return _.extend({},_.result(VBaseWidgetRecordEditableDisplay.prototype,"events"),{})},filterModelAttributes:function(){var a=_.clone(this.settings.recordSettings.model.attributes);return a.question_text=app.markdownSanitizerConverter.makeHtml(a.question_text),a.answer_text&&(a.answer_text=app.markdownSanitizerConverter.makeHtml(a.answer_text)),a}}),VWidgetStudyingBrowseCardsRecordEditableEdit=VBaseWidgetRecordEditableEdit.extend({id:"widget-studying-browse-cards-record-editable-edit",templateID:"tpl-widget-studying-browse-cards-record-editable-edit",className:function(){return _.result(VBaseWidgetRecordEditableEdit.prototype,"className")+" widget-record-editable-edit-flashcard widget-studying-browse-cards-record-editable-edit"},events:function(){return _.extend({},_.result(VBaseWidgetRecordEditableEdit.prototype,"events"),{})},remove:function(){return this.ws_tags=null,VBaseWidgetRecordEditableEdit.prototype.remove.call(this)},prepareForm:function(){this.ws_tags=new WSelect2({elem:this.jqoForm.find("input[name=tags]"),makeElement:null,filterSelection:null}),this.ws_tags.init({tags:_.map(_.filter(app.store.get("card.tags"),function(a){return!a.is_auto}),function(a){return{id:a.id,text:a.tag_text}}),preventNew:!0}),this.ws_tags.set(_.map(_.filter(this.settings.recordSettings.model.get("tags"),function(a){return!a.is_auto}),function(a){return a.id}))},getFormAttrs:function(){var a=this.jqoForm.serialize_object();if(a.tags=this.ws_tags.getSelection(),a.tags.length){for(var b=[],c=0;c<a.tags.length;c++)b.push({id:a.tags[c].id,tag_text:a.tags[c].text,is_auto:0});a.tags=_.sortBy(b,function(a){return a.tag_text})}return a.order_id=+a.order_id,a.question_text=$.trim(a.question_text),a.answer_text=$.trim(a.answer_text),a.answer_text=a.answer_text.length?a.answer_text:null,a.answer_text||(a.tags=a.tags||[],a.tags.push(_.filter(app.store.get("card.tags"),function(a){return"note"===a.tag_text})[0])),a}}),VWidgetStudyingBrowseCardsRecordEditable=VBaseWidgetRecordEditable.extend({id:"widget-studying-browse-cards-record-editable",templateID:"tpl-widget-studying-browse-cards-record-editable",flagDialogTitle:"Flag Flashcard",flagDialogMsg:"<p>Are you sure you want to flag this card as inappropriate?</p>",deleteDialogTitle:"Delete Flashcard",deleteDialogMsg:"<p>Are you sure you want to delete this card? WARNING: THIS CANNOT BE UNDONE!</p>",className:function(){return _.result(VBaseWidgetRecordEditable.prototype,"className")+" widget-record-editable-flashcard widget-studying-browse-cards-record-editable"},events:function(){return _.extend({},_.result(VBaseWidgetRecordEditable.prototype,"events"),{})},updateModelURL:function(){this.settings.model.urlRoot=this.settings.model.baseUrlRoot+"/"+this.settings.listSettings.urlIDs.mID+"/"+this.settings.listSettings.urlIDs.uID+"/"+this.settings.listSettings.urlIDs.sID},setToolbarButtonsEnabled:function(){VBaseWidgetRecordEditable.prototype.setToolbarButtonsEnabled.call(this);var a=this.settings.listSettings.urlIDs.uID===app.store.get("user").id;this.isEditing||this.toolbarView.setEnabled({select:a,edit:a,flag:!a,"delete":a})},instantiateToolbarView:function(){return new VWidgetStudyingBrowseCardsRecordEditableToolbar},instantiateDisplayView:function(a,b){return new VWidgetStudyingBrowseCardsRecordEditableDisplay(a,b)},instantiateEditView:function(a,b){return new VWidgetStudyingBrowseCardsRecordEditableEdit(a,b)},onModelError:function(a,b){Spinner.get().hide(function(){var a=app.getAjaxUserError(b);if(400!==b.status||!a||"flag-reputation"!==a.type&&"flag-duplicate"!==a.type)app.dealWithAjaxFail(b,null,null);else{var c=null;c="flag-reputation"===a.type?"You are not able to flag any more content for the moment. Please give the administrators time to evaluate your previous flags.":"You have already flagged that content. Please give the administrators time to evaluate your previous flag.",bsDialog.create({title:"Error!",msg:"<p>"+c+"</p>",ok:function(){}})}})}}),VWidgetStudyingBrowseCardsRecordEditableToolbar=VBaseWidgetToolbar.extend({id:"widget-studying-browse-cards-record-editable-toolbar",templateID:"tpl-widget-studying-browse-cards-record-editable-toolbar",className:function(){return _.result(VBaseWidgetToolbar.prototype,"className")+" widget-studying-browse-cards-record-editable-toolbar"},events:function(){return _.extend({},_.result(VBaseWidgetToolbar.prototype,"events"),{})}}),VWidgetStudyingBrowseCardsToolbar=VBaseWidgetToolbar.extend({id:"widget-studying-browse-cards-toolbar",templateID:"tpl-widget-studying-browse-cards-toolbar",className:function(){return _.result(VBaseWidgetToolbar.prototype,"className")+" widget-studying-browse-cards-toolbar"},events:function(){return _.extend({},_.result(VBaseWidgetToolbar.prototype,"events"),{})}}),VPageStudyingBrowseTests=VBasePageBrowse.extend({id:"page-studying-browse-tests",className:function(){return _.result(VBasePageBrowse.prototype,"className")+" page-studying-browse-tests"},events:function(){return _.extend({},_.result(VBasePageBrowse.prototype,"events"),{})},remove:function(){return this.listData=null,this.breadcrumb=null,VBasePageBrowse.prototype.remove.call(this)},render:function(){VBasePageBrowse.prototype.render.call(this);var a=this.$("div.sb-footer div.help a").prop("href");return this.$("div.sb-footer div.help a").prop("href",a+"tests/"),this},loadData:function(){this.listData=null,this.breadcrumb=null,Spinner.get().show({msg:"Loading tests...",opacity:0}),$.ajax({url:app.JS_ROOT+"ajax/studying/tests-manual.php/fetch/"+this.settings.urlIDs.mID+"/"+this.settings.urlIDs.gID+"/"+this.settings.urlIDs.uID,type:"POST",data:JSON.stringify({includeAuto:!app.store.has("tests.hide_auto")}),dataType:"json",contentType:"application/json",context:this,beforeSend:function(a){a.setRequestHeader("SESSIONTOKEN",app&&app.store.has("user")?app.store.get("user").token:"unspecified")}}).done(function(a){this.listData=a.tests,this.breadcrumb=a.breadcrumb,this.ready()}).fail(function(a,b,c){Spinner.get().hide(function(){app.dealWithAjaxFail(a,b,c)})})},getContentAttributes:function(){return{heading:"Tests"}},instantiateBreadcrumbView:function(){return new VWidgetStudyingBrowseTestsBreadcrumb({data:this.breadcrumb})},instantiateToolbarView:function(){return new VWidgetStudyingBrowseTestsToolbar},instantiateListView:function(){var a={};return app.store.has("tests.isAscending")&&(a.sbIsAscending=app.store.get("tests.isAscending")),new VWidgetStudyingBrowseTestsList({listData:this.listData,urlIDs:this.settings.urlIDs},a)},setDefaultToolbarEnabled:function(){var a=this.settings.urlIDs.uID===app.store.get("user").id;
this.toolbarView.getButton("display_sort").html(app.store.has("tests.isAscending")?app.store.get("tests.isAscending")?"Sort Descending":"Sort Ascending":"Sort Descending"),this.toolbarView.setEnabled({display:!0,hide_auto:!0,"delete":a});var b=app.store.has("tests.hide_auto");b&&this.toolbarView.getButton("hide_auto").removeClass("btn-default").addClass("btn-warning")},onClickBreadcrumb:function(a){this.trigger("setPage",{urlIDs:a.urlIDs})},onClickToolbar:function(a){if(-1!==a.indexOf("display")){if("display_sort"===a){var c=!this.listView.collection.isAscending;app.store.set("tests.isAscending",c),app.saveUserSettings(),this.refresh()}}else if("hide_auto"===a){var d=app.store.has("tests.hide_auto");d?app.store.rem("tests.hide_auto"):app.store.set("tests.hide_auto",!0),this.refresh()}else if("delete"===a){var e=this.listView.getSelected();if(e.length){var f=[];e.each(function(a,b){var c=$(b).data("modelAttributes");f.push(c.id)}),okayFunction=function(){Spinner.get().show({msg:"Removing...",opacity:0}),$.ajax({url:app.JS_ROOT+"ajax/studying/tests-manual.php/delete/"+this.settings.urlIDs.mID+"/"+this.settings.urlIDs.uID,type:"POST",data:JSON.stringify(f),dataType:"json",contentType:"application/json",context:this,beforeSend:function(a){a.setRequestHeader("SESSIONTOKEN",app&&app.store.has("user")?app.store.get("user").token:"unspecified")}}).done(function(a){for(var d=0;d<a.testIDs.length;d++)!function(a){this.listView.trigger("onExternalRemove",function(b){return b.id===a})}.bind(this)(a.testIDs[d]);Spinner.get().hide()}).fail(function(a,b,c){Spinner.get().hide(function(){app.dealWithAjaxFail(a,b,c)})})}.bind(this),bsDialog.create({title:"Delete Tests",msg:"<p>Are you sure you want to delete these tests? WARNING: THIS CANNOT BE UNDONE!</p>",ok:okayFunction,cancel:function(){}})}else bsDialog.create({title:"Delete Tests",msg:"<p>You must select some tests first!</p>",ok:function(){}})}}}),VWidgetStudyingBrowseTestsBreadcrumb=VBaseWidgetBreadcrumb.extend({id:"widget-studying-browse-tests-breadcrumb",templateID:"tpl-widget-studying-browse-tests-breadcrumb",className:function(){return _.result(VBaseWidgetBreadcrumb.prototype,"className")+" breadcrumb widget-studying-browse-tests-breadcrumb"},events:function(){return _.extend({},_.result(VBaseWidgetBreadcrumb.prototype,"events"),{})},generateCrumbs:function(a){var b=null,c=[],d={};if(b=_.find(a,function(a){return"moduleID"===a.crumbName}),!b)return null;var e=b.module_id;d.crumbDisplay=b.subject_code+" "+b.class_code+" ("+b.semester_name+", "+b.year+")",d.crumbDisplay=$.leftovers.parse.crop_string(d.crumbDisplay,40),d.crumbHref=app.JS_ROOT+"#studying/browse/",d.crumbData={urlIDs:{}},c.push(d);var d={};if(b=_.find(a,function(a){return"groupID"===a.crumbName}),!b)return null;var f=b.id;d.crumbDisplay="self"===b.id?"My Stuff":"pub"===b.id?"Public Studygroup":"Studygroup ("+b.created_by_first_name+")",d.crumbDisplay=$.leftovers.parse.crop_string(d.crumbDisplay,40),d.crumbHref=app.JS_ROOT+"#studying/browse/"+"m"+e+"/",d.crumbData={urlIDs:{mID:e}},c.push(d),selfCrumb=_.find(a,function(a){return"groupID"===a.crumbName&&"self"===a.id});var d={};if(b=_.find(a,function(a){return"userID"===a.crumbName}),!b)return null;var g=b.id;selfCrumb||(d.crumbDisplay=b.full_name,d.crumbDisplay=$.leftovers.parse.crop_string(d.crumbDisplay,40),d.crumbHref=app.JS_ROOT+"#studying/browse/"+"m"+e+"/"+"g"+f+"/",d.crumbData={urlIDs:{mID:e,gID:f}},c.push(d));var d={};return(b=_.find(a,function(a){return"typeID"===a.crumbName}))?(b.id,"cards"===b.id?d.crumbDisplay="Flashcards":"tests"===b.id&&(d.crumbDisplay="Tests"),d.crumbDisplay=$.leftovers.parse.crop_string(d.crumbDisplay,40),d.crumbHref=app.JS_ROOT+"#studying/browse/"+"m"+e+"/"+"g"+f+"/"+"u"+g+"/",d.crumbData={urlIDs:{mID:e,gID:f,uID:g}},c.push(d),c):null}}),VWidgetStudyingBrowseTestsList=VBaseWidgetList.extend({id:"widget-studying-browse-tests-list",className:function(){return _.result(VBaseWidgetList.prototype,"className")+" widget-studying-browse-tests-list"},events:function(){return _.extend({},_.result(VBaseWidgetList.prototype,"events"),{})},instantiateCollection:function(){var a=new TestsCollection;return"undefined"!==$.gettype(this.options.sbIsAscending).base&&(a.isAscending=this.options.sbIsAscending),a},instantiateModel:function(){return new TestModel},instantiateWidgetRecordEditable:function(a,b){return new VWidgetStudyingBrowseTestsRecordEditable(a,b)}}),VWidgetStudyingBrowseTestsRecordEditableDisplay=VBaseWidgetRecordEditableDisplay.extend({id:"widget-studying-browse-tests-record-editable-display",templateID:"tpl-widget-studying-browse-tests-record-editable-display",className:function(){return _.result(VBaseWidgetRecordEditableDisplay.prototype,"className")+" widget-studying-browse-tests-record-editable-display"},events:function(){return _.extend({},_.result(VBaseWidgetRecordEditableDisplay.prototype,"events"),{})}}),VWidgetStudyingBrowseTestsRecordEditableEdit=VBaseWidgetRecordEditableEdit.extend({id:"widget-studying-browse-tests-record-editable-edit",templateID:"tpl-widget-studying-browse-tests-record-editable-edit",className:function(){return _.result(VBaseWidgetRecordEditableEdit.prototype,"className")+" widget-studying-browse-tests-record-editable-edit"},events:function(){return _.extend({},_.result(VBaseWidgetRecordEditableEdit.prototype,"events"),{})},remove:function(){return this.ws_sharing=null,VBaseWidgetRecordEditableEdit.prototype.remove.call(this)},prepareForm:function(){this.ws_sharing=new WSelect2({elem:this.jqoForm.find("input[name=sharing]"),makeElement:null,filterSelection:null}),this.ws_sharing.init({data:_.map(app.store.get("sharing.types"),function(a){var b={};return b.id=b.text=a,b}),preventNew:!0,placeholder:"e.g., public"}),this.ws_sharing.set(this.settings.recordSettings.model.get("sharing"))},getFormAttrs:function(){var a=this.jqoForm.serialize_object();return a.sharing=this.ws_sharing.getSelection(),a.sharing=a.sharing.length?a.sharing[0].id:null,a.test_name=$.trim(a.test_name),a.description=$.trim(a.description),a.description=a.description.length?a.description:null,a}}),VWidgetStudyingBrowseTestsRecordEditable=VBaseWidgetRecordEditable.extend({id:"widget-studying-browse-tests-record-editable",templateID:"tpl-widget-studying-browse-tests-record-editable",flagDialogTitle:"Flag Test",flagDialogMsg:"<p>Are you sure you want to flag this test as inappropriate?</p>",deleteDialogTitle:"Delete Test",deleteDialogMsg:"<p>Are you sure you want to delete this test? WARNING: THIS CANNOT BE UNDONE!</p>",className:function(){return _.result(VBaseWidgetRecordEditable.prototype,"className")+" widget-studying-browse-tests-record-editable"},events:function(){return _.extend({},_.result(VBaseWidgetRecordEditable.prototype,"events"),{})},updateModelURL:function(){this.settings.model.urlRoot=this.settings.model.baseUrlRoot+"/"+this.settings.listSettings.urlIDs.mID+"/"+this.settings.listSettings.urlIDs.uID},setToolbarButtonsEnabled:function(){VBaseWidgetRecordEditable.prototype.setToolbarButtonsEnabled.call(this);var a=this.settings.listSettings.urlIDs.uID===app.store.get("user").id,b=!this.settings.model.get("is_auto_test");this.isEditing||this.toolbarView.setEnabled({info:b,take:!0,select:a&&b,edit:a&&b,flag:!a&&b,"delete":a&&b})},instantiateToolbarView:function(){return new VWidgetStudyingBrowseTestsRecordEditableToolbar},instantiateDisplayView:function(a,b){return new VWidgetStudyingBrowseTestsRecordEditableDisplay(a,b)},instantiateEditView:function(a,b){return new VWidgetStudyingBrowseTestsRecordEditableEdit(a,b)},onClickToolbar:function(a,b){if(VBaseWidgetRecordEditable.prototype.onClickToolbar.call(this,a,b),"info"===a){var c=_.map(this.settings.model.get("tags"),function(a){var b=_.find(app.store.get("card.tags"),function(b){return b.id===a});return b.tag_text});c=c.length?c.join(", "):"None";var d=this.settings.model.get("keywords").length?this.settings.model.get("keywords").join(", "):"None",e={};e=this.settings.model.get("is_auto_test")?{num_cards:this.settings.model.get("num_cards"),setsInfo:null}:_.extend({},this.settings.model.attributes,{tagsText:c,keywordsText:d});var f=$.includejs.getTemplate("tpl-widget-studying-browse-tests-record-editable-info",e);bsDialog.create({title:"Test Information",msg:f,ok:function(){}})}else if("take"===a){var g=this.settings.model.get("id"),h=this.settings.model.get("is_auto_test");app.router.navigate(h?"studying/taketest/auto/"+g+"/":"studying/taketest/"+g+"/",{trigger:!0})}},onModelError:function(a,b){Spinner.get().hide(function(){var a=app.getAjaxUserError(b);if(400!==b.status||!a||"flag-reputation"!==a.type&&"flag-duplicate"!==a.type)app.dealWithAjaxFail(b,null,null);else{var c=null;c="flag-reputation"===a.type?"You are not able to flag any more content for the moment. Please give the administrators time to evaluate your previous flags.":"You have already flagged that content. Please give the administrators time to evaluate your previous flag.",bsDialog.create({title:"Error!",msg:"<p>"+c+"</p>",ok:function(){}})}})}}),VWidgetStudyingBrowseTestsRecordEditableToolbar=VBaseWidgetToolbar.extend({id:"widget-studying-browse-tests-record-editable-toolbar",templateID:"tpl-widget-studying-browse-tests-record-editable-toolbar",className:function(){return _.result(VBaseWidgetToolbar.prototype,"className")+" widget-studying-browse-tests-record-editable-toolbar"},events:function(){return _.extend({},_.result(VBaseWidgetToolbar.prototype,"events"),{})}}),VWidgetStudyingBrowseTestsToolbar=VBaseWidgetToolbar.extend({id:"widget-studying-browse-tests-toolbar",templateID:"tpl-widget-studying-browse-tests-toolbar",className:function(){return _.result(VBaseWidgetToolbar.prototype,"className")+" widget-studying-browse-tests-toolbar"},events:function(){return _.extend({},_.result(VBaseWidgetToolbar.prototype,"events"),{})}}),VSectionStudyingTakeTest=VBaseSection.extend({id:"section-tests-browse",sectionTemplateID:"tpl-section-user",headerTemplateID:"tpl-section-header-user",headerElement:"div.section-header",pageElement:"div.section-page",menuClassNameActive:"studying",className:function(){return _.result(VBaseSection.prototype,"className")+" section-tests-take"},events:function(){return _.extend({},_.result(VBaseSection.prototype,"events"),{})},setURL:function(a){if(a.urlIDs){var c=a.urlIDs;for(id in c)if("undefined"!==$.gettype(c[id]).base&&(c[id]=+c[id],"number"!==$.gettype(c[id]).base))return!1;if(!c.tID&&!c.aID||c.tID&&c.aID)return!1}else{if(!a.manualData)return!1;if("array"!==$.gettype(a.manualData.setIDs).base||!a.manualData.setIDs.length)return!1}return null},instantiatePageView:function(a,b){var c=null;switch(a.pageName){case"intro":c=new VPageTestsTakeIntro(a,b);break;case"doing":c=new VPageTestsTakeDoing(a,b);break;case"outro":c=new VPageTestsTakeOutro(a,b)}return c}}),VPageTestsTakeIntro=VBasePage.extend({id:"page-tests-take-intro",pageTemplateID:"tpl-page",contentElement:"div.page-content",footerElement:"div.page-footer-user",footerTemplateID:"tpl-page-footer-user",contentTemplateID:"tpl-page-content-tests-take-intro",className:function(){return _.result(VBasePage.prototype,"className")+" page-tests-take-intro"},panelElement:"div.page-content > div.content-panel",formElement:"div.page-content > div.content-form",events:function(){return _.extend({},_.result(VBasePage.prototype,"events"),{})},initialize:function(a,b){this.panelView=null,this.formView=null,VBasePage.prototype.initialize.call(this,a,b)},loadData:function(){this.test=null;var a=null,b=null,c=null;this.settings.urlIDs?(a=this.settings.urlIDs.aID?"auto":"regular",b="auto"===a?this.settings.urlIDs.aID:this.settings.urlIDs.tID):(a="manual",c=this.settings.manualData),Spinner.get().show({msg:"Loading test...",opacity:0}),$.ajax({url:app.JS_ROOT+"ajax/studying/tests-manual.php/take",type:"POST",data:JSON.stringify({type:a,id:b,manualTest:c}),dataType:"json",contentType:"application/json",context:this,beforeSend:function(a){a.setRequestHeader("SESSIONTOKEN",app&&app.store.has("user")?app.store.get("user").token:"unspecified")}}).done(function(a){a.test&&(this.test=a.test,this.test.setsInfo=_.sortBy(this.test.setsInfo,function(a){return a.set_name+(a.description?a.description:"")})),a=null,this.ready()}).fail(function(a,b,c){Spinner.get().hide(function(){app.dealWithAjaxFail(a,b,c)})})},ready:function(){if(!this.test)return this.trigger("onPageFailed",this),void 0;var a=_.extend({},this.settings,{templateAttrs:this.buildPanelAttrs()});this.panelView=new VWidgetTestsTakeIntroPanel(a,{}),this.formView=new VWidgetTestsTakeIntroFormSettings(this.settings,{}),this.panelView.listenTo(this,"cleanup",this.panelView.remove),this.formView.listenTo(this,"cleanup",this.formView.remove),this.listenTo(this.panelView,"onPanelOK",this.onPanelOK),this.listenTo(this.formView,"onFormSubmit",this.onFormSubmit),this.trigger("onPageReady",this)},remove:function(){return this.stopListening(this.panelView),this.stopListening(this.formView),this.panelView=null,this.formView=null,this.test=null,VBasePage.prototype.remove.call(this)},render:function(){return VBasePage.prototype.render.call(this),this.$(this.panelElement).html(this.panelView.render().$el),this.$(this.formElement).html(this.formView.render().$el),this.test.is_auto_test&&this.panelView.disableOKButton(),this.test.num_cards||this.formView.disableSaveButton(),this},onPanelOK:function(){var a=$.includejs.getTemplate("tpl-widget-tests-take-intro-panel-more-info",this.test);bsDialog.create({title:"Test Information",msg:a,ok:function(){}})},onFormSubmit:function(a,b){if("settings"===a){var d=[];if(b.randomize){for(var i=0;7>i;i++)this.test.cards=_.shuffle(this.test.cards);d=this.test.cards}else for(var e=_.groupBy(this.test.cards,"set_id"),f=0;f<this.test.setsInfo.length;f++){var g=this.test.setsInfo[f].id,h=e[g];h=_.sortBy(h,"order_id"),d=d.concat(h)}this.trigger("setPage",{urlIDs:this.settings.urlIDs,manualData:this.settings.manualData,pageName:"doing",testSettings:b,test:this.test,cards:d,startingIdx:0})}},buildPanelAttrs:function(){this.test.tags=_.map(this.test.tags,function(a){return _.find(app.store.get("card.tags"),function(b){return b.id===a})});var a="None";this.test.tags.length&&(a=_.pluck(this.test.tags,"tag_text").join(", "));var b=this.test.keywords.length?this.test.keywords.join(", "):"None";return _.extend({},this.test,{tagsText:a,keywordsText:b})}}),VWidgetTestsTakeIntroFormSettings=VBaseWidgetForm.extend({id:"widget-tests-take-intro-form-settings",templateID:"tpl-widget-tests-take-intro-form-settings",formName:"settings",successAlertText:void 0,className:function(){return _.result(VBaseWidgetForm.prototype,"className")+" widget-tests-take-intro-form-settings"},events:function(){return _.extend({},_.result(VBaseWidgetForm.prototype,"events"),{})},prepareForm:function(){},getFormAttrs:function(){var a=this.jqoForm.serialize_object();return a.randomize=a.randomize?1:0,a.display_set_name=a.display_set_name?1:0,a.display_card_tags=a.display_card_tags?1:0,a.show_remaining=a.show_remaining?1:0,a},clearFormFields:function(){},validateAttrs:function(){}}),VWidgetTestsTakeIntroPanel=VBaseWidgetPanel.extend({tagName:"div",id:"widget-tests-take-intro-panel",templateID:"tpl-widget-tests-take-intro-panel",className:function(){return _.result(VBaseWidgetPanel.prototype,"className")+" widget-tests-take-intro-panel"},events:function(){return _.extend({},_.result(VBaseWidgetPanel.prototype,"events"),{})}}),VPageTestsTakeDoing=VBasePage.extend({id:"page-tests-take-doing",pageTemplateID:"tpl-page",contentElement:"div.page-content",footerElement:"div.page-footer",footerTemplateID:"tpl-page-footer-user",contentTemplateID:"tpl-page-content-tests-take-doing",className:function(){return _.result(VBasePage.prototype,"className")+" page-tests-take-doing"},panelTimerElement:"div.page-content > div.content-panels > div.content-panel-timer",panelDetailsElement:"div.page-content > div.content-panels > div.content-panel-details",slideshowElement:"div.page-content > div.content-slideshow",events:function(){return _.extend({},_.result(VBasePage.prototype,"events"),{})},initialize:function(a,b){this.panelTimerView=null,this.panelDetailsView=null,this.slideshowView=null,VBasePage.prototype.initialize.call(this,a,b),this.stats={idx:0,minutes_spent:0,num_cards:a.cards.length,set_name:this.constructSetName(a.cards[0].set_id)},this.timer=$.timer(function(){this.onTimer()}.bind(this)),this.timer.set({time:6e4,autostart:!1})},ready:function(){this.panelTimerView=new VWidgetTestsTakeDoingPanelTimer({templateAttrs:_.extend({},{settings:this.settings.testSettings},this.stats)},{}),this.panelDetailsView=new VWidgetTestsTakeDoingPanelDetails({templateAttrs:_.extend({},{settings:this.settings.testSettings},this.stats)},{}),this.slideshowView=new VWidgetTestsTakeDoingSlideshow({urlIDs:this.settings.urlIDs,objects:this.settings.cards,test:this.settings.test,startingIdx:this.settings.startingIdx},{isShowingTags:this.settings.testSettings.display_card_tags}),this.panelTimerView.listenTo(this,"cleanup",this.panelTimerView.remove),this.panelDetailsView.listenTo(this,"cleanup",this.panelDetailsView.remove),this.slideshowView.listenTo(this,"cleanup",this.slideshowView.remove),this.listenTo(this.slideshowView,"onRecordChange",this.onSlideshowRecordChange),this.listenTo(this.slideshowView,"onClickToolbar",this.onSlideshowClickToolbar),this.trigger("onPageReady",this)},remove:function(){return this.timer.stop(),this.stopListening(this.slideshowView),this.stopListening(this.panelDetailsView),this.stopListening(this.panelTimerView),this.timer=null,this.slideshowView=null,this.panelDetailsView=null,this.panelTimerView=null,VBasePage.prototype.remove.call(this)},render:function(){VBasePage.prototype.render.call(this);var a=this.$("div.sb-footer div.help a").prop("href");return this.$("div.sb-footer div.help a").prop("href",a+"tests/"),this.$(this.panelTimerElement).html(this.panelTimerView.render().$el),this.$(this.panelDetailsElement).html(this.panelDetailsView.render().$el),this.$(this.slideshowElement).html(this.slideshowView.render().$el),this.timer.play(),this},onTimer:function(){this.stats.minutes_spent++,this.panelTimerView.settings.templateAttrs=_.extend({},this.panelTimerView.settings.templateAttrs,this.stats),this.$(this.panelTimerElement).html(this.panelTimerView.render().$el)},onSlideshowRecordChange:function(a,b){this.stats.idx=a,this.stats.set_name=this.constructSetName(b.get("set_id")),this.updateDetails()},onSlideshowClickToolbar:function(a){"end"===a&&this.trigger("setPage",{pageName:"outro",stats:this.stats,urlIDs:this.settings.urlIDs,manualData:this.settings.manualData,test:this.settings.test,correctCardIDs:this.slideshowView.correctCardIDs})},constructSetName:function(a){var b=_.find(this.settings.test.setsInfo,function(b){return b.id===a});return b.set_name+(b.description?" ("+b.description+")":"")},updateDetails:function(){this.panelDetailsView.settings.templateAttrs=_.extend({},this.panelDetailsView.settings.templateAttrs,this.stats),this.$(this.panelDetailsElement).html(this.panelDetailsView.render().$el)}}),VWidgetTestsTakeDoingPanelDetails=VBaseWidgetPanel.extend({tagName:"div",id:"widget-tests-take-doing-panel-details",templateID:"tpl-widget-tests-take-doing-panel-details",className:function(){return _.result(VBaseWidgetPanel.prototype,"className")+" widget-tests-take-doing-panel-details"},events:function(){return _.extend({},_.result(VBaseWidgetPanel.prototype,"events"),{})}}),VWidgetTestsTakeDoingPanelTimer=VBaseWidgetPanel.extend({tagName:"div",id:"widget-tests-take-doing-panel-timer",templateID:"tpl-widget-tests-take-doing-panel-timer",className:function(){return _.result(VBaseWidgetPanel.prototype,"className")+" widget-tests-take-doing-panel-timer"},events:function(){return _.extend({},_.result(VBaseWidgetPanel.prototype,"events"),{})}}),VWidgetTestsTakeDoingRecordEditableDisplay=VBaseWidgetRecordEditableDisplay.extend({id:"widget-tests-take-doingrecord-editable-display",templateID:"tpl-widget-tests-take-doing-record-editable-display",className:function(){return _.result(VBaseWidgetRecordEditableDisplay.prototype,"className")+" widget-record-editable-display-flashcard widget-tests-take-doing-record-editable-display"},events:function(){return _.extend({},_.result(VBaseWidgetRecordEditableDisplay.prototype,"events"),{})},filterModelAttributes:function(){var a=_.clone(this.settings.recordSettings.model.attributes);return a.question_text=app.markdownSanitizerConverter.makeHtml(a.question_text),a.answer_text&&(a.answer_text=app.markdownSanitizerConverter.makeHtml(a.answer_text)),a.isShowingAnswer=this.options.recordOptions.isShowingAnswer,a.isShowingTags=this.options.recordOptions.isShowingTags,a}}),VWidgetTestsTakeDoingRecordEditableEdit=VBaseWidgetRecordEditableEdit.extend({id:"widget-tests-take-doing-record-editable-edit",templateID:"tpl-widget-tests-take-doing-record-editable-edit",className:function(){return _.result(VBaseWidgetRecordEditableEdit.prototype,"className")+" widget-record-editable-edit-flashcard widget-tests-take-doing-record-editable-edit"},events:function(){return _.extend({},_.result(VBaseWidgetRecordEditableEdit.prototype,"events"),{})},remove:function(){return this.ws_tags=null,VBaseWidgetRecordEditableEdit.prototype.remove.call(this)},prepareForm:function(){this.ws_tags=new WSelect2({elem:this.jqoForm.find("input[name=tags]"),makeElement:null,filterSelection:null}),this.ws_tags.init({tags:_.map(_.filter(app.store.get("card.tags"),function(a){return!a.is_auto}),function(a){return{id:a.id,text:a.tag_text}}),preventNew:!0}),this.ws_tags.set(_.map(_.filter(this.settings.recordSettings.model.get("tags"),function(a){return!a.is_auto}),function(a){return a.id}))},getFormAttrs:function(){var a=this.jqoForm.serialize_object();if(a.tags=this.ws_tags.getSelection(),a.tags.length){for(var b=[],c=0;c<a.tags.length;c++)b.push({id:a.tags[c].id,tag_text:a.tags[c].text,is_auto:0});a.tags=_.sortBy(b,function(a){return a.tag_text})}return a.order_id=+a.order_id,a.question_text=$.trim(a.question_text),a.answer_text=$.trim(a.answer_text),a.answer_text=a.answer_text.length?a.answer_text:null,a.answer_text||(a.tags=a.tags||[],a.tags.push(_.filter(app.store.get("card.tags"),function(a){return"note"===a.tag_text})[0])),a}}),VWidgetTestsTakeDoingRecordEditable=VBaseWidgetRecordEditable.extend({id:"widget-tests-take-doing-record-editable",templateID:"tpl-widget-tests-take-doing-record-editable",flagDialogTitle:"Flag Flashcard",flagDialogMsg:"<p>Are you sure you want to flag this card as inappropriate?</p>",deleteDialogTitle:"Delete Flashcard",deleteDialogMsg:"<p>Are you sure you want to delete this card? WARNING: THIS CANNOT BE UNDONE!</p>",className:function(){return _.result(VBaseWidgetRecordEditable.prototype,"className")+" widget-record-editable-flashcard widget-tests-take-doing-record-editable"},events:function(){return _.extend({},_.result(VBaseWidgetRecordEditable.prototype,"events"),{})},initialize:function(a,b){VBaseWidgetRecordEditable.prototype.initialize.call(this,a,b)},updateModelURL:function(){var a=this.settings.model.get("set_id"),b=this.settings.slideshowSettings.test.setsInfo,c=_.find(b,function(b){return b.id===a}),d=c.created_by_id;this.settings.model.urlRoot=this.settings.model.baseUrlRoot+"/"+this.settings.slideshowSettings.test.module_id+"/"+d+"/"+a},setToolbarButtonsEnabled:function(){VBaseWidgetRecordEditable.prototype.setToolbarButtonsEnabled.call(this);var a=this.settings.model.get("created_by_id")===app.store.get("user").id;this.isEditing||this.toolbarView.setEnabled({difficulty1:a,difficulty2:a,difficulty3:a,edit:a,flag:!a,"delete":a});var b=_.find(this.settings.model.get("tags"),function(a){return"difficulty1"===a.tag_text}),c=_.find(this.settings.model.get("tags"),function(a){return"difficulty2"===a.tag_text}),d=_.find(this.settings.model.get("tags"),function(a){return"difficulty3"===a.tag_text});this.toolbarView.getButton("difficulty1").removeClass("btn-info btn-default").addClass(b?"btn-info":"btn-default"),this.toolbarView.getButton("difficulty2").removeClass("btn-info btn-default").addClass(c?"btn-info":"btn-default"),this.toolbarView.getButton("difficulty3").removeClass("btn-info btn-default").addClass(d?"btn-info":"btn-default")},instantiateToolbarView:function(){return new VWidgetTestsTakeDoingRecordEditableToolbar},onClickToolbar:function(a,b,c){if(VBaseWidgetRecordEditable.prototype.onClickToolbar.call(this,a,c),b||(b=this.toolbarView.getButton(a)),-1!==a.indexOf("difficulty")&&!b.prop("disabled")){var d=this.settings.model.get("tags"),e=_.find(d,function(b){return b.tag_text===a});e?d.splice(_.indexOf(d,e),1):(d.push(_.find(app.store.get("card.tags"),function(b){return b.tag_text===a})),d=_.sortBy(d,function(a){return a.tag_text})),this.settings.model.save({tags:d},{sbRequestText:"Saving...",wait:!0,success:function(){Spinner.get().hide()}}),this.setToolbarButtonsEnabled()}},instantiateDisplayView:function(a,b){return new VWidgetTestsTakeDoingRecordEditableDisplay(a,b)},instantiateEditView:function(a,b){return new VWidgetTestsTakeDoingRecordEditableEdit(a,b)},onModelError:function(a,b){Spinner.get().hide(function(){var a=app.getAjaxUserError(b);if(400!==b.status||!a||"flag-reputation"!==a.type&&"flag-duplicate"!==a.type)app.dealWithAjaxFail(b,null,null);else{var c=null;c="flag-reputation"===a.type?"You are not able to flag any more content for the moment. Please give the administrators time to evaluate your previous flags.":"You have already flagged that content. Please give the administrators time to evaluate your previous flag.",bsDialog.create({title:"Error!",msg:"<p>"+c+"</p>",ok:function(){}})}})}}),VWidgetTestsTakeDoingRecordEditableToolbar=VBaseWidgetToolbar.extend({id:"widget-tests-take-doing-record-editable-toolbar",templateID:"tpl-widget-tests-take-doing-record-editable-toolbar",className:function(){return _.result(VBaseWidgetToolbar.prototype,"className")+" widget-tests-take-doing-record-editable-toolbar"},events:function(){return _.extend({},_.result(VBaseWidgetToolbar.prototype,"events"),{})}}),VWidgetTestsTakeDoingSlideshow=VBaseWidgetSlideshow.extend({id:"widget-tests-take-doing-slideshow",widgetLayoutTemplateID:"tpl-widget-tests-take-doing-slideshow",toolbarElement:"div.content-toolbar",recordElement:"div.content-record",className:function(){return _.result(VBaseWidgetSlideshow.prototype,"className")+" widget-tests-take-doing-slideshow"},events:function(){return _.extend({},_.result(VBaseWidgetSlideshow.prototype,"events"),{})},initialize:function(a,b){this.correctCardIDs=[],this.isShowingAnswer=!1,this.isShowingTags=b.isShowingTags,VBaseWidgetSlideshow.prototype.initialize.call(this,a,b)},render:function(){return this.captureKeyboard(),VBaseWidgetSlideshow.prototype.render.call(this)},remove:function(){return this.releaseKeyboard(),this.correctCardIDs=null,VBaseWidgetSlideshow.prototype.remove.call(this)},instantiateCollection:function(){return new CardsCollection},instantiateToolbar:function(){return new VWidgetTestsTakeDoingSlideshowToolbar},instantiateRecord:function(){return new VWidgetTestsTakeDoingRecordEditable({slideshowSettings:this.settings,model:this.collection.at(this.idx)},{slideshowOptions:this.options,isShowingAnswer:this.isShowingAnswer,isShowingTags:this.isShowingTags})},updateToolbar:function(){VBaseWidgetSlideshow.prototype.updateToolbar.call(this);var a=this.toolbarView.getEnabled();if(this.toolbarView.setEnabled(_.extend({},a,{show_answer:!!this.collection.length,correct:!!this.collection.length})),this.collection.length){this.toolbarView.getButton("show_answer").removeClass("btn-info btn-default").addClass(this.isShowingAnswer?"btn-info":"btn-default");var b=this.collection.at(this.idx),c=b?_.contains(this.correctCardIDs,b.get("id")):!1;this.toolbarView.getButton("correct").removeClass("btn-success btn-default").addClass(c?"btn-success":"btn-default")}},onClickToolbar:function(a,b,c){if("prev"===a)this.isShowingAnswer=!1;else if("next"===a)this.isShowingAnswer=!1;else if("show_answer"===a)this.isShowingAnswer=!this.isShowingAnswer,this.renderRecord(),this.updateToolbar();else if("correct"===a){var d=this.collection.at(this.idx),e=_.indexOf(this.correctCardIDs,d.get("id"));-1!==e?this.correctCardIDs=_.without(this.correctCardIDs,d.get("id")):this.correctCardIDs.push(d.get("id")),this.updateToolbar()}VBaseWidgetSlideshow.prototype.onClickToolbar.call(this,a,c)},onRecordEdit:function(){this.releaseKeyboard()},onRecordSave:function(){this.captureKeyboard()},onRecordCancel:function(){this.captureKeyboard()},captureKeyboard:function(){$("body").on("keydown",function(a){switch(a.keyCode){case 13:a.preventDefault(),a.stopPropagation()}}),$("body").on("keyup",function(a){if(a.stopPropagation(),a.preventDefault(),!Spinner.get().isShowing())switch(a.keyCode){case 37:this.onClickToolbar("prev");break;case 39:this.onClickToolbar("next");break;case 32:this.onClickToolbar("show_answer");break;case 13:this.onClickToolbar("correct");break;case 27:this.onClickToolbar("end");break;case 49:case 50:case 51:case 97:case 98:case 99:var b=a.keyCode<97?a.keyCode-48:a.keyCode-96;this.recordView&&this.recordView.onClickToolbar("difficulty"+b)}}.bind(this))},releaseKeyboard:function(){$("body").off("keydown"),$("body").off("keyup")}}),VWidgetTestsTakeDoingSlideshowToolbar=VBaseWidgetToolbar.extend({id:"widget-tests-take-doing-slideshow-toolbar",templateID:"tpl-widget-tests-take-doing-slideshow-toolbar",className:function(){return _.result(VBaseWidgetToolbar.prototype,"className")+" widget-slideshow-toolbar widget-tests-take-doing-slideshow-toolbar"},events:function(){return _.extend({},_.result(VBaseWidgetToolbar.prototype,"events"),{})}}),VPageTestsTakeOutro=VBasePage.extend({id:"page-tests-take-outro",pageTemplateID:"tpl-page",contentElement:"div.page-content",footerElement:"div.page-footer-user",footerTemplateID:"tpl-page-footer-user",contentTemplateID:"tpl-page-content-tests-take-outro",className:function(){return _.result(VBasePage.prototype,"className")+" page-tests-take-outro"},panelElement:"div.page-content > div.content-panel",events:function(){return _.extend({},_.result(VBasePage.prototype,"events"),{})},initialize:function(a,b){a.stats.num_correct_string=a.correctCardIDs.length+" / "+a.test.cards.length+" ("+Math.floor(100*(a.correctCardIDs.length/a.test.cards.length))+"%)",this.panelView=null,VBasePage.prototype.initialize.call(this,a,b)},ready:function(){var a=_.extend({},this.settings.stats,this.settings.test);this.panelView=new VWidgetTestsTakeOutroPanel({templateAttrs:a},{}),this.panelView.listenTo(this,"cleanup",this.panelView.remove),this.listenTo(this.panelView,"onPanelOK",this.onPanelOK),this.listenTo(this.panelView,"onPanelCancel",this.onPanelCancel),this.trigger("onPageReady",this)},remove:function(){return this.stopListening(this.panelView),this.panelView=null,VBasePage.prototype.remove.call(this)},render:function(){return VBasePage.prototype.render.call(this),this.$(this.panelElement).html(this.panelView.render().$el),this},onPanelOK:function(){this.trigger("setPage",{pageName:"intro",urlIDs:this.settings.urlIDs,manualData:this.settings.manualData})},onPanelCancel:function(){var b=this.settings.test.module_id;app.router.navigate("#studying/browse/m"+b+"/",{trigger:!0})}}),VWidgetTestsTakeOutroPanel=VBaseWidgetPanel.extend({tagName:"div",id:"widget-tests-take-outro-panel",templateID:"tpl-widget-tests-take-outro-panel",className:function(){return _.result(VBaseWidgetPanel.prototype,"className")+" widget-tests-take-outro-panel"},events:function(){return _.extend({},_.result(VBaseWidgetPanel.prototype,"events"),{"click button[name=button_cancel]":"onClickCancel"})},onClickCancel:function(a){this.trigger("onPanelCancel",a)}}),app={};app.init=function(a){var b=$.browser_support();if(b.passed)$("div.imagePreload").waitForImages(function(){this.JS_ROOT=a.JS_ROOT,this.DOMAIN_ROOT=a.DOMAIN_ROOT,$.includejs.settings.ROOT=app.JS_ROOT,$.includejs.settings.cache=!1,$.tracedError.settings.url="ajax/manual.php/error",$.tracedError.settings.cleanup=function(){},$.tracedError.settings.html=function(){},Spinner.settings.ROOT=app.JS_ROOT,Spinner.settings.title="Studybash",$.ajaxSetup({timeout:3e4}),this.view=null,this.section=null,app.setupOnClickLink(),a.user?(this.store.set("user",a.user),this.prepareForLIU()):this.prepareForNonLIU()
}.bind(this));else{app.gotoSection("browserFail"),$.tracedError.settings.url="ajax/manual.php/error",$.tracedError.settings.cleanup=function(){},$.tracedError.settings.html=function(){};var c="Browser failed the support test. Return object from $.browser_support(): "+JSON.stringify(b);$.tracedError.createTracedError(c)}},app.prepareForLIU=function(){$.storage.settings.BASE="studybash.storage.",this.retrieveUserSettings(),this.setupPagedown(),$.includejs.include({tpl:["studybash.user"],success:function(){$.ajax({url:app.JS_ROOT+"ajax/manual.php/data-LIU",type:"GET",dataType:"json",contentType:"application/json",context:this,beforeSend:function(a){a.setRequestHeader("SESSIONTOKEN",app&&app.store.has("user")?app.store.get("user").token:"unspecified")}}).done(function(a){this.store.set("system_message_interval",a.store.system_message_interval),this.store.set("sharing.types",a.store.sharingTypes),this.store.set("card.tags",a.store.cardTags),this.store.set("institutions",a.store.institutions),this.store.set("semesters",a.store.semesters),this.store.set("classes.years.before",a.store.classes_yearsBefore),this.store.set("classes.years.after",a.store.classes_yearsAfter),this.ready()}).fail(function(a,b,c){app.dealWithAjaxFail(a,b,c)})}.bind(this),error:function(a,b,c,d){b=_.extend({},b,{includeJSOptions:a}),this.dealWithAjaxFail(b,c,d)}.bind(this)})},app.prepareForNonLIU=function(){$.includejs.include({tpl:["studybash.welcome"],success:function(){this.ready()}.bind(this),error:function(a,b,c,d){b=_.extend({},b,{includeJSOptions:a}),this.dealWithAjaxFail(b,c,d)}.bind(this)})},app.ready=function(){this.router=new AppRouter,Backbone.history.start()},app.setupPagedown=function(){function a(a){function b(a){return a.match(/^<img.*>$/i)?a.slice(0,a.length-1)+' class="img-thumbnail">':a.match(/^<a.*>$/i)?a.slice(0,a.length-1)+' class="navigate">':a}return a.replace(/<[^>]*>?/gi,b)}this.markdownSanitizerConverter=Markdown.getSanitizingConverter(),this.markdownSanitizerConverter.hooks.chain("postConversion",a)},app.setupOnClickLink=function(){$("#content").on("click","a.navigate",function(a){var b=$(a.currentTarget),c=b.prop("href"),d=b.hasClass("newtab"),e=c.indexOf(app.DOMAIN_ROOT);"#"===c&&$.tracedError.createTracedError("event: "+JSON.stringify({event:a})),e>=0&&!d?(c=c.slice(e+app.DOMAIN_ROOT.length+1),this.router.navigate(c,{trigger:!0})):window.open(c),a.preventDefault()}.bind(this))},app.store=function(){var a={},b=function(b){return a.hasOwnProperty(b)},c=function(b){return a[b]},d=function(b,c){a[b]=c},f=function(b,c){if(c){var d=[];for(k in a){var e=k.toString().indexOf(b.toString());-1!==e&&d.push(k)}for(var f=0;f<d.length;f++)delete a[d[f]]}else this.has(b)&&delete a[b]};return{has:b,get:c,set:d,rem:f}}(),app.saveUserSettings=function(){var a=this.store.get("user"),b=a.full_name+"("+a.id+").settings";return userSettings=$.storage.get(b)||{},userSettings["modules.show_completed"]=app.store.get("modules.show_completed"),userSettings["sets.isAscending"]=app.store.get("sets.isAscending"),userSettings["sets.sortCriteria"]=app.store.get("sets.sortCriteria"),userSettings["cards.isAscending"]=app.store.get("cards.isAscending"),userSettings["tests.hide_auto"]=app.store.get("tests.hide_auto"),userSettings["tests.users.sortCriteria"]=app.store.get("tests.users.sortCriteria"),userSettings["tests.users.isAscending"]=app.store.get("tests.users.isAscending"),userSettings["tests.isAscending"]=app.store.get("tests.isAscending"),$.storage.set(b,userSettings),userSettings},app.retrieveUserSettings=function(){var a=this.store.get("user"),b=a.full_name+"("+a.id+").settings";userSettings=$.storage.get(b),this.store.rem("isFirstLogin"),userSettings||(userSettings={},1===a.num_logins&&(this.store.set("isFirstLogin",!0),userSettings=this.saveUserSettings()));for(var c in userSettings)if(userSettings.hasOwnProperty(c)){var d=userSettings[c];void 0!==typeof d&&app.store.set(c,d)}},app.getAjaxUserError=function(a){var b=void 0;return a&&a.responseText&&(b=a.responseText.match(/^userError:\((.+)\)\[(.*)\]$/),b=b&&3===b.length?{type:b[1],msg:b[2]}:null),b},app.dealWithAjaxFail=function(a,b,c){400!==a.status&&$.tracedError.createTracedError("app.store.user: \n"+JSON.stringify(app.store.get("user"))+" \nfail parms: "+JSON.stringify({jqXHR:a,textStatus:b,errorThrown:c}));var d=this.getAjaxUserError(a),e=!!d;if(d)switch(d.type){case"not_loggedin":bsDialog.create({title:"Error!",msg:"<p>You have been logged out. Please login again to continue working.</p>",ok:function(){this.cleanupSession()}.bind(this)});break;case"session_token":bsDialog.create({title:"Error!",msg:"<p>Have you logged in elsewhere? If not, please re-login and change your password immediately.</p>",ok:function(){this.cleanupSession()}.bind(this)});break;case"no_session":bsDialog.create({title:"Error!",msg:"<p>Please login first!</p>",ok:function(){this.cleanupSession()}.bind(this)});break;default:d=null}d||(d=400!==a.status||e?"Unexpected Server Response. Please try again!":a.responseText,ColorboxDialog.get("Studybash").open({msg:d,callback:function(){}}))},app.cleanupSession=function(a){this.store.rem("user"),this.systemMsgs&&(this.systemMsgs.shutdown(),this.systemMsgs=null),a||(this.router?this.router.navigate("login/",{trigger:!0}):window.location=app.JS_ROOT)},app.doRedirect=function(a){if(a){if(!this.store.has("user"))return this.router.navigate("login/",{trigger:!0}),!0;if(!this.systemMsgs){this.systemMsgs=bsSystemMsgs;var b=this.systemMsgs.settings;b.title="Studybash (System Messages)",b.url=app.JS_ROOT+"ajax/manual.php/system/msgs",b.user=app.store.get("user"),b.interval=app.store.get("system_message_interval"),this.systemMsgs.begin()}}else if(this.store.has("user"))return this.router.navigate("dash/",{trigger:!0}),!0;return!1},app.gotoSection=function(a,b,c){var d=$("#content");switch(this.view&&(this.view.remove(),this.view=null),a){case"login":this.view=new VSectionAccount({pageName:"login"},function(a){d.html(a.render().$el)},c);break;case"register":this.view=new VSectionAccount({pageName:"register"},function(a){d.html(a.render().$el)},c);break;case"verify":this.view=new VSectionAccount({pageName:"verify"},function(a){d.html(a.render().$el)},c);break;case"reset":this.view=new VSectionAccount({pageName:"reset"},function(a){d.html(a.render().$el)},c);break;case"dash":this.view=new VSectionDash({pageName:"dash"},function(a){d.html(a.render().$el)},c);break;case"classes":this.view=new VSectionClasses({pageName:"classes"},function(a){d.html(a.render().$el)},c);break;case"studying":this.view=new VSectionStudyingBrowse(b,function(a){d.html(a.render().$el)},c);break;case"takeTest":this.view=new VSectionStudyingTakeTest(_.extend({},b,{pageName:"intro"}),function(a){d.html(a.render().$el)},c);break;case"help":b||(b="general"),this.view=new VSectionHelp({pageName:b},function(a){d.html(a.render().$el)},c);break;case"logout":this.view=new VSectionLogout({pageName:"logout"},function(a){d.html(a.render().$el)},c);break;case"notFound":this.view=new VSectionNotfound({pageName:"notfound"},function(a){d.html(a.render().$el)},c);break;case"browserFail":this.view=new VSectionBrowserfail(null,function(a){d.html(a.render().$el)},null)}};var AppRouter=Backbone.Router.extend({routes:{"":"default","login/(*parms)":"login","register/(*parms)":"register","verify/(*parms)":"verify","setpwd/(*parms)":"setpwd","reset/(*parms)":"reset","sendcode/(*parms)":"sendcode","dash/(*parms)":"dash","classes/(*parms)":"classes","studying/":"studying","studying/browse/":"studying","studying/browse/m:moduleID/":"studying","studying/browse/m:moduleID/g:groupID/":"studying","studying/browse/m:moduleID/g:groupID/u:userID/":"studying","studying/browse/m:moduleID/g:groupID/u:userID/:type/":"studying","studying/browse/m:moduleID/g:groupID/u:userID/:type/s:setID/":"studying","studying/taketest/auto/:autoSetID/":"takeTestAuto","studying/taketest/manual/":"takeTestManual","studying/taketest/:testID/":"takeTest","help/(:pageName/)":"help","logout/(*parms)":"logout","*parms":"notFound"},initialize:function(){this.listenTo(this,"all",function(){})},"default":function(){app.store.has("isFirstLogin")?app.router.navigate("help/",{trigger:!0}):app.router.navigate("dash/",{trigger:!0})},login:function(){app.doRedirect(!1)||app.gotoSection("login",null,{sbFromRouter:!0})},register:function(){app.doRedirect(!1)||app.gotoSection("register",null,{sbFromRouter:!0})},verify:function(){app.doRedirect(!1)||app.gotoSection("verify",null,{sbFromRouter:!0})},setpwd:function(){app.doRedirect(!1)||app.gotoSection("verify",null,{sbFromRouter:!0,sbSetPwd:!0})},reset:function(){app.doRedirect(!1)||app.gotoSection("reset",null,{sbFromRouter:!0})},sendcode:function(){app.doRedirect(!1)||app.gotoSection("reset",null,{sbFromRouter:!0,sbSendCode:!0})},dash:function(){app.doRedirect(!0)||app.gotoSection("dash")},classes:function(){app.doRedirect(!0)||app.gotoSection("classes")},studying:function(a,b,c,d,e){app.doRedirect(!0)||app.gotoSection("studying",{urlIDs:{mID:a,gID:b,uID:c,tID:d,sID:e}})},groups:function(a){app.doRedirect(!0)||app.gotoSection("groups",{urlIDs:{mID:a}})},flashcards:function(a,b,c,d){app.doRedirect(!0)||app.gotoSection("flashcards",{urlIDs:{mID:a,gID:b,uID:c,sID:d}})},testsBrowse:function(a,b,c){app.doRedirect(!0)||app.gotoSection("testsBrowse",{urlIDs:{mID:a,gID:b,uID:c}})},takeTestAuto:function(a){app.doRedirect(!0)||app.gotoSection("takeTest",{urlIDs:{aID:a}})},takeTestManual:function(){if(!app.doRedirect(!0)){var a=app.store.get("tests.manual");app.store.rem("tests.manual"),app.gotoSection("takeTest",{manualData:a})}},takeTest:function(a){app.doRedirect(!0)||app.gotoSection("takeTest",{urlIDs:{tID:a}})},help:function(a){app.doRedirect(!0)||app.gotoSection("help",a)},logout:function(){app.doRedirect(!0)||app.gotoSection("logout")},notFound:function(){app.gotoSection("notFound")}});