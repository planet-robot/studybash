var CardsCollection=Backbone.Collection.extend({model:function(a,b){return new CardModel(a,b)},initialize:function(){this.url=app.JS_ROOT+"ajax/studying/cards-backbone.php",this.listenTo(this,"all",function(){}),this.isAscending=!0},sync:function(a,b,c){return c.beforeSend=function(a){a.setRequestHeader("SESSIONTOKEN",app&&app.store.has("user")?app.store.get("user").token:"unspecified")},Backbone.sync(a,b,c)},comparator:function(a,b){var c=a.get("order_id")<b.get("order_id")||a.get("order_id")===b.get("order_id")&&a.get("id")<b.get("id");if(c)return-1*[-1,1][+!!this.isAscending];var d=a.get("order_id")===b.get("order_id")&&a.get("id")===b.get("id");return d?0:1*[-1,1][+!!this.isAscending]},parse:function(a){return a}}),CardsCollectionUnsorted=CardsCollection.extend({comparator:function(){}}),EnrollmentCollection=Backbone.Collection.extend({model:function(a,b){return new EnrollmentModel(a,b)},initialize:function(){this.url=app.JS_ROOT+"ajax/classes-backbone.php",this.listenTo(this,"all",function(){})},sync:function(a,b,c){return c.beforeSend=function(a){a.setRequestHeader("SESSIONTOKEN",app.store.get("user").token)},Backbone.sync(a,b,c)},comparator:function(a,b){var c=a.get("completed")<b.get("completed")||a.get("completed")==b.get("completed")&&a.get("year")>b.get("year")||a.get("completed")==b.get("completed")&&a.get("year")==b.get("year")&&a.get("semester_order_id")>b.get("semester_order_id")||a.get("completed")==b.get("completed")&&a.get("year")==b.get("year")&&a.get("semester_order_id")==b.get("semester_order_id")&&a.get("subject_code")<b.get("subject_code")||a.get("completed")==b.get("completed")&&a.get("year")==b.get("year")&&a.get("semester_order_id")==b.get("semester_order_id")&&a.get("subject_code")==b.get("subject_code")&&a.get("class_code")<b.get("class_code");if(c)return-1;var d=a.get("completed")==b.get("completed")&&a.get("year")==b.get("year")&&a.get("semester_order_id")==b.get("semester_order_id")&&a.get("subject_code")==b.get("subject_code")&&a.get("class_code")==b.get("class_code");return d?0:1},parse:function(a){return a}}),GroupsCollection=Backbone.Collection.extend({model:function(a,b){return new GroupModel(a,b)},initialize:function(){},comparator:function(a,b){var c=+a.get("id")===a.get("id"),d=+b.get("id")===b.get("id"),e="self"===a.get("id")||"pub"===a.get("id")&&d||c===d==!0&&a.get("is_user_member")<b.get("is_user_member")||c===d==!0&&a.get("is_user_member")===b.get("is_user_member")&&a.get("is_user_owner")>b.get("is_user_owner")||c===d==!0&&a.get("is_user_member")===b.get("is_user_member")&&a.get("is_user_owner")===b.get("is_user_owner")&&a.get("owner_last_name")<b.get("owner_last_name")||c===d==!0&&a.get("is_user_member")===b.get("is_user_member")&&a.get("is_user_owner")===b.get("is_user_owner")&&a.get("owner_last_name")===b.get("owner_last_name")&&a.get("owner_first_name")<b.get("owner_first_name");if(e)return-1;var f=c===d==!0&&a.get("is_user_member")===b.get("is_user_member")&&a.get("is_user_owner")===b.get("is_user_owner")&&a.get("owner_last_name")===b.get("owner_last_name")&&a.get("owner_first_name")===b.get("owner_first_name");return f?0:1}}),SetsCollection=Backbone.Collection.extend({model:function(a,b){return new SetModel(a,b)},initialize:function(){this.url=app.JS_ROOT+"ajax/studying/sets-backbone.php",this.listenTo(this,"all",function(){}),this.sortCriteria="name",this.isAscending=!0},sync:function(a,b,c){return c.beforeSend=function(a){a.setRequestHeader("SESSIONTOKEN",app&&app.store.has("user")?app.store.get("user").token:"unspecified")},Backbone.sync(a,b,c)},comparator:function(a,b){if("cards"===this.sortCriteria){var c="num_filtered_cards",d=a.get(c)<b.get(c)||a.get(c)===b.get(c)&&a.get("set_name")<b.get("set_name")||a.get(c)===b.get(c)&&a.get("set_name")===b.get("set_name")&&a.get("description")<b.get("description");if(d)return-1*[-1,1][+!!this.isAscending];var e=a.get(c)===b.get(c)&&a.get("set_name")===b.get("set_name")&&a.get("description")===b.get("description");return e?0:1*[-1,1][+!!this.isAscending]}var d=a.get("set_name")<b.get("set_name")||a.get("set_name")===b.get("set_name")&&a.get("description")<b.get("description");if(d)return-1*[-1,1][+!!this.isAscending];var e=a.get("set_name")==b.get("set_name")&&a.get("description")==b.get("description");return e?0:1*[-1,1][+!!this.isAscending]},parse:function(a){return a}}),TestsCollection=Backbone.Collection.extend({model:function(a,b){return new TestModel(a,b)},initialize:function(){this.url=app.JS_ROOT+"ajax/studying/tests-backbone.php",this.listenTo(this,"all",function(){}),this.isAscending=!0},sync:function(a,b,c){return c.beforeSend=function(a){a.setRequestHeader("SESSIONTOKEN",app&&app.store.has("user")?app.store.get("user").token:"unspecified")},Backbone.sync(a,b,c)},comparator:function(a,b){var c=a.get("is_auto_test")>b.get("is_auto_test")||a.get("is_auto_test")===b.get("is_auto_test")&&a.get("test_name")>b.get("test_name")||a.get("is_auto_test")===b.get("is_auto_test")&&a.get("test_name")==b.get("test_name")&&a.get("description")>b.get("description");if(c)return-1*[1,-1][+!!this.isAscending];var d=a.get("is_auto_test")==b.get("is_auto_test")&&a.get("test_name")==b.get("test_name")&&a.get("description")==b.get("description");return d?0:1*[1,-1][+!!this.isAscending]},parse:function(a){return a}}),TypesCollection=Backbone.Collection.extend({model:function(a,b){return new TypeModel(a,b)},initialize:function(){},comparator:function(a,b){var c="Flashcards"===a.get("type_name");if(c)return-1;var d=a.get("type_name")===b.get("type_name");return d?0:1}}),UsersCollection=Backbone.Collection.extend({model:function(a,b){return new UserModel(a,b)},initialize:function(){this.url=app.JS_ROOT+"ajax/user.php",this.listenTo(this,"all",function(){}),this.sortCriteria="name",this.isAscending=!0},sync:function(a,b,c){return c.beforeSend=function(a){a.setRequestHeader("SESSIONTOKEN",app&&app.store.has("user")?app.store.get("user").token:"unspecified")},Backbone.sync(a,b,c)},comparator:function(a,b){var c=a.get("id")===app.store.get("user").id,d=b.get("id")===app.store.get("user").id;if("cards"===this.sortCriteria||"tests"===this.sortCriteria){var e="cards"===this.sortCriteria?"num_filtered_cards":"num_tests",f=a.get(e)<b.get(e)||a.get(e)===b.get(e)&&a.get("last_name")<b.get("last_name")||a.get(e)===b.get(e)&&a.get("last_name")===b.get("last_name")&&a.get("first_name")<b.get("first_name");if(f)return-1*[-1,1][+!!this.isAscending];var g=a.get(e)===b.get(e)&&a.get("last_name")===b.get("last_name")&&a.get("first_name")===b.get("first_name");return g?0:1*[-1,1][+!!this.isAscending]}var f=c>d||c===d&&a.get("last_name")<b.get("last_name")||c===d&&a.get("last_name")===b.get("last_name")&&a.get("first_name")<b.get("first_name");if(f)return-1*[-1,1][+!!this.isAscending];var g=c===d&&a.get("last_name")==b.get("last_name")&&a.get("first_name")==b.get("first_name");return g?0:1*[-1,1][+!!this.isAscending]},parse:function(a){return a}}),CardModel=Backbone.Model.extend({defaults:{id:void 0,set_id:void 0,order_id:void 0,question_text:void 0,answer_text:null,created_on:void 0},initialize:function(){this.urlRoot=app.JS_ROOT+"ajax/studying/cards-backbone.php",this.baseUrlRoot=this.urlRoot,this.listenTo(this,"all",function(){})},sync:function(a,b,c){return c.beforeSend=function(a){a.setRequestHeader("SESSIONTOKEN",app&&app.store.has("user")?app.store.get("user").token:"unspecified")},Backbone.sync(a,b,c)},validate:function(a){if(a.id){var c=new RegExp("^[0-9]+$");if(!c.test(a.order_id))return{msg:"<strong>Order ID</strong>: Please enter a value of zero or above",field:"order_id"}}if(!a.question_text.length||a.question_text.length>14336)return{msg:"<strong>Question</strong>: 1-14336 chars long",field:"question_text"};if(a.answer_text&&a.answer_text.length&&a.answer_text.length>4096)return{msg:"<strong>Answer</strong>: 0-4096 chars long",field:"answer_text"};if(a.tags&&a.tags.length){var d=_.uniq(a.tags,!1,function(a){return a.id});if(d.length!==a.tags.length)return{msg:"<strong>Tags</strong>: No duplicates",field:"tags"}}}}),EnrollmentModel=Backbone.Model.extend({defaults:{subject_code:void 0,class_code:void 0,semester:void 0,semester_order_id:void 0,semester_description:void 0,year:void 0,class_name:null,lecturer_name:null,textbook_url:null,completed:void 0},initialize:function(){this.urlRoot=app.JS_ROOT+"ajax/classes-backbone.php",this.listenTo(this,"all",function(){})},sync:function(a,b,c){return c.beforeSend=function(a){a.setRequestHeader("SESSIONTOKEN",app.store.get("user").token)},Backbone.sync(a,b,c)},validate:function(a){if(!a.subject_code||!a.class_code)return{msg:"<strong>Subject/Class Code</strong>: Format is, e.g., PSYC 101",field:"codes"};var c=new RegExp("^[A-Z]{3,6}$");if(!c.test(a.subject_code))return{msg:"<strong>Subject Code</strong>: 3-6 chars long, charset: [<em>A-Z</em>]",field:"codes"};if(c=new RegExp("^[-A-Z0-9.]{3,12}$"),!c.test(a.class_code))return{msg:"<strong>Class Code</strong>: 3-12 chars long, charset: <em>A-Z</em>, <em>0-9</em>, <em>-.</em>",field:"codes"};if(!a.year)return{msg:"<strong>Year</strong>: Please pick a year",field:"year"};if(!a.semester)return{msg:"<strong>Semester</strong>: Please pick a semester",field:"semester"};if(a.class_name&&a.class_name.length){if(a.class_name.length<4||a.class_name.length>64)return{msg:"<strong>Class Name</strong>: Please make it between 4-64 chars",field:"class_name"};if(c=new RegExp("^[-,+ A-z0-9()']+$"),!c.test(a.class_name))return{msg:"<strong>Class Name</strong>: Available charset: <em>A-z</em>, <em>0-9</em>, <em>-.!&,()'</em>",field:"class_name"}}if(a.lecturer_name&&a.lecturer_name.length){if(a.lecturer_name.length<4||a.lecturer_name.length>64)return{msg:"<strong>Lecturer Name</strong>: Please make it between 4-64 chars",field:"lecturer_name"};if(c=new RegExp("^[-. A-Za-z0-9()]+$"),!c.test(a.lecturer_name))return{msg:"<strong>Lecturer Name</strong>: Available charset: <em>A-z</em>, <em>0-9</em>, <em>-.()</em>",field:"lecturer_name"}}if(a.textbook_url&&a.textbook_url.length){if(a.textbook_url.length>128)return{msg:"<strong>Textbook URL</strong>: Please make it less than 128 chars",field:"textbook_url"};if(c=new RegExp("^(http[s]?:\\/\\/(www\\.)?|ftp:\\/\\/(www\\.)?|(www\\.)?){1}([0-9A-Za-z-\\.@:%_\u200c\u200b+~#=]+)+((\\.[a-zA-Z]{2,3})+)(/(.)*)?(\\?(.)*)?"),!c.test(a.textbook_url))return{msg:"<strong>Textbook URL</strong>: Please make it a valid URL (or leave it empty)",field:"textbook_url"}}}}),GroupModel=Backbone.Model.extend({defaults:{id:void 0,num_members:void 0,owner_first_name:void 0,owner_last_name:void 0,owner_id:void 0,created_on:void 0,code:void 0,is_user_member:void 0,is_user_owner:void 0},initialize:function(){this.urlRoot=app.JS_ROOT+"ajax/studying/groups-backbone.php",this.baseUrlRoot=this.urlRoot,this.listenTo(this,"all",function(){})},sync:function(a,b,c){return c.beforeSend=function(a){a.setRequestHeader("SESSIONTOKEN",app&&app.store.has("user")?app.store.get("user").token:"unspecified")},Backbone.sync(a,b,c)},validate:function(a){if(!a.code)return{msg:"<strong>Code</strong>: Please set a search code for the group",field:"code"};var c=new RegExp("^[A-z0-9]{6}$");return c.test(a.code)?void 0:{msg:"<strong>Code</strong>: 6 chars long, charset: [<em>A-z</em>, <em>0-9</em>]",field:"code"}}}),SetModel=Backbone.Model.extend({defaults:{set_name:void 0,description:null,sharing:void 0,has_auto_test:void 0,created_on:void 0,created_by:void 0,num_filtered_cards:void 0},initialize:function(){this.urlRoot=app.JS_ROOT+"ajax/studying/sets-backbone.php",this.baseUrlRoot=this.urlRoot,this.listenTo(this,"all",function(){})},sync:function(a,b,c){return c.beforeSend=function(a){a.setRequestHeader("SESSIONTOKEN",app&&app.store.has("user")?app.store.get("user").token:"unspecified")},Backbone.sync(a,b,c)},validate:function(a){var c=new RegExp("^[-!.,& A-z0-9'\"()\\[\\]]{1,32}$");return c.test(a.set_name)?a.description&&a.description.length&&(c=new RegExp("^[-!.,& A-z0-9'\"()\\[\\]]{1,64}$"),!c.test(a.description))?{msg:"<strong>Description</strong>: 0-64 chars long, charset: [<em>A-Z</em>, <em>0-9</em>, <em>-! .,&()[]'\"</em>]",field:"description"}:a.sharing?void 0:{msg:"<strong>Sharing</strong>: Please pick a value",field:"sharing"}:{msg:"<strong>Name</strong>: 1-32 chars long, charset: [<em>A-Z</em>, <em>0-9</em>, <em>-! .,&()[]'\"</em>]",field:"set_name"}}}),TestModel=Backbone.Model.extend({defaults:{test_name:void 0,description:null,sharing:void 0,setIDs:void 0,keywords:void 0,tags:void 0,is_auto_test:void 0,created_on:void 0},initialize:function(){this.urlRoot=app.JS_ROOT+"ajax/studying/tests-backbone.php",this.baseUrlRoot=this.urlRoot,this.listenTo(this,"all",function(){})},sync:function(a,b,c){return c.beforeSend=function(a){a.setRequestHeader("SESSIONTOKEN",app&&app.store.has("user")?app.store.get("user").token:"unspecified")},Backbone.sync(a,b,c)},validate:function(a){var c=new RegExp("^[-!.,& A-z0-9'\"()\\[\\]]{1,32}$");if(!c.test(a.test_name))return{msg:"<strong>Name</strong>: 1-32 chars long, charset: [<em>A-Z</em>, <em>0-9</em>, <em>-! .,&()[]'\"</em>]",field:"test_name"};if(a.description&&a.description.length&&(c=new RegExp("^[-!.,& A-z0-9'\"()\\[\\]]{1,64}$"),!c.test(a.description)))return{msg:"<strong>Description</strong>: 0-64 chars long, charset: [<em>A-Z</em>, <em>0-9</em>, <em>-! .,&()[]'\"</em>]",field:"description"};if(!a.sharing)return{msg:"<strong>Sharing</strong>: Please pick a value",field:"sharing"};if(!a.setIDs.length)return{msg:"<strong>Sets</strong>: Please pick some sets",field:"sets"};if(a.keywords&&a.keywords.length){var d=_.uniq(a.keywords);if(d.length!==a.keywords.length)return{msg:"<strong>Keywords</strong>: No duplicates",field:"keywords"}}if(a.tags&&a.tags.length){var e=_.uniq(a.tags);if(e.length!==a.tags.length)return{msg:"<strong>Tags</strong>: No duplicates",field:"tags"}}}}),TypeModel=Backbone.Model.extend({defaults:{id:void 0,type_name:void 0,count:void 0},initialize:function(){this.urlRoot=app.JS_ROOT+"_ajax/user.php",this.listenTo(this,"all",function(){})},sync:function(a,b,c){return c.beforeSend=function(a){a.setRequestHeader("SESSIONTOKEN",app&&app.store.has("user")?app.store.get("user").token:"unspecified")},Backbone.sync(a,b,c)},validate:function(a){return"cards"!==a.id&&"tests"!==a.id?{msg:"<strong>ID</strong>: Please set a valid ID",field:"id"}:"number"!==$.gettype(a.count).base?{msg:"<strong>Count</strong>: Please provide a count value",field:"count"}:void 0}}),UserModel=Backbone.Model.extend({defaults:{institution_id:void 0,email:void 0,password:void 0,status:void 0,full_name:void 0,registered_on:void 0,last_login:void 0,num_logins:void 0,verification_code:void 0},initialize:function(){this.urlRoot=app.JS_ROOT+"_ajax/user.php",this.listenTo(this,"all",function(){})},sync:function(a,b,c){return c.beforeSend=function(a){a.setRequestHeader("SESSIONTOKEN",app.store.get("user").token)},Backbone.sync(a,b,c)},validate:function(a,b){if("register"===b.func){a.full_name=$.trim(a.full_name);var c=a.full_name.split(" ");if(c.length<2||c.length>3)return{msg:"<strong>Name</strong>: Please enter your full name",field:"full_name"};if(re=new RegExp("^[- A-Za-z']{5,64}$"),!re.test(a.full_name))return{msg:"<strong>Name</strong>: 5-64 chars long, charset: <em>A-z</em>, <em>-'</em>",field:"full_name"};a.email=$.trim(a.email);var d=$.leftovers.parse.validate_string({str:a.email?a.email:"",field:"Email",match_type:"email"});if(!d.passed)return{msg:"<strong>Email</strong>: Please enter a valid email address",field:"email"};var e=a.email?a.email.split("@"):["",""],d=_.find(b.institutions,function(a){return a.email_suffix=e[1]});if(!d){msg="<strong>Email</strong>: I'm sorry but we only support the following institutions at the moment: ";var f=msg.length;return $.each(b.institutions_email_suffixes,function(a,b){msg.length!==f&&(msg+=", "),msg+=b}),{msg:msg,field:"email"}}}return("verify"==b.func||"update"==b.func)&&(a.password=$.trim(a.password),a.password.length<6||a.password.length>64)?{msg:"<strong>Password</strong>: 6-64 chars long",field:"password"}:void 0}}),VBasePage=Backbone.View.extend({tagName:"div",id:void 0,className:"page",pageTemplateID:void 0,contentTemplateID:void 0,footerTemplateID:void 0,contentElement:void 0,footerElement:void 0,events:{},initialize:function(a,b){this.settings=a||{},this.options=b||{}},loadData:function(){this.ready()},getContentAttributes:function(){return{}},ready:function(){this.trigger("onPageReady",this)},remove:function(){return this.settings=null,this.options=null,this.trigger("cleanup"),Backbone.View.prototype.remove.call(this)},render:function(){return this.$el.html($.includejs.getTemplate(this.pageTemplateID)),this.contentTemplateID&&this.$(this.contentElement).html($.includejs.getTemplate(this.contentTemplateID,this.getContentAttributes())),this.$(this.footerElement).html($.includejs.getTemplate(this.footerTemplateID)),this}}),VBaseSection=Backbone.View.extend({tagName:"div",id:void 0,className:"section",sectionTemplateID:void 0,headerTemplateID:void 0,headerElement:void 0,pageElement:void 0,menuClassNameActive:void 0,events:{},initialize:function(a,b,c){this.setPage(a,function(){b(this)}.bind(this),c)},remove:function(){return this.trigger("cleanup"),this.stopListening(this.pageView),this.pageView=null,Backbone.View.prototype.remove.call(this)},setPage:function(a,b,c){var d=this.setURL(a,c);if("string"===$.gettype(d).base)app.router.navigate(d,{trigger:!1});else if(d===!1)return app.gotoSection("notFound"),void 0;return this.pageView&&(this.stopListening(this.pageView),this.pageView.remove()),this.pageView=this.instantiatePageView(a,c),this.pageView?(this.pageView.listenTo(this,"cleanup",this.pageView.remove),this.listenTo(this.pageView,"setPage",this.setPage),this.listenTo(this.pageView,"onPageReady",function(){b?b(this):this.renderPage()}.bind(this)),this.listenTo(this.pageView,"onPageFailed",function(){Spinner.get().hide(function(){app.gotoSection("notFound")})}.bind(this)),this.pageView.loadData(),void 0):(app.gotoSection("notFound"),void 0)},render:function(){return this.$el.html($.includejs.getTemplate(this.sectionTemplateID)),this.$(this.headerElement).html($.includejs.getTemplate(this.headerTemplateID)),this.menuClassNameActive&&(this.$(this.headerElement).find("li").removeClass("active"),this.$(this.headerElement).find("li."+this.menuClassNameActive).addClass("active")),this.renderPage(),this},renderPage:function(){this.$(this.pageElement).html(this.pageView.render().$el),Spinner.get().hide()}}),VBaseWidgetBreadcrumbCrumb=Backbone.View.extend({tagName:"li",id:void 0,className:"widget widget-breadcrumb-crumb",events:{},initialize:function(a){this.numCrumb=a.numCrumb,this.totalCrumbs=a.totalCrumbs,this.maxDisplayLength=a.maxDisplayLength,this.crumb=a.crumb,this.$el.data("crumb",this.crumb)},remove:function(){return this.trigger("cleanup"),this.crumb=null,this.stopListening(),Backbone.View.prototype.remove.call(this)},render:function(){var a=$.leftovers.parse.crop_string(this.crumb.displayStr,this.maxDisplayLength),b=$("<a></a>").prop("href","#").addClass(this.numCrumb===this.totalCrumbs?"active":"").html(a);return this.$el.html(b),this}}),VBaseWidgetBreadcrumb=Backbone.View.extend({tagName:"ol",className:"widget widget-breadcrumb",id:void 0,templateID:void 0,events:{"click a.crumb":"onClickCrumb"},initialize:function(a){this.crumbs=this.generateCrumbs(a.data)},generateCrumbs:function(){return null},remove:function(){return this.crumbs=null,this.trigger("cleanup"),Backbone.View.prototype.remove.call(this)},hasValidCrumbs:function(){return null!==this.crumbs},render:function(){if(this.hasValidCrumbs()){this.$el.html($.includejs.getTemplate(this.templateID,{crumbs:this.crumbs}));for(var a=this.$("a.crumb"),b=0;b<a.length;b++)b<this.crumbs.length&&$(a[b]).data("crumbData",this.crumbs[b].crumbData)}return this},onClickCrumb:function(a){this.trigger("onClickCrumb",$(a.currentTarget).data("crumbData")),a.preventDefault(),a.stopPropagation()}}),VBaseWidgetForm=Backbone.View.extend({tagName:"div",id:void 0,className:"widget widget-form",templateID:void 0,successAlertText:void 0,alertTemplateID:"tpl-alert",alertDismissTemplateID:"tpl-alert-dismiss",allowDefaultSubmit:!1,formName:void 0,events:{"click button[name=button_save]":"onClickSave","click button[name=button_cancel]":"onClickCancel","submit form":"onSubmit"},initialize:function(a,b){this.settings=a||{},this.options=b||{},$("body").on("keyup",null,{context:this},this.onEscapeKey),this.createFreshAttrs()},remove:function(){return $("body").off("keyup",null,this.onEscapeKey),this.trigger("cleanup"),this.attrs=null,this.attrsOptions=null,this.settings=null,this.options=null,this.jqoForm=null,Backbone.View.prototype.remove.call(this)},render:function(){var a=this.getDefaultAttrsForTemplate();return this.$el.html($.includejs.getTemplate(this.templateID,a)),this.jqoForm=this.$("form"),this.prepareForm(),this.jqoForm.find("*[data-toggle=tooltip]").tooltip(),this},getDefaultAttrsForTemplate:function(){return{}},prepareForm:function(){},createFreshAttrs:function(){this.attrs=null,this.attrsOptions=null},clearFormFeedback:function(){this.jqoForm.find("div.alert").remove(),this.jqoForm.find(".has-error").removeClass("has-error")},clearFormFields:function(){this.jqoForm.find("input").not("[type='checkbox']").val(""),this.jqoForm.find("input[type='checkbox']").prop("checked",!1),this.jqoForm.find("textarea").val("")},enableSaveButton:function(){this.$("button[name=button_save]").prop("disabled",!1)},disableSaveButton:function(){this.$("button[name=button_save]").prop("disabled",!0)},onEscapeKey:function(a){var b=a.data.context;switch(a.keyCode){case 27:b.onClickCancel(a)}},onClickSave:function(a){this.clearFormFeedback();var b=this.getFormAttrs(),c=this.validateAttrs(b);"undefined"===$.gettype(c).base?this.onAttrsValid(b):null!==c&&this.onAttrsInvalid(c),a&&(a.preventDefault(),a.stopPropagation())},onClickCancel:function(){this.trigger("onFormCancel")},onSubmit:function(a){if(this.attrs){this.allowDefaultSubmit||(a.preventDefault(),a.stopPropagation());var b=this.attrs,c=this.attrsOptions;this.createFreshAttrs(),this.trigger("onFormSubmit",this.formName,b,c),b=c=null}else a.preventDefault(),a.stopPropagation(),this.onClickSave(null)},onAttrsInvalid:function(a){this.clearFormFeedback();var b=$.includejs.getTemplate(this.alertTemplateID,{msg:a.msg,classes:"alert-danger"});this.jqoForm.prepend(b);var c=this.jqoForm.find("input[name="+a.field+"]");c=c.length?c:this.jqoForm.find("textarea[name="+a.field+"]"),c.length&&c.parent().addClass("has-error")},onAttrsValid:function(a){if(this.clearFormFields(),this.clearFormFeedback(),this.successAlertText){var b=$.includejs.getTemplate(this.alertDismissTemplateID,{classes:"alert-success",msg:"<strong>Success!</strong> - "+_.result(this,"successAlertText")});this.jqoForm.prepend(b)}this.attrs=a||{},this.attrsOptions=null,this.jqoForm.submit()}}),VBaseWidgetFormCreate=VBaseWidgetForm.extend({id:void 0,templateID:void 0,successAlertText:void 0,alertTemplateID:"tpl-alert",alertDismissTemplateID:"tpl-alert-dismiss",requestText:void 0,allowDefaultSubmit:!1,formName:void 0,className:function(){return _.result(VBaseWidgetForm.prototype,"className")+" widget-form-create"},events:function(){return _.extend({},_.result(VBaseWidgetForm.prototype,"events"),{})},remove:function(){return this.stopListening(this.attrs),VBaseWidgetForm.prototype.remove.call(this)},createFreshAttrs:function(){this.attrs&&(this.stopListening(this.attrs),this.attrs=null),this.attrs=this.instantiateModel(),this.listenTo(this.attrs,"request",this.onModelRequest),this.listenTo(this.attrs,"invalid",this.onAttrsInvalid),this.listenTo(this.attrs,"sync",this.onAttrsValid),this.listenTo(this.attrs,"error",this.onModelError)},validateAttrs:function(a){return this.attrs.save(a,{wait:!0}),null},onModelRequest:function(){this.clearFormFeedback(),Spinner.get().show({msg:this.requestText,opacity:0})},onAttrsInvalid:function(a,b){VBaseWidgetForm.prototype.onAttrsInvalid.call(this,b)},onAttrsValid:function(a,b,c){if(this.clearFormFields(),this.clearFormFeedback(),this.successAlertText){var d=$.includejs.getTemplate(this.alertDismissTemplateID,{classes:"alert-success",msg:"<strong>Success!</strong> - "+this.successAlertText});this.jqoForm.prepend(d)}this.attrs=a,this.attrsOptions=c,this.jqoForm.submit(),Spinner.get().hide()},onModelError:function(a,b){Spinner.get().hide(function(){app.dealWithAjaxFail(b,null,null)})}}),VBaseWidgetList=Backbone.View.extend({tagName:"div",id:void 0,className:"widget widget-list",events:{},initialize:function(a,b){this.settings=a||{},this.options=b||{},this.collection=this.instantiateCollection(),this.listenTo(this.collection,"add",this.onAddCollection),this.listenTo(this.collection,"change",this.onChangeCollection),this.listenTo(this.collection,"remove",this.onRemoveCollection),this.listenTo(this.collection,"sort",this.onSortCollection),this.listenTo(this,"onExternalAdd",this.onExternalAdd),this.listenTo(this,"onExternalRemove",this.onExternalRemove),this.buildCollection(this.settings.listData)},remove:function(){return this.trigger("cleanup"),this.stopListening(),this.collection=null,this.settings=null,this.options=null,Backbone.View.prototype.remove.call(this)},render:function(){return this},buildCollection:function(a){for(var b=0;b<a.length;b++){var c=new this.instantiateModel;c.set(a[b],{silent:!0}),this.collection.add(c,{sbTargetModel:c,sbPrevIdx:-1}),c=null}},getSelected:function(){return this.$(".widget-record-editable-selected")},getFilteredRecordViews:function(a){return this.$(a)},clearSelected:function(){var a=this.$(".widget-record-editable-selected");return a.removeClass("widget-record-editable-selected"),a.length},onClickRecord:function(a,b){this.trigger("onClickRecord",a,b)},onRecordFlag:function(a,b,c){c.sbKeepRecord||this.collection.remove(a)},onRecordEdit:function(a){this.clearSelected(),a.makeSelected()},onRecordSave:function(){},onRecordCancel:function(a){a.removeSelected()},onRecordDeleteMaybe:function(a){this.clearSelected(),a.makeSelected()},onRecordDeleteYes:function(){},onRecordDeleteNo:function(a){a.removeSelected()},onExternalAdd:function(a,b){var c=null;c=a instanceof Backbone.Model?a:this.instantiateModel().set(a),this.collection.add(c,_.extend({},{sbTargetModel:c,sbPrevIdx:-1},b))},onExternalRemove:function(a){var b=this.collection.find(a);return b?(this.collection.remove(b),b=null,!0):!1},onAddCollection:function(a,b,c){var d=this.instantiateWidgetRecordEditable({model:a,listSettings:this.settings},_.extend({},{listOptions:this.options},c));return this.listenTo(d,"onClickRecord",this.onClickRecord),this.listenTo(d,"onRecordFlag",this.onRecordFlag),this.listenTo(d,"onRecordEdit",this.onRecordEdit),this.listenTo(d,"onRecordSave",this.onRecordSave),this.listenTo(d,"onRecordCancel",this.onRecordCancel),this.listenTo(d,"onRecordDeleteMaybe",this.onRecordDeleteMaybe),this.listenTo(d,"onRecordDeleteYes",this.onRecordDeleteYes),this.listenTo(d,"onRecordDeleteNo",this.onRecordDeleteNo),d.listenTo(this,"cleanup",d.remove),d},onRemoveCollection:function(a){a.trigger("getView",function(a){this.stopListening(a),a.remove()}.bind(this))},onChangeCollection:function(a){var c=this.collection.indexOf(a);this.collection.sort({sbTargetModel:a,sbPrevIdx:c})},onSortCollection:function(a,b){var c=this.collection.indexOf(b.sbTargetModel),d=this.collection.at(c+1);c!==b.sbPrevIdx&&(d?d.trigger("getView",function(a){b.sbTargetModel.trigger("getView",function(b){a.$el.before(b.render().$el)}.bind(this))}.bind(this)):b.sbTargetModel.trigger("getView",function(a){this.$el.append(a.render().$el)}.bind(this)))}}),VBaseWidgetPanel=Backbone.View.extend({tagName:"div",className:"widget widget-panel",templateID:void 0,events:{"click button[name=button_ok]":"onClickOK"},initialize:function(a,b){this.settings=a||{},this.options=b||{}},remove:function(){return this.settings=null,this.options=null,this.trigger("cleanup"),Backbone.View.prototype.remove.call(this)},render:function(){return this.$el.html($.includejs.getTemplate(this.templateID,this.settings.templateAttrs)),this.$("*[data-toggle=tooltip]").tooltip(),this.delegateEvents(),this},onClickOK:function(a){this.trigger("onPanelOK"),a.preventDefault()},enableOKButton:function(){this.$("button[name=button_ok]").prop("disabled",!1)},disableOKButton:function(){this.$("button[name=button_ok]").prop("disabled",!0)}}),VBaseWidgetRecordEditableDisplay=Backbone.View.extend({tagName:"div",className:"widget widget-record-editable-display",templateID:void 0,initialize:function(a,b){this.settings=a||{},this.options=b||{}},remove:function(){return this.trigger("cleanup"),this.settings=null,this.options=null,Backbone.View.prototype.remove.call(this)},render:function(){var a=this.filterModelAttributes();return this.$el.html($.includejs.getTemplate(this.templateID,a)),this.$("*[data-toggle=tooltip]").tooltip(),this},filterModelAttributes:function(){return _.clone(this.settings.recordSettings.model.attributes)}}),VBaseWidgetRecordEditableEdit=Backbone.View.extend({tagName:"div",id:void 0,className:"widget widget-record-editable-edit",templateID:void 0,alertTemplateID:"tpl-alert",events:{"click button[name=button_save]":"onClickSave","click button[name=button_cancel]":"onClickCancel"},initialize:function(a,b){this.settings=a||{},this.options=b||{},this.listenTo(this.settings.recordSettings.model,"invalid",this.onModelInvalid),this.listenTo(this.settings.recordSettings.model,"change",this.onModelChange)},remove:function(){return this.trigger("cleanup"),this.stopListening(this.settings.recordSettings.model),this.settings=null,this.options=null,Backbone.View.prototype.remove.call(this)},render:function(){var a=this.filterModelAttributes();return this.$el.html($.includejs.getTemplate(this.templateID,a)),this.jqoForm=this.$("form"),this.prepareForm(),this},filterModelAttributes:function(){return _.clone(this.settings.recordSettings.model.attributes)},clearFormFeedback:function(){this.jqoForm.find("div.alert").remove(),this.jqoForm.find(".has-error").removeClass("has-error")},prepareForm:function(){},onClickSave:function(){this.clearFormFeedback();var b=this.getFormAttrs();this.settings.recordSettings.model.changedAttributes(b)?this.settings.recordSettings.model.save(b,{sbRequestText:"Saving...",wait:!0}):this.onClickCancel()},onClickCancel:function(){this.trigger("onEditCancel")},onModelInvalid:function(a,b){this.clearFormFeedback();var d=$.includejs.getTemplate(this.alertTemplateID,{msg:b.msg,classes:"alert-danger"});this.jqoForm.prepend(d);var e=this.jqoForm.find("input[name="+b.field+"]");e.length&&e.parent().addClass("has-error")},onModelChange:function(a,b){this.trigger("onEditSave",a,b),Spinner.get().hide()}}),VBaseWidgetRecordEditable=Backbone.View.extend({tagName:"div",className:"widget widget-record-editable",templateID:void 0,toolbarElement:"div.toolbar",recordViewElement:"div.record-content",flagDialogTitle:void 0,flagDialogMsg:void 0,deleteDialogTitle:void 0,deleteDialogMsg:void 0,events:{"click a.widget-record-editable-display-clickable":"onClickRecord","mouseenter a.widget-record-editable-display-clickable":"onStartHoverRecord","mouseleave a.widget-record-editable-display-clickable":"onStopHoverRecord"},initialize:function(a,b){this.settings=a||{},this.options=b||{},this.updateModelURL(),this.listenTo(this.settings.model,"request",this.onModelRequest),this.listenTo(this.settings.model,"change:is_flagged",this.onModelFlag),this.listenTo(this.settings.model,"destroy",this.onModelDestroy),this.listenTo(this.settings.model,"error",this.onModelError),this.listenTo(this.settings.model,"getView",function(a){a(this)}.bind(this)),this.$el.data("modelAttributes",_.clone(this.settings.model.attributes)),b.sbMakeSelected&&this.makeSelected(),this.toolbarView=this.instantiateToolbarView(),this.toolbarView&&(this.toolbarView.listenTo(this,"cleanup",this.toolbarView.remove),this.listenTo(this.toolbarView,"onClickToolbar",this.onClickToolbar)),this.isEditing=!1,this.recordView=this.instantiateDisplayView({recordSettings:this.settings},{recordOptions:this.options}),this.recordView.listenTo(this,"cleanup",this.recordView.remove)
},remove:function(){return this.trigger("cleanup"),this.stopListening(this.recordView),this.stopListening(this.toolbarView),this.stopListening(this.settings.model),this.recordView=null,this.toolbarView=null,this.settings=null,this.options=null,Backbone.View.prototype.remove.call(this)},render:function(){return this.$el.html($.includejs.getTemplate(this.templateID)),this.toolbarView?(this.$(this.toolbarElement).html(this.toolbarView.render().$el),this.toolbarView.delegateEvents()):this.$(this.toolbarElement).html("&nbsp;"),this.$(this.recordViewElement).html(this.recordView.render().$el),this.toolbarView&&this.setToolbarButtonsEnabled(),this},setToolbarButtonsEnabled:function(){this.isEditing?this.toolbarView.setEnabled({}):this.toolbarView.setEnabled({select:!0,edit:!0,flag:!0,"delete":!0})},makeSelected:function(){this.$el.addClass("widget-record-editable-selected")},removeSelected:function(){this.$el.removeClass("widget-record-editable-selected")},isSelected:function(){return this.$el.hasClass("widget-record-editable-selected")},onClickToolbar:function(a){"select"===a?this.isSelected()?this.removeSelected():this.makeSelected():"edit"===a?this.isEditing||(this.trigger("onRecordEdit",this),this.isEditing=!0,this.setToolbarButtonsEnabled(),this.stopListening(this.recordView),this.recordView.remove(),this.recordView=new this.instantiateEditView({recordSettings:this.settings},{recordOptions:this.options}),this.recordView.listenTo(this,"cleanup",this.recordView.remove),this.listenTo(this.recordView,"onEditSave",this.onEditSave),this.listenTo(this.recordView,"onEditCancel",this.onEditCancel),this.$(this.recordViewElement).html(this.recordView.render().$el)):"flag"===a?bsDialog.create({title:this.flagDialogTitle,msg:this.flagDialogMsg,ok:function(){this.settings.model.save({is_flagged:!0},{wait:!0,patch:!0,sbRequestText:"Flagging..."})}.bind(this),cancel:function(){}}):"delete"===a&&(this.trigger("onRecordDeleteMaybe",this),bsDialog.create({title:this.deleteDialogTitle,msg:this.deleteDialogMsg,ok:function(){this.settings.model.destroy({wait:!0,sbRequestText:"Removing..."}),this.trigger("onRecordDeleteYes",this)}.bind(this),cancel:function(){this.trigger("onRecordDeleteNo",this)}.bind(this)}))},onEditSave:function(){this.trigger("onRecordSave",this),this.onEditCancel(!0)},onEditCancel:function(a){a||this.trigger("onRecordCancel",this),this.stopListening(this.recordView),this.recordView.remove(),this.isEditing=!1,this.recordView=this.instantiateDisplayView({recordSettings:this.settings},{recordOptions:this.options}),this.recordView.listenTo(this,"cleanup",this.recordView.remove),this.$(this.recordViewElement).html(this.recordView.render().$el),this.setToolbarButtonsEnabled()},onClickRecord:function(a){this.trigger("onClickRecord",this.$el.data("modelAttributes"),a),a.preventDefault(),a.stopPropagation()},onStartHoverRecord:function(a){this.trigger("onStartHoverRecord",this,a),this.$el.addClass("widget-record-editable-highlighted"),a.stopPropagation()},onStopHoverRecord:function(a){this.trigger("onStopHoverRecord",this,a),this.$el.removeClass("widget-record-editable-highlighted"),a.stopPropagation()},onModelRequest:function(a,b,c){Spinner.get().show({msg:c.sbRequestText,opacity:0})},onModelFlag:function(a,b,c){c.sbKeepRecord=this.shouldKeepRecordOnFlag(a,b,c),c.sbKeepRecord&&(this.$el.addClass("widget-record-editable-flagged"),this.setToolbarButtonsEnabled()),this.trigger("onRecordFlag",a,b,c),Spinner.get().hide()},shouldKeepRecordOnFlag:function(){return!0},onModelDestroy:function(a,b,c){this.trigger("onRecordDestroy",a,b,c),Spinner.get().hide()},onModelError:function(a,b){Spinner.get().hide(function(){app.dealWithAjaxFail(b,void 0,void 0)})}}),VBaseWidgetSlideshow=Backbone.View.extend({tagName:"div",id:void 0,className:"widget widget-slideshow",widgetLayoutTemplateID:void 0,toolbarElement:void 0,recordElement:void 0,events:{},initialize:function(a,b){this.settings=a||{},this.options=b||{},this.toolbarView=this.instantiateToolbar(),this.toolbarView.listenTo(this,"cleanup",this.toolbarView.remove),this.listenTo(this.toolbarView,"onClickToolbar",this.onClickToolbar),this.collection=this.instantiateCollection(),this.collection.reset(a.objects,{sort:!1}),this.listenTo(this.collection,"remove",this.onRemoveCollection),this.idx=a.startingIdx,this.idx=this.idx<0?0:this.idx,this.idx=this.idx>=this.collection.length?this.collection.length-1:this.idx,this.recordView=null},remove:function(){return this.stopListening(this.collection),this.stopListening(this.toolbarView),this.stopListening(this.recordView),this.trigger("cleanup"),this.settings=null,this.options=null,this.collection=null,this.toolbarView=null,this.recordView=null,Backbone.View.prototype.remove.call(this)},render:function(){return this.$el.html($.includejs.getTemplate(this.widgetLayoutTemplateID)),this.$(this.toolbarElement).html(this.toolbarView.render().$el),this.renderRecord(),this.updateToolbar(),this},renderRecord:function(){this.collection.length&&(this.recordView&&(this.stopListening(this.recordView),this.recordView.remove(),this.recordView=null),this.recordView=this.instantiateRecord(),this.listenTo(this.recordView,"onRecordFlag",this.onRecordFlag),this.listenTo(this.recordView,"onRecordEdit",this.onRecordEdit),this.listenTo(this.recordView,"onRecordSave",this.onRecordSave),this.listenTo(this.recordView,"onRecordCancel",this.onRecordCancel),this.recordView.listenTo(this,"cleanup",this.recordView.remove),this.$(this.recordElement).html(this.recordView.render().$el))},updateToolbar:function(){var a=this.toolbarView.getEnabled();this.toolbarView.setEnabled(_.extend({},a,{prev:!!this.idx&&!!this.collection.length,next:this.idx<this.collection.length-1,end:!0}))},instantiateCollection:function(){return null},instantiateToolbar:function(){return null},instantiateRecord:function(){return null},idxChanged:function(a){this.collection.length?a!==this.idx&&(this.renderRecord(),this.trigger("onRecordChange",this.idx,this.collection.at(this.idx))):(this.stopListening(this.recordView),this.recordView.remove(),this.recordView=null),this.updateToolbar()},onClickToolbar:function(a,b){if(this.trigger("onClickToolbar",a,b),"prev"===a){var c=this.idx;this.idx=this.idx-1<0?0:this.idx-1,this.idxChanged(c)}else if("next"===a){var c=this.idx;this.idx=this.idx+1>=this.collection.length?this.collection.length-1:this.idx+1,this.idxChanged(c)}else"end"===a&&this.trigger("onEnd")},onRecordFlag:function(a,b,c){c.sbKeepRecord||this.collection.remove(a)},onRecordEdit:function(){},onRecordSave:function(){},onRecordCancel:function(){},onRemoveCollection:function(){this.onClickToolbar("next",null)}}),VBaseWidgetToolbar=Backbone.View.extend({tagName:"div",id:void 0,className:"widget widget-toolbar",templateID:void 0,events:{"click button.toolbar_action":"onClickToolbar","click a.toolbar_action":"onClickToolbar"},initialize:function(){},remove:function(){return this.trigger("cleanup"),Backbone.View.prototype.remove.call(this)},setEnabled:function(a){this.$("button").prop("disabled",!0);for(var b in a)a[b]&&this.$("button[name="+b+"]").prop("disabled",!1)},getEnabled:function(){var a={};return this.$("button").each(function(){if($(this).prop("disabled")===!1){var c=$(this).prop("name");a[c]=!0}}),a},getButton:function(a){var b=this.$("button[name="+a+"]");return b.length||(b=this.$("a[name="+a+"]")),b},onClickToolbar:function(a){var b=$(a.currentTarget),c=b.prop("name");this.$("*[data-toggle=tooltip]").tooltip("hide"),this.trigger("onClickToolbar",c,b,a),a.preventDefault()},render:function(){return this.$el.html($.includejs.getTemplate(this.templateID)),this.setEnabled({}),this.$("*[data-toggle=tooltip]").tooltip(),this}});